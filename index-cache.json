{"files":[[1,{"id":1,"path":"/home/milan/Desktop/bug-sense/backend/ai-server.js","size":541,"mtime":1762257942761.6558,"lines":["// backend/ai-server.js","import express from \"express\";","import cors from \"cors\";","import aiAnalysisRoute from \"./routes/aiAnalysis.js\";","","const app = express();","app.use(cors());","// âœ… --- THIS IS THE FIX ---","// Increase the JSON payload limit to 50mb to allow for screenshots","app.use(express.json({ limit: \"50mb\" }));","app.use(express.urlencoded({ limit: \"50mb\", extended: true }));","","// Register route","app.use(\"/ai\", aiAnalysisRoute);","","const PORT = 3000;","app.listen(PORT, () => console.log(`ðŸ¤– BugSense AI backend running on port ${PORT}`));",""]}],[2,{"id":2,"path":"/home/milan/Desktop/bug-sense/backend/routes/aiAnalysis.js","size":431,"mtime":1762255532340.3474,"lines":["// backend/routes/aiAnalysis.js","import express from \"express\";","import { analyzeBug } from \"../services/transformerService.js\";","","const router = express.Router();","","router.post(\"/analyze\", async (req, res) => {","  try {","    const result = await analyzeBug(req.body);","    res.json(result);","  } catch (err) {","    console.error(\"AI analysis error:\", err);","    res.status(500).json({ error: err.message });","  }","});","","export default router;",""]}],[3,{"id":3,"path":"/home/milan/Desktop/bug-sense/backend/services/transformerService.js","size":2660,"mtime":1762412819633.0608,"lines":["// backend/services/transformerService.js","import { pipeline, env } from \"@xenova/transformers\";","","// Allow remote model loading","env.allowLocalModels = false;","env.allowRemoteModels = true;","","// Disable WASM limitations (use Node CPU backend)","env.backends.onnx.wasm.numThreads = 2;","env.backends.onnx.wasm.proxy = false;","env.backends.onnx.wasm.simd = false;","","let summarizer = null;","let textGenerator = null;","","// Initialize models once","export async function initAI() {","  if (!summarizer) {","    console.log(\"[BugSense AI] Loading summarizer model...\");","    summarizer = await pipeline(\"summarization\", \"Xenova/t5-small\");","  }","  if (!textGenerator) {","    console.log(\"[BugSense AI] Loading text generator model...\");","    textGenerator = await pipeline(\"text-generation\", \"Xenova/distilgpt2\");","  }","  console.log(\"[BugSense AI] Models initialized âœ…\");","}","","// Analyze bug text and generate report","export async function analyzeBug(input = {}) {","  const {","    console: consoleError,","    selectionText,","    srcUrl,","    linkUrl,","    replayActions,","    extraDetails,","  } = input;","","","  let contextText = \"\";","  if (consoleError) {","    contextText = `","Error: ${consoleError.message || \"\"}","File: ${consoleError.filename || \"unknown\"}","Line: ${consoleError.lineno || \"\"}","Stack: ${consoleError.stack || \"\"}","`;","  } else if (selectionText) {","    contextText = `User selected: \"${selectionText}\"`;","  } else if (srcUrl) {","    contextText = `User right-clicked image: ${srcUrl}`;","  } else if (linkUrl) {","    contextText = `User right-clicked link: ${linkUrl}`;","  }","","  contextText += `\\nActions before error: ${JSON.stringify(replayActions?.slice(-5) || [], null, 2)}`;","","  if (extraDetails) {","    contextText += `\\n\\nðŸ” Additional User Notes:\\n${extraDetails}`;","  }","","  await initAI();","","  const titleSummary = await summarizer(`Summarize this bug: ${contextText}`, {","    max_length: 25,","    min_length: 8,","  });","","  const descSummary = await summarizer(","    `Explain the issue clearly for a developer: ${contextText}`,","    { max_length: 80, min_length: 30 }","  );","","  const stepsGen = await textGenerator(","    `Based on this bug, describe how to reproduce it: ${contextText}\\nSteps:\\n1.`,","    { max_length: 100, temperature: 0.8 }","  );","","  const steps = stepsGen[0].generated_text","    .split(\"\\n\")","    .filter((s) => s.trim().match(/^\\d+\\./))","    .slice(0, 5);","","  return {","    title: titleSummary[0].summary_text || \"Auto Bug Report\",","    description: descSummary[0].summary_text || \"Bug description not available\",","    steps:","      steps.length > 0","        ? steps","        : [","          \"1. Observe the error on the page\",","          \"2. Follow actions from replay buffer\",","        ],","  };","}",""]}],[4,{"id":4,"path":"/home/milan/Desktop/bug-sense/frontend/extension/ai/analyze.ts","size":4754,"mtime":1762255254691.8289,"lines":["import { pipeline, env } from \"@xenova/transformers\";","","// ==============================","// ðŸ”§ Environment Configuration (Type-safe)","// ==============================","","// Disable all WebAssembly (WASM) backends â€” blocked by Chrome CSP","(env.backends.onnx.wasm as any).wasmPaths = \"\";","(env.backends.onnx.wasm as any).proxy = false;","(env.backends.onnx.wasm as any).simd = false;","(env.backends.onnx.wasm as any).numThreads = 1;","","// Disable local model access (since extensions can't serve local assets)","env.allowLocalModels = false;","","// Enable fetching models from Hugging Face CDN","env.allowRemoteModels = true;","","// Force safe CPU-only backend","(env.backends.onnx as any).threads = 1;","(env.backends.onnx as any).preferJS = true;","","// Reduce concurrency (safe for Chrome extensions)","(env as any).maxConcurrency = 1;","","// ==============================","// ðŸ§  Model Initialization","// ==============================","let summarizer: any = null;","let textGenerator: any = null;","","export async function initAI() {","    if (!summarizer) {","        console.log(\"[BugSense AI] Loading summarizer model...\");","        summarizer = await pipeline(\"summarization\", \"Xenova/t5-small\", {","            revision: \"main\", quantized: true,","        });","        console.log(\"[BugSense AI] Summarizer ready âœ…\");","    }","","    if (!textGenerator) {","        console.log(\"[BugSense AI] Loading text generator model...\");","        textGenerator = await pipeline(\"text-generation\", \"Xenova/distilgpt2\", {","            revision: \"main\", quantized: true,","        });","        console.log(\"[BugSense AI] Text generator ready âœ…\");","    }","}","","// ==============================","// ðŸ§© Main AI Analysis Function","// ==============================","export async function analyzeBug(input: {","    console?: any;","    selectionText?: string;","    srcUrl?: string;","    linkUrl?: string;","    screenshot?: string | null;","    replayActions?: any[];","}) {","    const { console: consoleError, selectionText, srcUrl, linkUrl, replayActions } = input;","","    // Build contextual prompt for AI","    let contextText = \"\";","    if (consoleError) {","        contextText = `","Error: ${consoleError.message || \"\"}","File: ${consoleError.filename || \"unknown\"}","Line: ${consoleError.lineno || \"\"}","Stack: ${consoleError.stack || \"\"}","`;","    } else if (selectionText) {","        contextText = `UI Bug: User selected this text on the page: \"${selectionText}\"\\n`;","    } else if (srcUrl) {","        contextText = `UI Bug: User right-clicked this image: \"${srcUrl}\"\\n`;","    } else if (linkUrl) {","        contextText = `UI Bug: User right-clicked this link: \"${linkUrl}\"\\n`;","    }","","    contextText += `\\nActions before error: ${JSON.stringify(","        replayActions?.slice(-5) || [],","        null,","        2","    )}`;","","    // Ensure AI models are initialized","    await initAI();","","    try {","        // Add loading feedback to console","        console.log(\"ðŸ¤– Analyzing with BugSense AI...\");","","        // 1ï¸âƒ£ Generate concise title","        const titleSummary = await summarizer(`Summarize this bug: ${contextText}`, {","            max_length: 25,","            min_length: 8,","        });","","        // 2ï¸âƒ£ Generate a detailed description","        const descSummary = await summarizer(","            `Explain the issue clearly for a developer: ${contextText}`,","            { max_length: 80, min_length: 30 }","        );","","        // 3ï¸âƒ£ Generate reproducible steps","        const stepsGen = await textGenerator(","            `Based on this bug, describe how to reproduce it: ${contextText}\\nSteps:\\n1.`,","            { max_length: 100, temperature: 0.8 }","        );","","        const steps = stepsGen[0].generated_text","            .split(\"\\n\")","            .filter((s: string) => s.trim().match(/^\\d+\\./))","            .slice(0, 5);","","        console.log(\"âœ… AI generation complete\");","","        return {","            title: titleSummary?.[0]?.summary_text || \"Auto Bug Report\",","            description:","                descSummary?.[0]?.summary_text ||","                consoleError?.message ||","                selectionText ||","                srcUrl ||","                linkUrl ||","                \"Bug captured\",","            steps:","                steps.length > 0","                    ? steps","                    : [","                        \"1. Observe the error or selected text on the page\",","                        \"2. Follow actions similar to replay buffer\",","                    ],","        };","    } catch (err) {","        console.error(\"AI call failed:\", err);","        return {","            title: \"AI Model Unavailable\",","            description:","                \"BugSense AI failed to generate bug details. Please retry or check connectivity.\",","            steps: [\"1. Capture screenshot\", \"2. Note down observed issue manually\"],","        };","    }","}",""]}],[5,{"id":5,"path":"/home/milan/Desktop/bug-sense/frontend/extension/ai/transformer.ts","size":4183,"mtime":1761715013626.6875,"lines":["/**"," * extension/utils/transformer.ts"," *"," * Minimal wrapper around @xenova/transformers for:"," * - loading a sentence embedding pipeline"," * - embedding texts"," * - computing cosine similarities and detecting duplicates"," *"," * NOTE: This runs in the browser and will download model files on first use."," */","","import { pipeline, env } from \"@xenova/transformers\";","","type TensorLike = {","  tolist?: () => number[][];","  data?: Float32Array;","  dims?: number[];","};","","let extractor: any = null;","let initializing = false;","","/**"," * Initialize the feature-extraction pipeline (lazy)."," * Uses Xenova/all-MiniLM-L6-v2 (small & performant)."," */","export async function initModel() {","  if (extractor || initializing) return;","  initializing = true;","","  try {","    // allowLocalModels is false by default; we rely on hosted model via transformers.js","    // If you want to use local model files, set env.allowLocalModels = true and ensure files are available.","    env.allowLocalModels = false;","","    // Load a feature-extraction pipeline which returns embeddings.","    extractor = await pipeline(\"feature-extraction\", \"Xenova/all-MiniLM-L6-v2\");","  } catch (err) {","    console.error(\"Failed to initialize transformer pipeline:\", err);","    extractor = null;","    throw err;","  } finally {","    initializing = false;","  }","}","","/**"," * Embed an array of texts to vectors (JS arrays)."," * Returns number[][] where each item is the embedding vector (length ~384)."," */","export async function embedTexts(texts: string[]): Promise<number[][]> {","  if (!extractor) {","    await initModel();","  }","  if (!extractor) throw new Error(\"Transformer extractor not initialized\");","","  // The extractor may accept an array of strings or a single string.","  // We request pooling mean + normalize so vectors are comparable via cosine.","  const options = { pooling: \"mean\", normalize: true };","","  const output: TensorLike = await extractor(texts, options);","  // Many pipelines return a Tensor-like object with tolist() or `data` + `dims`.","  if (output?.tolist) {","    const arr = output.tolist() as number[][];","    return arr;","  }","","  // Fallback: try to read output.data + dims","  if (output?.data && output?.dims) {","    const dims = output.dims[1] || output.dims[0];","    const floatArr = Array.from(output.data as Float32Array);","    const vectors: number[][] = [];","    for (let i = 0; i < floatArr.length; i += dims) {","      vectors.push(floatArr.slice(i, i + dims));","    }","    return vectors;","  }","","  throw new Error(\"Unknown embedding output shape\");","}","","/**"," * Cosine similarity between two vectors a and b."," */","export function cosineSimilarity(a: number[], b: number[]) {","  if (!a || !b || a.length !== b.length) return 0;","  let dot = 0;","  let na = 0;","  let nb = 0;","  for (let i = 0; i < a.length; i++) {","    dot += a[i] * b[i];","    na += a[i] * a[i];","    nb += b[i] * b[i];","  }","  if (na === 0 || nb === 0) return 0;","  return dot / (Math.sqrt(na) * Math.sqrt(nb));","}","","/**"," * Given an array of objects with a `text` property (string),"," * returns a mapping of duplicates based on semantic similarity."," *"," * threshold: cosine similarity threshold (0..1). Default 0.85 (adjustable)."," *"," * Returns:"," * {"," *   embeddings: number[][],"," *   pairs: Array<{i:number, j:number, score:number}>  // pairs above threshold"," * }"," */","export async function findDuplicates(items: { id?: string | number; text: string }[], threshold = 0.85) {","  if (!Array.isArray(items) || items.length === 0) {","    return { embeddings: [], pairs: [] };","  }","","  // Concatenate texts (shorten if too long)","  const texts = items.map((it) => {","    // trim long input to ~250 tokens (approx). Keep within model limits.","    const t = (it.text || \"\").trim();","    if (t.length > 2000) return t.slice(0, 2000);","    return t;","  });","","  // Compute embeddings","  const embeddings = await embedTexts(texts);","","  // Compute pairwise similarity","  const pairs: Array<{ i: number; j: number; score: number }> = [];","  for (let i = 0; i < embeddings.length; i++) {","    for (let j = i + 1; j < embeddings.length; j++) {","      const score = cosineSimilarity(embeddings[i], embeddings[j]);","      if (score >= threshold) {","        pairs.push({ i, j, score });","      }","    }","  }","","  return { embeddings, pairs };","}","",""]}],[6,{"id":6,"path":"/home/milan/Desktop/bug-sense/frontend/extension/assets/gif.worker.js","size":10817,"mtime":1761738007660.98,"lines":["!function(t){function e(r){if(i[r])return i[r].exports;var s=i[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p=\"\",e(0)}([function(t,e,i){var r,s;r=i(1),s=function(t){var e,i,s,o;return e=new r(t.width,t.height),0===t.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(t.transparent),e.setRepeat(t.repeat),e.setDelay(t.delay),e.setQuality(t.quality),e.setDither(t.dither),e.setGlobalPalette(t.globalPalette),e.addFrame(t.data),t.last&&e.finish(),t.globalPalette===!0&&(t.globalPalette=e.getGlobalPalette()),s=e.stream(),t.data=s.pages,t.cursor=s.cursor,t.pageSize=s.constructor.pageSize,t.canTransfer?(o=function(){var e,r,s,o;for(s=t.data,o=[],e=0,r=s.length;e<r;e++)i=s[e],o.push(i.buffer);return o}(),self.postMessage(t,o)):self.postMessage(t)},self.onmessage=function(t){return s(t.data)}},function(t,e,i){function r(){this.page=-1,this.pages=[],this.newPage()}function s(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new r}var o=i(2),n=i(3);r.pageSize=4096,r.charMap={};for(var a=0;a<256;a++)r.charMap[a]=String.fromCharCode(a);r.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(r.pageSize),this.cursor=0},r.prototype.getData=function(){for(var t=\"\",e=0;e<this.pages.length;e++)for(var i=0;i<r.pageSize;i++)t+=r.charMap[this.pages[e][i]];return t},r.prototype.writeByte=function(t){this.cursor>=r.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},r.prototype.writeUTFBytes=function(t){for(var e=t.length,i=0;i<e;i++)this.writeByte(t.charCodeAt(i))},r.prototype.writeBytes=function(t,e,i){for(var r=i||t.length,s=e||0;s<r;s++)this.writeByte(t[s])},s.prototype.setDelay=function(t){this.delay=Math.round(t/10)},s.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},s.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},s.prototype.setRepeat=function(t){this.repeat=t},s.prototype.setTransparent=function(t){this.transparent=t},s.prototype.addFrame=function(t){this.image=t,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),this.globalPalette===!0&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.globalPalette||this.writePalette(),this.writePixels(),this.firstFrame=!1},s.prototype.finish=function(){this.out.writeByte(59)},s.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},s.prototype.setDither=function(t){t===!0&&(t=\"FloydSteinberg\"),this.dither=t},s.prototype.setGlobalPalette=function(t){this.globalPalette=t},s.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},s.prototype.writeHeader=function(){this.out.writeUTFBytes(\"GIF89a\")},s.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new o(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace(\"-serpentine\",\"\"),null!==this.dither.match(/-serpentine/)):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent,!0))},s.prototype.indexPixels=function(){var t=this.pixels.length/3;this.indexedPixels=new Uint8Array(t);for(var e=0,i=0;i<t;i++){var r=this.findClosestRGB(255&this.pixels[e++],255&this.pixels[e++],255&this.pixels[e++]);this.usedEntry[r]=!0,this.indexedPixels[i]=r}},s.prototype.ditherPixels=function(t,e){var i={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!t||!i[t])throw\"Unknown dithering kernel: \"+t;var r=i[t],s=0,o=this.height,n=this.width,a=this.pixels,h=e?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var l=0;l<o;l++){e&&(h*=-1);for(var u=1==h?0:n-1,p=1==h?n:0;u!==p;u+=h){s=l*n+u;var f=3*s,c=a[f],y=a[f+1],w=a[f+2];f=this.findClosestRGB(c,y,w),this.usedEntry[f]=!0,this.indexedPixels[s]=f,f*=3;for(var d=this.colorTab[f],g=this.colorTab[f+1],x=this.colorTab[f+2],b=c-d,v=y-g,P=w-x,m=1==h?0:r.length-1,B=1==h?r.length:0;m!==B;m+=h){var S=r[m][1],T=r[m][2];if(S+u>=0&&S+u<n&&T+l>=0&&T+l<o){var M=r[m][0];f=s+S+T*n,f*=3,a[f]=Math.max(0,Math.min(255,a[f]+b*M)),a[f+1]=Math.max(0,Math.min(255,a[f+1]+v*M)),a[f+2]=Math.max(0,Math.min(255,a[f+2]+P*M))}}}}},s.prototype.findClosest=function(t,e){return this.findClosestRGB((16711680&t)>>16,(65280&t)>>8,255&t,e)},s.prototype.findClosestRGB=function(t,e,i,r){if(null===this.colorTab)return-1;if(this.neuQuant&&!r)return this.neuQuant.lookupRGB(t,e,i);for(var s=0,o=16777216,n=this.colorTab.length,a=0,h=0;a<n;h++){var l=t-(255&this.colorTab[a++]),u=e-(255&this.colorTab[a++]),p=i-(255&this.colorTab[a++]),f=l*l+u*u+p*p;(!r||this.usedEntry[h])&&f<o&&(o=f,s=h)}return s},s.prototype.getImagePixels=function(){var t=this.width,e=this.height;this.pixels=new Uint8Array(t*e*3);for(var i=this.image,r=0,s=0,o=0;o<e;o++)for(var n=0;n<t;n++)this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],r++},s.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var t,e;null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&dispose),e<<=2,this.out.writeByte(0|e|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},s.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},s.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},s.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes(\"NETSCAPE2.0\"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},s.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},s.prototype.writeShort=function(t){this.out.writeByte(255&t),this.out.writeByte(t>>8&255)},s.prototype.writePixels=function(){var t=new n(this.width,this.height,this.indexedPixels,this.colorDepth);t.encode(this.out)},s.prototype.stream=function(){return this.out},t.exports=s},function(t,e){function i(t,e){function i(){z=[],E=new Int32Array(256),R=new Int32Array(s),U=new Int32Array(s),Q=new Int32Array(s>>3);var t,e;for(t=0;t<s;t++)e=(t<<n+8)/s,z[t]=new Float64Array([e,e,e,0]),U[t]=h/s,R[t]=0}function c(){for(var t=0;t<s;t++)z[t][0]>>=n,z[t][1]>>=n,z[t][2]>>=n,z[t][3]=t}function w(t,e,i,r,s){z[e][0]-=t*(z[e][0]-i)/b,z[e][1]-=t*(z[e][1]-r)/b,z[e][2]-=t*(z[e][2]-s)/b}function x(t,e,i,r,o){for(var n,a,h=Math.abs(e-t),l=Math.min(e+t,s),u=e+1,p=e-1,f=1;u<l||p>h;)a=Q[f++],u<l&&(n=z[u++],n[0]-=a*(n[0]-i)/B,n[1]-=a*(n[1]-r)/B,n[2]-=a*(n[2]-o)/B),p>h&&(n=z[p--],n[0]-=a*(n[0]-i)/B,n[1]-=a*(n[1]-r)/B,n[2]-=a*(n[2]-o)/B)}function v(t,e,i){t=0|t,e=0|e,i=0|i;var r,o,h,c,y,w=~(1<<31),d=w,g=-1,x=g;for(r=0;r<s;r++)o=z[r],h=Math.abs((0|o[0])-t)+Math.abs((0|o[1])-e)+Math.abs((0|o[2])-i)|0,h<w&&(w=h,g=r),c=h-((0|R[r])>>a-n),c<d&&(d=c,x=r),y=U[r]>>u,U[r]-=y,R[r]+=y<<l;return U[g]+=p,R[g]-=f,x}function m(){var t,e,i,r,n,a,h=0,l=0;for(t=0;t<s;t++){for(i=z[t],n=t,a=i[1],e=t+1;e<s;e++)r=z[e],r[1]<a&&(n=e,a=r[1]);if(r=z[n],t!=n&&(e=r[0],r[0]=i[0],i[0]=e,e=r[1],r[1]=i[1],i[1]=e,e=r[2],r[2]=i[2],i[2]=e,e=r[3],r[3]=i[3],i[3]=e),a!=h){for(E[h]=l+t>>1,e=h+1;e<a;e++)E[e]=t;h=a,l=t}}for(E[h]=l+o>>1,e=h+1;e<256;e++)E[e]=o}function C(t,e,i){t=0|t,e=0|e,i=0|i;for(var r,o,n,a=1e3,h=-1,l=0|E[e],u=l-1;l<s||u>=0;)l<s&&(o=z[l],n=(0|o[1])-e,n>=a?l=s:(l++,n<0&&(n=-n),r=(0|o[0])-t,r<0&&(r=-r),n+=r,n<a&&(r=(0|o[2])-i,r<0&&(r=-r),n+=r,n<a&&(a=n,h=0|o[3])))),u>=0&&(o=z[u],n=e-(0|o[1]),n>=a?u=-1:(u--,n<0&&(n=-n),r=(0|o[0])-t,r<0&&(r=-r),n+=r,n<a&&(r=(0|o[2])-i,r<0&&(r=-r),n+=r,n<a&&(a=n,h=0|o[3]))));return h}function I(){var i,s=t.length,o=30+(e-1)/3,a=s/(3*e),h=~~(a/r),l=b,u=d,p=u>>y;for(p<=1&&(p=0),i=0;i<p;i++)Q[i]=l*((p*p-i*i)*P/(p*p));var f;s<A?(e=1,f=3):f=s%S!==0?3*S:s%T!==0?3*T:s%M!==0?3*M:3*F;var c,m,B,C,I=0;for(i=0;i<a;)if(c=(255&t[I])<<n,m=(255&t[I+1])<<n,B=(255&t[I+2])<<n,C=v(c,m,B),w(l,C,c,m,B),0!==p&&x(p,C,c,m,B),I+=f,I>=s&&(I-=s),i++,0===h&&(h=1),i%h===0)for(l-=l/o,u-=u/g,p=u>>y,p<=1&&(p=0),C=0;C<p;C++)Q[C]=l*((p*p-C*C)*P/(p*p))}function D(){i(),I(),c(),m()}function G(){for(var t=[],e=[],i=0;i<s;i++)e[z[i][3]]=i;for(var r=0,o=0;o<s;o++){var n=e[o];t[r++]=z[n][0],t[r++]=z[n][1],t[r++]=z[n][2]}return t}var z,E,R,U,Q;this.buildColormap=D,this.getColormap=G,this.lookupRGB=C}var r=100,s=256,o=s-1,n=4,a=16,h=1<<a,l=10,u=10,p=h>>u,f=h<<l-u,c=s>>3,y=6,w=1<<y,d=c*w,g=30,x=10,b=1<<x,v=8,P=1<<v,m=x+v,B=1<<m,S=499,T=491,M=487,F=503,A=3*F;t.exports=i},function(t,e){function i(t,e,i,a){function h(t,e){S[x++]=t,x>=254&&c(e)}function l(t){u(o),A=P+2,C=!0,d(P,t)}function u(t){for(var e=0;e<t;++e)T[e]=-1}function p(t,e){var i,n,a,h,p,f,c;for(v=t,C=!1,n_bits=v,b=y(n_bits),P=1<<t-1,m=P+1,A=P+2,x=0,h=w(),c=0,i=o;i<65536;i*=2)++c;c=8-c,f=o,u(f),d(P,e);t:for(;(n=w())!=r;)if(i=(n<<s)+h,a=n<<c^h,T[a]!==i){if(T[a]>=0){p=f-a,0===a&&(p=1);do if((a-=p)<0&&(a+=f),T[a]===i){h=M[a];continue t}while(T[a]>=0)}d(h,e),h=n,A<1<<s?(M[a]=A++,T[a]=i):l(e)}else h=M[a];d(h,e),d(m,e)}function f(i){i.writeByte(B),remaining=t*e,curPixel=0,p(B+1,i),i.writeByte(0)}function c(t){x>0&&(t.writeByte(x),t.writeBytes(S,0,x),x=0)}function y(t){return(1<<t)-1}function w(){if(0===remaining)return r;--remaining;var t=i[curPixel++];return 255&t}function d(t,e){for(g&=n[F],F>0?g|=t<<F:g=t,F+=n_bits;F>=8;)h(255&g,e),g>>=8,F-=8;if((A>b||C)&&(C?(b=y(n_bits=v),C=!1):(++n_bits,b=n_bits==s?1<<s:y(n_bits))),t==m){for(;F>0;)h(255&g,e),g>>=8,F-=8;c(e)}}var g,x,b,v,P,m,B=Math.max(2,a),S=new Uint8Array(256),T=new Int32Array(o),M=new Int32Array(o),F=0,A=0,C=!1;this.encode=f}var r=-1,s=12,o=5003,n=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];t.exports=i}]);","//# sourceMappingURL=gif.worker.js.map"]}],[7,{"id":7,"path":"/home/milan/Desktop/bug-sense/frontend/extension/background/index.ts","size":30235,"mtime":1762451968777.9517,"lines":["// extension/background/index.ts","// Background service worker for Bug Sense (Manifest V3)","// Handles START/STOP recording (tabCapture), and handles one-shot CAPTURE_FRAME requests","// from content scripts to capture visible tab screenshot. Returns screenshot as data URL.","","type Msg =","  | { action: \"START_RECORDING\" }","  | { action: \"STOP_RECORDING\" }","  | { action: \"OPEN_GIF_UPLOADER\" }","  | { action: \"OPEN_RECORDER_WINDOW\" }","  | { action: \"CAPTURE_FRAME\" }","  | { action: \"TAKE_SCREENSHOT\" }","  | { action: \"SAVE_ANNOTATED_IMAGE_DATAURL\" }","  | { action: \"OPEN_REPLAY_EXPORT_PAGE\" }","  | { action: \"HIDE_OVERLAY_AND_CAPTURE\" };","","let mediaRecorder: MediaRecorder | null = null;","let recordedChunks: BlobPart[] = [];","let activeStream: MediaStream | null = null;","const lastSavedUrlKey = \"recordedVideo\";","","// Safety listener to silence \"async channel closed\" warnings","// This acts as a safety net for any message that truly never calls sendResponse.","// It doesn't replace proper fixes, but prevents random console spam while you fix remaining listeners.","chrome.runtime.onMessage.addListener(() => {","  // Intentionally no-op.","});","","function setRecordingFlag(on: boolean) {","  try {","    chrome.storage.local.set({ isRecording: on });","  } catch (e) {","    // ignore","  }","}","","function saveBlobUrlToStorage(key: string, url: string) {","  try {","    chrome.storage.local.get([key], (data) => {","      try {","        const prev = data?.[key];","        if (prev && typeof prev === \"string\") {","          try {","            URL.revokeObjectURL(prev);","          } catch { }","        }","      } catch { }","      try {","        chrome.storage.local.set({ [key]: url });","      } catch (err) {","        console.warn(\"Failed to set storage key:\", key, err);","      }","    });","  } catch (err) {","    console.warn(\"saveBlobUrlToStorage outer error:\", err);","    try {","      chrome.storage.local.set({ [key]: url });","    } catch { }","  }","}","","function finalizeRecording() {","  try {","    if (recordedChunks.length > 0) {","      const blob = new Blob(recordedChunks, { type: \"video/webm\" });","      const url = URL.createObjectURL(blob);","      saveBlobUrlToStorage(lastSavedUrlKey, url);","    }","  } catch (err) {","    console.error(\"finalizeRecording error:\", err);","  } finally {","    try {","      activeStream?.getTracks().forEach((t) => t.stop());","    } catch { }","    recordedChunks = [];","    mediaRecorder = null;","    activeStream = null;","    setRecordingFlag(false);","  }","}","","// Try background tab capture (tabCapture API)","function tryTabCapture(): Promise<MediaStream | null> {","  return new Promise((resolve) => {","    try {","      const tc: any = (chrome as any).tabCapture;","      if (!tc || typeof tc.capture !== \"function\") {","        resolve(null);","        return;","      }","      tc.capture({ video: true, audio: false }, (stream: MediaStream | undefined) => {","        if (!stream) {","          console.warn(\"tabCapture returned no stream:\", chrome.runtime.lastError?.message);","          resolve(null);","          return;","        }","        resolve(stream);","      });","    } catch (err) {","      console.warn(\"tryTabCapture threw:\", err);","      resolve(null);","    }","  });","}","","console.log(\"[BugSense Background] Service worker active âœ…\");","","//---------------------------------------------","chrome.runtime.onInstalled.addListener(() => {","  // Create parent menu","  chrome.contextMenus.create({","    id: \"BUGSENSE_MAIN_MENU\",","    title: \"Bug Sense\",","    contexts: [\"all\"],","  });","  // Add two submenus","  chrome.contextMenus.create({","    id: \"BUGSENSE_FULL_SCREENSHOT\",","    parentId: \"BUGSENSE_MAIN_MENU\",","    title: \"Create bug report (Full screen)\",","    contexts: [\"all\"],","  });","  chrome.contextMenus.create({","    id: \"BUGSENSE_SELECTIVE_SCREENSHOT\",","    parentId: \"BUGSENSE_MAIN_MENU\",","    title: \"Create bug report (Select area)\",","    contexts: [\"all\"],","  });","  console.log(\"[BugSense] Background installed. Context menu created âœ…\");","});","","// 2. Replace your onClicked listener with this new one","chrome.contextMenus.onClicked.addListener(async (info, tab) => {","  if (!tab?.id) return;","","  if (info.menuItemId === \"BUGSENSE_FULL_SCREENSHOT\") {","    chrome.runtime.sendMessage({","      action: \"TRIGGER_BUG_CREATION_FROM_CONTEXT\",","      mode: \"full\",","      selectionText: info.selectionText,","      srcUrl: info.srcUrl,","      linkUrl: info.linkUrl,","    });","  }","","  if (info.menuItemId === \"BUGSENSE_SELECTIVE_SCREENSHOT\") {","    // Inject selectionOverlay.js only once per page (guard in the page avoids duplicate listeners)","    try {","      await chrome.scripting.executeScript({","        target: { tabId: tab.id },","        func: () => {","          // Run in page context:","          // If already injected, mark won't re-inject","          // NOTE: window is page's window object (this function serializes into the page)","          // __bugSenseOverlayInjected is a page-global guard.","          if ((window as any).__bugSenseOverlayInjected) return;","          (window as any).__bugSenseOverlayInjected = true;","","          // Create a script tag that loads extension file (this avoids multiple copies of same content script","          // being registered by the extension engine)","          const s = document.createElement(\"script\");","          s.src = chrome.runtime.getURL(\"extension/content/selectionOverlay.js\");","          s.async = true;","          document.documentElement.appendChild(s);","        },","      });","    } catch (err) {","      // If programmatic injection fails, fallback to injecting via files (best-effort)","      console.warn(\"[BugSense] programmatic injection failed, falling back to file injection:\", err);","      try {","        await chrome.scripting.executeScript({","          target: { tabId: tab.id },","          files: [\"extension/content/selectionOverlay.js\"],","        });","      } catch (err2) {","        console.warn(\"[BugSense] fallback injection also failed:\", err2);","      }","    }","","    // Trigger the overlay to start selection (content script listens for this message)","    chrome.tabs.sendMessage(tab.id, { action: \"START_SELECTIVE_CAPTURE\" });","  }","});","//---------------------------------------------","","// ==========================================================","// ðŸ†• BUGSENSE SCREENSHOT HANDLER (Non-blocking + Full Res + Preview)","// ==========================================================","","type FullImageRecord = {","  dataUrl: string;      // full screenshot (dataURL)","  filename: string;     // download filename","  createdAt: number;    // timestamp for auto cleanup","};","","const FULL_IMAGE_CACHE = new Map<string, FullImageRecord>();","const FULL_IMAGE_TTL = 1000 * 60 * 5; // 5 minutes","","function scheduleScreenshotCleanup(key: string, delay = FULL_IMAGE_TTL) {","  setTimeout(() => {","    FULL_IMAGE_CACHE.delete(key);","  }, delay);","}","","async function createPreviewDataUrl(blob: Blob, maxW = 800, maxH = 600, quality = 0.7): Promise<string> {","  try {","    const bitmap = await createImageBitmap(blob);","    const scale = Math.min(1, Math.min(maxW / bitmap.width, maxH / bitmap.height));","    const w = Math.round(bitmap.width * scale);","    const h = Math.round(bitmap.height * scale);","","    const canvas = new OffscreenCanvas(w, h);","    const ctx = canvas.getContext(\"2d\");","    if (!ctx) throw new Error(\"Failed to create OffscreenCanvas context\");","","    ctx.drawImage(bitmap, 0, 0, w, h);","    const previewBlob = await (canvas as any).convertToBlob({ type: \"image/jpeg\", quality });","    bitmap.close();","","    const reader = new FileReader();","    return await new Promise((resolve, reject) => {","      reader.onload = () => resolve(reader.result as string);","      reader.onerror = reject;","      reader.readAsDataURL(previewBlob);","    });","  } catch (err) {","    console.warn(\"[BugSense] Preview downscale failed:\", err);","    return \"\";","  }","}","","// ðŸ§  TAKE_SCREENSHOT & DOWNLOAD_FULL_SCREENSHOT handler","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg?.action === \"TAKE_SCREENSHOT\") {","    try {","      console.log(\"[BugSense Background] TAKE_SCREENSHOT triggered ðŸ–¼ï¸\");","","      chrome.tabs.query({ active: true, currentWindow: true }, async (tabs) => {","        const tab = tabs?.[0];","        if (!tab || !tab.windowId) {","          sendResponse({ success: false, error: \"No active tab\" });","          return;","        }","","        chrome.tabs.captureVisibleTab(tab.windowId, { format: \"jpeg\", quality: 85 }, async (dataUrl) => {","          if (chrome.runtime.lastError) {","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"captureVisibleTab failed\",","            });","            return;","          }","","          if (!dataUrl) {","            sendResponse({ success: false, error: \"Empty screenshot\" });","            return;","          }","","          try {","            // Full image storage","            const filename = `bug-sense-screenshot-${Date.now()}.jpg`;","            const key = `bugSense_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;","            FULL_IMAGE_CACHE.set(key, { dataUrl, filename, createdAt: Date.now() });","            scheduleScreenshotCleanup(key);","","            // Generate small preview","            const blob = await (await fetch(dataUrl)).blob();","            let previewUrl = dataUrl;","            try {","              const preview = await createPreviewDataUrl(blob, 600, 400, 0.7);","              if (preview) previewUrl = preview;","            } catch { }","","            sendResponse({","              success: true,","              preview: previewUrl,","              fullKey: key,","              filename,","            });","          } catch (err) {","            sendResponse({ success: false, error: String(err) });","          }","        });","      });","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","","    return true; // keep sendResponse async","  }","","  if (msg?.action === \"DOWNLOAD_FULL_SCREENSHOT\" && msg.fullKey) {","    try {","      const entry = FULL_IMAGE_CACHE.get(msg.fullKey);","      if (!entry) {","        sendResponse({ success: false, error: \"Screenshot expired or missing\" });","        return;","      }","","      chrome.downloads.download(","        {","          url: entry.dataUrl,","          filename: entry.filename,","          saveAs: true,","        },","        (id) => {","          if (chrome.runtime.lastError) {","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"Download failed\",","            });","          } else {","            sendResponse({ success: true, downloadId: id });","          }","          FULL_IMAGE_CACHE.delete(msg.fullKey);","        }","      );","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","","    return true; // async","  }","});","// ==========================================================","// ðŸ§  FINAL: SAVE_ANNOTATED_IMAGE_DATAURL (High Quality JPEG)","// ==========================================================","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg?.action === \"SAVE_ANNOTATED_IMAGE_DATAURL\") {","    try {","      const { dataUrl } = msg;","      if (!dataUrl || !dataUrl.startsWith(\"data:image\")) {","        sendResponse({ success: false, error: \"Invalid data URL\" });","        return;","      }","","      // Force proper JPEG extension and MIME","      const filename = `bug-sense-annotated-${Date.now()}.jpg`;","      const jpegDataUrl = dataUrl.replace(/^data:image\\/[^;]+/, \"data:image/jpeg\");","","      chrome.downloads.download(","        {","          url: jpegDataUrl,","          filename,","          saveAs: true,","        },","        (downloadId) => {","          if (chrome.runtime.lastError) {","            console.error(\"[BugSense] Annotated JPEG download failed:\", chrome.runtime.lastError);","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"Download failed\",","            });","          } else {","            console.log(\"[BugSense] Annotated image download started:\", downloadId);","            sendResponse({ success: true });","          }","        }","      );","    } catch (err) {","      console.error(\"[BugSense] SAVE_ANNOTATED_IMAGE_DATAURL failed:\", err);","      sendResponse({ success: false, error: String(err) });","    }","","    return true; // async response","  }","});","","// ---------- Recording & misc handler (single big listener) ----------","chrome.runtime.onMessage.addListener((msg: any, sender, sendResponse) => {","  // Wrap the handler logic in an async IIFE so we can await and always call sendResponse.","  (async () => {","    try {","      if (!msg || !msg.action) {","        // nothing to do","        return;","      }","","      if (msg.action === \"START_RECORDING\") {","        console.log(\"Background: START_RECORDING received\");","","        if (mediaRecorder && mediaRecorder.state === \"recording\") {","          sendResponse({ success: true, alreadyRecording: true });","          return;","        }","","        const stream = await tryTabCapture();","        if (!stream) {","          console.warn(\"tabCapture unavailable -> use separate recorder window\");","          sendResponse({ success: false, requireRecorderWindow: true });","          return;","        }","","        activeStream = stream;","        recordedChunks = [];","","        try {","          mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm\" });","        } catch (err) {","          console.error(\"MediaRecorder init failed:\", err);","          sendResponse({ success: false });","          return;","        }","","        mediaRecorder.ondataavailable = (e) => {","          if (e.data && e.data.size > 0) recordedChunks.push(e.data);","        };","        mediaRecorder.onstop = finalizeRecording;","        mediaRecorder.start();","","        setRecordingFlag(true);","        console.log(\"Background: Recording started ðŸŽ¥\");","        sendResponse({ success: true });","        return;","      }","","      if (msg.action === \"STOP_RECORDING\") {","        if (mediaRecorder && mediaRecorder.state === \"recording\") {","          console.log(\"Background: STOP_RECORDING triggered\");","          mediaRecorder.stop();","          sendResponse({ success: true });","        } else {","          setRecordingFlag(false);","          sendResponse({ success: true, alreadyStopped: true });","        }","        return;","      }","","      if (msg.action === \"OPEN_GIF_UPLOADER\") {","        const url = chrome.runtime.getURL(\"extension/uploader/uploader.html\");","        chrome.windows.create({ url, type: \"popup\", width: 660, height: 560 }, () => {","          sendResponse({ opened: true });","        });","        return;","      }","","      if (msg.action === \"OPEN_RECORDER_WINDOW\") {","        const url = chrome.runtime.getURL(\"extension/recorder/recorder.html\");","        chrome.windows.create({ url, type: \"popup\", width: 720, height: 520 }, () => {","          sendResponse({ opened: true });","        });","        return;","      }","","      // ===== CAPTURE FRAME (one-shot) =====","      if (msg.action === \"CAPTURE_FRAME\") {","        try {","          // Query active tab","          chrome.tabs.query({ active: true, currentWindow: true }, async (tabs) => {","            try {","              const tab = tabs?.[0];","              if (!tab) {","                sendResponse({ success: false, error: \"No active tab\" });","                return;","              }","","              // captureVisibleTab takes the windowId of the tab","              const winId = tab.windowId;","              if (typeof winId !== \"number\") {","                sendResponse({ success: false, error: \"Invalid window id\" });","                return;","              }","","              // capture as JPEG (quality to keep size reasonable)","              try {","                chrome.tabs.captureVisibleTab(winId, { format: \"jpeg\", quality: 60 }, (dataUrl) => {","                  if (chrome.runtime.lastError) {","                    console.warn(\"captureVisibleTab runtime error:\", chrome.runtime.lastError);","                    sendResponse({ success: false, error: String(chrome.runtime.lastError.message || chrome.runtime.lastError) });","                    return;","                  }","                  if (dataUrl) {","                    sendResponse({ success: true, screenshot: dataUrl });","                  } else {","                    sendResponse({ success: false, error: \"capture returned empty\" });","                  }","                });","              } catch (capErr) {","                console.error(\"captureVisibleTab call threw:\", capErr);","                sendResponse({ success: false, error: String(capErr) });","              }","            } catch (inner) {","              console.error(\"CAPTURE_FRAME inner error:\", inner);","              sendResponse({ success: false, error: String(inner) });","            }","          });","        } catch (err) {","          console.error(\"CAPTURE_FRAME error:\", err);","          sendResponse({ success: false, error: String(err) });","        }","        return;","      }","","      // ===== APPEND SHEET ROW =====","      // Replace callback-style chrome.identity.getAuthToken with a Promise wrapper so we always sendResponse","      if (msg.action === \"APPEND_SHEET_ROW\") {","        const { sheetId, range, row } = msg;","        try {","          const token = await new Promise<string>((resolve, reject) => {","            try {","              chrome.identity.getAuthToken({ interactive: true }, (t: any) => {","                if (chrome.runtime.lastError || !t) reject(chrome.runtime.lastError || new Error(\"No token\"));","                else resolve(t);","              });","            } catch (e) {","              reject(e);","            }","          });","","          const resp = await fetch(","            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS`,","            {","              method: \"POST\",","              headers: {","                Authorization: `Bearer ${token}`,","                \"Content-Type\": \"application/json\",","              },","              body: JSON.stringify({ values: [row] }),","            }","          );","","          if (!resp.ok) {","            const j = await resp.json().catch(() => null);","            sendResponse({ success: false, error: j || resp.statusText });","            return;","          }","","          const j = await resp.json();","          sendResponse({ success: true, result: j });","        } catch (err) {","          sendResponse({ success: false, error: String(err) });","        }","        return true; // keep message channel open for async response","      }","","    } catch (outer) {","      console.error(\"Background onMessage outer error:\", outer);","      try {","        sendResponse({ success: false, error: String(outer) });","      } catch { }","    }","  })();","","  // indicate we'll call sendResponse asynchronously (for branches that need it)","  return true;","});","","// Ensure replayListener is injected into pages that are navigated","chrome.runtime.onInstalled.addListener(() => {","  console.log(\"[BugSense] Background installed. ready to inject content scripts when tabs update.\");","});","","chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {","  try {","    if (changeInfo.status === \"complete\" && /^https?:/.test(tab.url || \"\")) {","      const fileToInject = \"extension/content/replayListener.js\";","      // small delay to ensure DOM is ready","      await new Promise((r) => setTimeout(r, 200));","      try {","        await chrome.scripting.executeScript({","          target: { tabId },","          files: [fileToInject],","        });","        console.log(`[BugSense] replayListener injected into ${tab.url}`);","      } catch (err) {","        console.warn(\"[BugSense] replayListener inject failed (maybe already injected):\", err);","      }","    }","  } catch (outer) {","    console.error(\"[BugSense] tabs.onUpdated handler error:\", outer);","  }","});","","// background/index.ts (in the service worker)","// Replace or add this injection logic (non-invasive)","chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {","  try {","    // only act when the tab finished loading and the url is a Google Sheet","    if (changeInfo.status !== \"complete\" || !tab?.url || !tab.url.includes(\"docs.google.com/spreadsheets\")) {","      return;","    }","","    console.log(\"[BugSense] Google Sheet tab detected â€” enumerating frames for injection...\");","","    // small delay to let Google mount frames","    await new Promise((r) => setTimeout(r, 800));","","    // get frame list for the tab (requires \"webNavigation\" permission)","    chrome.webNavigation.getAllFrames({ tabId }, async (frames) => {","      try {","        if (!frames || frames.length === 0) {","          console.warn(\"[BugSense] No frames returned by webNavigation.getAllFrames()\");","          // as fallback inject into top frame (best effort)","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (fallback)\");","          return;","        }","","        // attempt to inject into a best-match frame (sheet/grid frames often contain 'docs' or 'client' urls)","        let injected = false;","","        for (const f of frames) {","          const url = f.url || \"\";","          // pick frames that look like they belong to the sheet or docs app","          if (url.includes(\"docs.google.com\") || url.includes(\"client\") || url.includes(\"spreadsheets\")) {","            try {","              // Attempt injection into this frameId (only same-origin or injectable frames will succeed)","              await chrome.scripting.executeScript({","                target: { tabId, frameIds: [f.frameId] },","                files: [\"extension/content/duplicateBugDetector.js\"],","              });","              console.log(`[BugSense] duplicateBugDetector injected into frameId=${f.frameId} url=${url}`);","              injected = true;","              break;","            } catch (err) {","              // likely cross-origin / sandboxed frame - ignore and try next","              console.warn(`[BugSense] frame ${f.frameId} injection failed (ignored):`, url, err);","            }","          }","        }","","        // If none matched, fallback to injecting into top frame (best-effort)","        if (!injected) {","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (final fallback)\");","        }","      } catch (err) {","        console.warn(\"[BugSense] Error enumerating frames / injecting:\", err);","        // fallback to top frame injection","        try {","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (error fallback)\");","        } catch (e) {","          console.warn(\"[BugSense] final fallback injection failed:\", e);","        }","      }","    });","  } catch (outer) {","    console.error(\"[BugSense] tabs.onUpdated injection outer error:\", outer);","  }","});","","//----------------","chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {","  if (message.action === \"GET_GOOGLE_TOKEN\") {","    // Wrap the chrome.identity.getAuthToken callback in a Promise to ensure we always call sendResponse.","    (async () => {","      try {","        const token = await new Promise<string>((resolve, reject) => {","          try {","            chrome.identity.getAuthToken({ interactive: true }, (t: any) => {","              if (chrome.runtime.lastError || !t) reject(chrome.runtime.lastError || new Error(\"No token\"));","              else resolve(t);","            });","          } catch (e) {","            reject(e);","          }","        });","        sendResponse({ success: true, token });","      } catch (e) {","        console.error(\"[BugSense Background] Failed to get auth token:\", e);","        sendResponse({ success: false, error: String(e) });","      }","    })();","","    return true; // keep message channel open for async response","  }","});","","// ========== Simple Caching Layer ==========","const CACHE_KEY = \"bugSenseCache\";","const CACHE_EXPIRY = 1000 * 60 * 10; // 10 minutes","","async function getCachedData(sheetId: string, range: string) {","  const cache = await chrome.storage.local.get(CACHE_KEY);","  const now = Date.now();","","  if (cache[CACHE_KEY] && now - cache[CACHE_KEY].timestamp < CACHE_EXPIRY) {","    console.log(\"[BugSense] Loaded data from cache ðŸ§ \");","    return cache[CACHE_KEY].data;","  }","","  // ask content script for new data","  return new Promise((resolve) => {","    chrome.runtime.sendMessage({ action: \"FETCH_SHEET_DATA\", sheetId, range }, async (response) => {","      await chrome.storage.local.set({","        [CACHE_KEY]: { data: response, timestamp: now },","      });","      console.log(\"[BugSense] Cached new data ðŸ§©\");","      resolve(response);","    });","  });","}","/////////////////////////////////////////","// === BugSense DevTools bridge ===","// This allows DevPanel to receive real-time console messages.","let bugsenseDevPorts: chrome.runtime.Port[] = [];","","chrome.runtime.onConnect.addListener((port) => {","  if (port.name === \"bugsense-devtools\") {","    console.log(\"[BugSense] DevTools connected âœ…\");","    bugsenseDevPorts.push(port);","","    port.onDisconnect.addListener(() => {","      bugsenseDevPorts = bugsenseDevPorts.filter((p) => p !== port);","      console.log(\"[BugSense] DevTools disconnected âŒ\");","    });","  }","});","","// Forward console events to DevTools panel (optional future use)","chrome.runtime.onMessage.addListener((msg, sender) => {","  if (msg.action === \"BUGSENSE_CONSOLE\") {","    bugsenseDevPorts.forEach((p) => p.postMessage(msg));","  }","});","","//-------------------------------","// bugsense_create_bug (single-shot)","chrome.runtime.onMessage.addListener(async (msg, sender, sendResponse) => {","  if (msg.action === \"bugsense_create_bug\") {","    try {","      const { message, file, line, column, time } = msg.payload;","","      // Take screenshot","      const screenshot = await chrome.tabs.captureVisibleTab();","","      // Construct bug object","      const bug = {","        title: `Bug from ${file ? file.split(\"/\").pop() : \"unknown source\"}`,","        description: message,","        file,","        line,","        column,","        time,","        screenshot,","        steps: \"AI will generate reproduction steps from replay and context.\",","        createdAt: new Date().toLocaleString(),","      };","","      await chrome.storage.local.set({ bugsense_clipboard: bug });","","      console.log(\"âœ… [BugSense] Bug saved to clipboard:\", bug);","      sendResponse({ success: true });","    } catch (err) {","      console.error(\"bugsense_create_bug failed:\", err);","      sendResponse({ success: false, error: String(err) });","    }","    return true;","  }","});","","// GET_REPLAY_LOGS handler (keeps channel open and responds)","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg.action === \"GET_REPLAY_LOGS\") {","    try {","      chrome.storage.local.get([\"replayActionsLog\"], (res) => {","        if (chrome.runtime.lastError) {","          console.warn(\"Error getting replay logs:\", chrome.runtime.lastError);","          sendResponse({ success: false, actions: [] });","        } else {","          const actions = res?.replayActionsLog || [];","          console.log(\"[BugSense Background] Sent replay actions:\", actions);","          sendResponse({ success: true, actions: actions });","        }","      });","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","    return true;","  }","});","","// OPEN_REPLAY_EXPORT_PAGE","chrome.runtime.onMessage.addListener((msg) => {","  if (msg.action === \"OPEN_REPLAY_EXPORT_PAGE\") {","    const url = chrome.runtime.getURL(\"extension/replay-export/replay-export.html\");","    chrome.tabs.create({ url, active: true });","  }","});","","// ======================================================","// âœ… SINGLE handler for selective area capture","// ======================================================","let captureInProgress = false;","","chrome.runtime.onMessage.addListener(async (msg, sender, sendResponse) => {","  if (msg.action !== \"HIDE_OVERLAY_AND_CAPTURE\") return;","","  if (captureInProgress) {","    console.warn(\"[BugSense] Capture already in progress, skipping duplicate\");","    return;","  }","  captureInProgress = true;","","  try {","    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });","    if (!tab?.windowId) throw new Error(\"No active tab\");","","    // Make sure overlay disappears visually","    try {","      await chrome.scripting.executeScript({","        target: { tabId: tab?.id ?? 0 },","        func: () =>","          new Promise<void>((resolve) => {","            requestAnimationFrame(() => {","              document.body.offsetHeight; // flush paint","              resolve();","            });","          }),","      });","    } catch (err) {","      console.warn(\"[BugSense] Repaint script failed:\", err);","    }","","    await new Promise((r) => setTimeout(r, 150));","","    // Do the capture (no sendResponse, pure async)","    const dataUrl = await new Promise<string>((resolve, reject) => {","      chrome.tabs.captureVisibleTab(tab.windowId, { format: \"png\" }, (url) => {","        if (chrome.runtime.lastError || !url)","          reject(chrome.runtime.lastError?.message || \"captureVisibleTab failed\");","        else resolve(url);","      });","    });","","    const blob = await (await fetch(dataUrl)).blob();","    const bitmap = await createImageBitmap(blob);","    const scale = self.devicePixelRatio || 1;","    const canvas = new OffscreenCanvas(msg.rect.width, msg.rect.height);","    const ctx = canvas.getContext(\"2d\");","    if (!ctx) throw new Error(\"No OffscreenCanvas context\");","","    ctx.drawImage(","      bitmap,","      msg.rect.x * scale,","      msg.rect.y * scale,","      msg.rect.width * scale,","      msg.rect.height * scale,","      0,","      0,","      msg.rect.width,","      msg.rect.height","    );","    bitmap.close();","","    const croppedBlob = await canvas.convertToBlob({ type: \"image/png\", quality: 1 });","    const reader = new FileReader();","    reader.onload = () => {","      chrome.runtime.sendMessage({","        action: \"TRIGGER_BUG_CREATION_FROM_CONTEXT\",","        mode: \"selective\",","        screenshot: reader.result,","      });","      captureInProgress = false;","    };","    reader.readAsDataURL(croppedBlob);","  } catch (err) {","    console.error(\"[BugSense] Selective capture failed:\", err);","    captureInProgress = false;","  }","});",""]}],[8,{"id":8,"path":"/home/milan/Desktop/bug-sense/frontend/extension/components/DisplayButton.tsx","size":2873,"mtime":1762343896732.4648,"lines":["import React from 'react';","","// --- Helper Function ---","","/**"," * Calculates text color for a given OKLCH string."," * @param oklchColor - e.g., \"oklch(71.5% 0.143 215.221)\""," * @returns 'text-black' or 'text-white'"," */","function getTextColorForOklch(oklchColor: string): 'text-black' | 'text-white' {","    try {","        // Extracts the \"L\" value (lightness)","        const lightness = parseFloat(oklchColor.split('%')[0].split('(')[1]);","        // OKLCH Lightness is 0-100. Use black text on lighter backgrounds.","        return lightness > 60 ? 'text-black' : 'text-white';","    } catch (e) {","        console.error(\"Could not parse OKLCH string:\", oklchColor, e);","        return 'text-white'; // Default to white","    }","}","","// --- Color Definitions ---","","// 1. For Tailwind: Use underscores _ instead of spaces in arbitrary values","const colorClasses = {","    blue: 'bg-[oklch(70.7%_0.165_254.624)] hover:bg-[oklch(62.3%_0.214_259.815)]',","    green: 'bg-[oklch(79.2%_0.209_151.711)]   hover:bg-[oklch(72.3%_0.219_149.579)]',","    purple: 'bg-[oklch(71.4%_0.203_305.504)]  hover:bg-[oklch(62.7%_0.265_303.9)]',","    red: 'bg-[oklch(70.4%_0.191_22.216)]  hover:bg-[oklch(63.7%_0.237_25.331)]',","    slate: 'bg-[oklch(70.4%_0.04_256.788)] hover:bg-[oklch(55.4%_0.046_257.417)]',","","    dark: 'bg-[oklch(59.6%_0.145_163.225)] hover:bg-[oklch(50.8%_0.118_165.612)]',","}","","// 2. For Text-Contrast Helper: Use normal spaces","const baseColors = {","    blue: 'oklch(70.7% 0.165 254.624)',","    green: 'oklch(79.2% 0.209 151.711)',","    purple: 'oklch(71.4% 0.203 305.504)',","    red: 'oklch(70.4% 0.191 22.216)',","    slate: 'oklch(70.4% 0.04 256.788)',","","    dark: 'oklch(59.6% 0.145 163.225)',","}","","// Define the type for your color prop (adjust as needed)","type ButtonColor = 'blue' | 'green' | 'purple' | 'red' | 'slate' | 'dark';","","// --- Prop Interface ---","","interface buttonProps {","    name: string,","    title?: string,","    onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void,","    color: ButtonColor, // Use our specific color type","    disable?: boolean","}","","// --- Component ---","","function DisplayButton({ name, title = \"\", onClick = () => { }, color = \"slate\", disable = false }: buttonProps) {","","    // 1. Look up the Tailwind class string","    const buttonColorClasses = colorClasses[color];","","    // 2. Look up the base color and get the correct text color","    const baseOklch = baseColors[color];","    const textColorClass = getTextColorForOklch(baseOklch);","","    return (","        <button","            onClick={onClick}","            className={`","                w-full py-2 rounded-lg transition text-base","                ${buttonColorClasses}","                ${textColorClass}","                ${disable ? 'opacity-50 cursor-not-allowed' : ''}","            `}","            title={title}","            disabled={disable}","        >","            {name}","        </button>","    )","}","","export default DisplayButton;"]}],[9,{"id":9,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/consoleListener.ts","size":1651,"mtime":1762158655858.5977,"lines":["// extension/content/consoleListener.ts  (append or ensure similar exists)","(function () {","    const KEY = \"recentConsoleErrors\";","    function pushError(payload: any) {","        try {","            chrome.storage.local.get([KEY], (res) => {","                const arr = Array.isArray(res?.[KEY]) ? res[KEY] : [];","                arr.push({ ...payload, ts: Date.now() });","                // limit length","                const keep = arr.slice(-100);","                chrome.storage.local.set({ [KEY]: keep }, () => { });","            });","        } catch (err) {","            // ignore","        }","    }","","    // capture runtime errors","    window.addEventListener(\"error\", (ev: ErrorEvent) => {","        pushError({","            type: \"runtime\",","            message: ev.message,","            filename: ev.filename,","            lineno: ev.lineno,","            colno: ev.colno,","            stack: ev.error?.stack || null","        });","    });","","    // capture unhandled rejections","    window.addEventListener(\"unhandledrejection\", (ev) => {","        pushError({","            type: \"promise\",","            message: ev.reason?.message || String(ev.reason),","            detail: ev.reason,","            stack: ev.reason?.stack || null","        });","    });","","    // wrap console.error (best-effort, inside page)","    const origConsoleError = console.error?.bind(console) || ((...args: any[]) => { });","    console.error = function (...args: any[]) {","        try {","            pushError({ type: \"console\", message: args.map(x => (typeof x === \"string\" ? x : JSON.stringify(x))).join(\" \"), raw: args, ts: Date.now() });","        } catch { }","        origConsoleError(...args);","    };","})();",""]}],[10,{"id":10,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/duplicateBugDetector.ts","size":6107,"mtime":1762404832176.538,"lines":["// extension/content/duplicateBugDetector.ts","import { findDuplicates } from \"../ai/transformer\";","import { clearHighlights, getSheetData, highlightDuplicates } from \"../utils/sheetsAPI\";","import { addIgnoredPair, getIgnoredPairs, isIgnoredPair } from \"../utils/cache\";","","","console.log(\"%c[BugSense] AI Duplicate Bug Detector Active ðŸ§ \", \"color:#22d3ee\");","","async function initDuplicateDetector() {","  console.log(\"[BugSense] Fetching Google Sheets data via API...\");","","  // Extract spreadsheet ID from URL","  const match = window.location.href.match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","  const spreadsheetId = match ? match[1] : null;","","  if (!spreadsheetId) {","    console.error(\"[BugSense] Could not find spreadsheet ID in URL!\");","    return;","  }","","  try {","    // Fetch data from the sheet named 'bug_report'","    const sheetData: any = await getSheetData(spreadsheetId, \"bug_report!A1:Z1000\");","    const rows = sheetData.values || [];","","    console.log(`[BugSense] Retrieved ${rows.length} rows from Google Sheets âœ…`);","","    if (rows.length < 2) {","      console.warn(\"[BugSense] Not enough data rows to analyze duplicates.\");","      return;","    }","","    // Skip header row","    const header = rows[0];","    const dataRows = rows.slice(1);","","    // Prepare for duplicate detection","    const itemsForEmbedding = dataRows.map((cells: any, i: any) => ({","      id: i + 1,","      text: cells.join(\" . \")","    }));","","    // Find duplicates (via AI/semantic or string match)","    const dupResult = await findDuplicates(itemsForEmbedding, 0.86);","    const pairs = dupResult.pairs ?? [];","    // Filter out previously ignored pairs","    const ignored = await getIgnoredPairs();","    const filteredPairs = pairs.filter((p) => {","      const key = [p.i, p.j].sort().join(\"-\");","      return !ignored.includes(key);","    });","","    console.log(`[BugSense] ${filteredPairs.length} active duplicate pairs after ignoring cached ones.`);","","","    console.log(`[BugSense] Duplicate check complete â€” found ${pairs.length} pairs.`);","","    if (filteredPairs.length > 0) {","      // Call highlight function to mark them red","      await highlightDuplicates(spreadsheetId, rows, filteredPairs);","    }","","    // Show enhanced overlay summary","    renderOverlaySummary(filteredPairs, itemsForEmbedding.length);","  } catch (err) {","    console.error(\"[BugSense] Sheets API failed:\", err);","  }","}","","// ðŸ§© Enhanced overlay with row details","function renderOverlaySummary(pairs: any[], totalRows: number) {","  const overlay = document.createElement(\"div\");","  overlay.id = \"bugsense-summary\";","  Object.assign(overlay.style, {","    position: \"fixed\",","    right: \"12px\",","    bottom: \"12px\",","    background: \"#0b1220\",","    color: \"white\",","    padding: \"14px\",","    borderRadius: \"8px\",","    zIndex: \"999999\",","    width: \"340px\",","    fontFamily: \"Inter, sans-serif\",","    boxShadow: \"0 2px 8px rgba(0,0,0,0.25)\",","  });","","  const title = document.createElement(\"div\");","  title.innerText = \"ðŸ§  BugSense â€” Duplicate Verification\";","  title.style.fontWeight = \"bold\";","  title.style.marginBottom = \"6px\";","  overlay.appendChild(title);","","  const body = document.createElement(\"div\");","  if (pairs.length === 0) {","    body.innerText = \"âœ… No duplicates found!\";","  } else {","    const rowIndices: number[] = [];","    pairs.forEach((p: any) => rowIndices.push(p.i + 2, p.j + 2));","    const uniqueRows = [...new Set(rowIndices.sort((a, b) => a - b))];","    body.innerText = `âš ï¸ ${pairs.length} potential duplicates found (Rows ${uniqueRows.join(\", \")})`;","  }","  overlay.appendChild(body);","","  // ðŸ§© Add buttons","  const footer = document.createElement(\"div\");","  footer.style.marginTop = \"10px\";","  footer.style.display = \"flex\";","  footer.style.justifyContent = \"space-between\";","  footer.style.gap = \"8px\";","","  const confirmDup = document.createElement(\"button\");","  confirmDup.innerText = \"Confirm Duplicates\";","  Object.assign(confirmDup.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#22c55e\",","    color: \"white\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","","  });","","  confirmDup.onclick = async () => {","    alert(\"Duplicates confirmed. You can now remove them manually from your sheet.\");","    overlay.remove();","  };","","  const markNotDup = document.createElement(\"button\");","  markNotDup.innerText = \"Mark as Not Duplicates\";","  Object.assign(markNotDup.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#eab308\",","    color: \"#0b1220\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","  });","","  // inside the onclick:","  markNotDup.onclick = async () => {","    // cache as ignored","    for (const p of pairs) {","      await addIgnoredPair(p.i, p.j);","    }","","    // remove red highlight from Google Sheet","    try {","      const match = window.location.href.match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","      const spreadsheetId = match ? match[1] : null;","      if (spreadsheetId) {","        await clearHighlights(spreadsheetId, pairs);","      }","    } catch (err) {","      console.error(\"[BugSense] Failed to clear highlights:\", err);","    }","","    alert(\"Marked as not duplicates â€” highlights removed and will be skipped next time.\");","    overlay.remove();","  };","","  const close = document.createElement(\"button\");","  close.innerText = \"Close\";","  Object.assign(close.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#ef4444\",","    color: \"white\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","  });","  close.onclick = () => overlay.remove();","","  footer.appendChild(confirmDup);","  footer.appendChild(markNotDup);","  footer.appendChild(close);","  // ðŸ’¡ Tip section (ðŸ‘‰ append here, before the footer)","  const tip = document.createElement(\"div\");","  tip.innerHTML = \"<small>ðŸ’¡ Tip: Once confirmed, open your sheet and delete marked rows manually to keep it clean.</small>\";","  tip.style.marginTop = \"8px\";","  tip.style.color = \"#9ca3af\";","  overlay.appendChild(tip);","","  overlay.appendChild(footer);","","  document.body.appendChild(overlay);","}","","// Auto-run on load","if (document.readyState === \"complete\") {","  initDuplicateDetector();","} else {","  window.addEventListener(\"load\", initDuplicateDetector);","}",""]}],[11,{"id":11,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/replayListener.ts","size":14387,"mtime":1762154365735.203,"lines":["// extension/content/replayListener.ts","// Content script for Bug Sense: Records user actions, captures tab snapshots, and","// persists replay data. Designed to survive SPA navigation & avoid context invalidation errors.","","type ActionEvent = {","    type: \"click\" | \"keypress\";","    timestamp: number;","    details: any;","};","","// Configuration constants","const MAX_BUFFER_TIME = 60000; // 60s window of actions","const SCREENSHOT_THROTTLE_MS = 2000; // capture every 2 seconds","const MAX_SCREENSHOTS = 30; // store last 30 frames (~60s)","","let actions: ActionEvent[] = [];","let lastScreenshotTime = 0;","","console.log(\"[BugSense Replay Listener] active âœ…\");","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Safe chrome.storage.set wrapper to avoid â€œExtension context invalidatedâ€ errors","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function safeStorageSet(obj: Record<string, any>) {","    try {","        if (!chrome?.storage?.local) return; // context may be invalid","        chrome.storage.local.set(obj, () => {","            if (chrome.runtime?.lastError) {","                console.warn(\"[BugSense] safeStorageSet warning:\", chrome.runtime.lastError.message);","            }","        });","    } catch (err) {","        if (String(err).includes(\"Extension context invalidated\")) {","            console.log(\"[BugSense] Context invalidated â€” skipping write (safe)\");","            return;","        }","        console.warn(\"[BugSense] safeStorageSet exception:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Core persistence helpers","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","async function persistActions() {","    try {","        safeStorageSet({ recentActions: actions });","    } catch (err) {","        console.warn(\"[BugSense] persistActions error:\", err);","    }","}","","async function persistScreenshotIfAvailable(screenshotDataUrl?: string) {","    if (!screenshotDataUrl) return;","    try {","        chrome.storage.local.get([\"recentScreenshots\"], (res) => {","            const existing: Array<{ screenshot: string; timestamp: number }> =","                Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const appended = [...existing, { screenshot: screenshotDataUrl, timestamp: Date.now() }].slice(-MAX_SCREENSHOTS);","            safeStorageSet({ recentScreenshots: appended });","        });","    } catch (err) {","        console.warn(\"[BugSense] persistScreenshotIfAvailable exception:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Utility: prune old events","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function pruneOld() {","    const now = Date.now();","    actions = actions.filter((a) => now - a.timestamp < MAX_BUFFER_TIME);","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Screenshot capture (request background via message)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","// async function requestCaptureFrame(): Promise<string | null> {","//     try {","//         return await new Promise((resolve) => {","//             try {","//                 chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","//                     if (chrome.runtime.lastError) {","//                         console.warn(\"[replayListener] CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","//                         resolve(null);","//                         return;","//                     }","//                     if (resp?.success && resp.screenshot) {","//                         resolve(resp.screenshot as string);","//                         return;","//                     }","//                     resolve(null);","//                 });","//             } catch (err) {","//                 console.warn(\"[replayListener] CAPTURE_FRAME sendMessage exception:\", err);","//                 resolve(null);","//             }","//         });","//     } catch (err) {","//         console.warn(\"[replayListener] requestCaptureFrame outer error:\", err);","//         return null;","//     }","// }","async function requestCaptureFrame(): Promise<string | null> {","    try {","        if (!chrome.runtime?.id) {","            console.log(\"[replayListener] Extension context invalidated â€” skipping CAPTURE_FRAME\");","            return null; // ðŸ‘ˆ return explicit null instead of undefined","        }","","        const result = await new Promise<string | null>((resolve) => {","            try {","                chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","                    if (chrome.runtime.lastError) {","                        console.warn(\"[replayListener] CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","                        resolve(null);","                        return;","                    }","","                    if (resp?.success && resp.screenshot) {","                        resolve(resp.screenshot as string);","                        return;","                    }","","                    resolve(null);","                });","            } catch (err) {","                console.warn(\"[replayListener] CAPTURE_FRAME sendMessage exception:\", err);","                resolve(null);","            }","        });","","        return result; // âœ… ensures Promise<string | null> consistency","","    } catch (err) {","        if (String(err).includes(\"Extension context invalidated\")) {","            console.log(\"[replayListener] Safe ignore: context invalidated\");","            return null; // ðŸ‘ˆ always return null to match type","        } else {","            console.warn(\"[replayListener] requestCaptureFrame outer error:\", err);","            return null;","        }","    }","}","","","async function maybeCapture() {","    try {","        const now = Date.now();","        if (now - lastScreenshotTime < SCREENSHOT_THROTTLE_MS) return;","        lastScreenshotTime = now;","        const screenshot = await requestCaptureFrame();","        if (screenshot) await persistScreenshotIfAvailable(screenshot);","    } catch (err) {","        console.warn(\"[replayListener] maybeCapture error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Event handlers","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","async function handleClick(e: MouseEvent) {","    try {","        const target = e.target as HTMLElement | null;","        const details = {","            tag: target?.tagName || \"unknown\",","            text: target?.innerText?.slice(0, 100) ?? null,","            x: e.clientX,","            y: e.clientY,","        };","        actions.push({ type: \"click\", timestamp: Date.now(), details });","        pruneOld();","        persistActions();","        await maybeCapture();","    } catch (err) {","        console.warn(\"[replayListener] handleClick error:\", err);","    }","}","","async function handleKeypress(e: KeyboardEvent) {","    try {","        const details = { key: e.key };","        actions.push({ type: \"keypress\", timestamp: Date.now(), details });","        pruneOld();","        persistActions();","        await maybeCapture();","    } catch (err) {","        console.warn(\"[replayListener] handleKeypress error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Listener management","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function addListeners() {","    try {","        window.addEventListener(\"click\", handleClick, true);","        window.addEventListener(\"keypress\", handleKeypress, true);","        console.log(\"[BugSense Replay Listener] listeners attached\");","    } catch (err) {","        console.warn(\"[replayListener] addListeners error:\", err);","    }","}","","function removeListeners() {","    try {","        window.removeEventListener(\"click\", handleClick, true);","        window.removeEventListener(\"keypress\", handleKeypress, true);","        console.log(\"[BugSense Replay Listener] listeners removed\");","    } catch (err) {","        console.warn(\"[replayListener] removeListeners error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Initialization logic","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function init() {","    try {","        chrome.storage.local.get([\"recentActions\", \"recentScreenshots\"], (res) => {","            try {","                const existing: ActionEvent[] = Array.isArray(res?.recentActions) ? res.recentActions : [];","                actions = existing.filter((a) => Date.now() - a.timestamp < MAX_BUFFER_TIME);","            } catch {","                actions = [];","            }","        });","    } catch (err) {","        console.warn(\"[replayListener] init storage get error:\", err);","    }","    addListeners();","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Handle page lifecycle events (SPA/bfcache friendly)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","window.addEventListener(\"pageshow\", (ev: PageTransitionEvent) => {","    try {","        console.log(\"[replayListener] pageshow (persisted=\" + (ev.persisted ? \"yes\" : \"no\") + \")\");","        removeListeners();","        init();","    } catch (err) {","        console.warn(\"[replayListener] pageshow handler error:\", err);","    }","});","","window.addEventListener(\"pagehide\", () => {","    try {","        removeListeners();","    } catch (err) {","        console.warn(\"[replayListener] pagehide handler error:\", err);","    }","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Cleanup and trimming on unload (prevent memory bloat)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","window.addEventListener(\"beforeunload\", () => {","    try {","        chrome.storage.local.get([\"recentScreenshots\"], (res) => {","            const arr = Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const trimmed = arr.slice(-MAX_SCREENSHOTS);","            safeStorageSet({ recentScreenshots: trimmed });","        });","    } catch { }","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Message listener for replay requests","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","chrome.runtime.onMessage.addListener((msg, _sender, sendResponse) => {","    try {","        if (msg?.action === \"GET_REPLAY_LOGS\") {","            pruneOld();","            sendResponse({ success: true, actions: actions.slice() });","        }","    } catch (err) {","        console.warn(\"[replayListener] onMessage handler error:\", err);","        try {","            sendResponse({ success: false, error: String(err) });","        } catch { }","    }","    return true;","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Initialize script","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","init();",""]}],[12,{"id":12,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/selectionOverlay.ts","size":4122,"mtime":1762436994817.075,"lines":["// extension/content/selectionOverlay.ts","type SelectionRect = { x: number; y: number; width: number; height: number };","","let overlay: HTMLDivElement | null = null;","let box: HTMLDivElement | null = null;","let active = false;","let cleaned = false;","","function createOverlay(): void {","    overlay = document.createElement(\"div\");","    Object.assign(overlay.style, {","        position: \"fixed\",","        inset: \"0\",","        background: \"rgba(0,0,0,0.25)\",","        cursor: \"crosshair\",","        zIndex: \"2147483647\",","        userSelect: \"none\",","        touchAction: \"none\",","    } as Partial<CSSStyleDeclaration>);","","    box = document.createElement(\"div\");","    Object.assign(box.style, {","        position: \"absolute\",","        border: \"2px dashed #00bfff\",","        background: \"rgba(0, 191, 255, 0.12)\",","        boxSizing: \"border-box\",","        pointerEvents: \"none\",","    } as Partial<CSSStyleDeclaration>);","","    overlay.appendChild(box);","    document.documentElement.appendChild(overlay);","}","","function hardRemoveOverlay() {","    if (overlay) overlay.remove();","    overlay = null;","    box = null;","    active = false;","    cleaned = true;","}","","function startSingleSelection(): void {","    if (active) return;","    active = true;","    cleaned = false;","","    createOverlay();","","    let startX = 0;","    let startY = 0;","    let currentPointerId: number | null = null;","","    const onPointerDown = (ev: PointerEvent) => {","        if (ev.button !== 0) return;","","        ev.preventDefault();","        startX = ev.clientX;","        startY = ev.clientY;","        currentPointerId = ev.pointerId;","","        Object.assign(box!.style, {","            left: `${startX}px`,","            top: `${startY}px`,","            width: \"0px\",","            height: \"0px\",","        });","","        try {","            (ev.target as Element).setPointerCapture(ev.pointerId);","        } catch { }","","        window.addEventListener(\"pointermove\", onPointerMove);","        window.addEventListener(\"pointerup\", onPointerUp);","        window.addEventListener(\"pointercancel\", onPointerCancel);","    };","","    const onPointerMove = (ev: PointerEvent) => {","        if (currentPointerId !== ev.pointerId) return;","","        const endX = ev.clientX;","        const endY = ev.clientY;","","        const x = Math.min(startX, endX);","        const y = Math.min(startY, endY);","        const w = Math.abs(endX - startX);","        const h = Math.abs(endY - startY);","","        Object.assign(box!.style, {","            left: `${x}px`,","            top: `${y}px`,","            width: `${w}px`,","            height: `${h}px`,","        });","    };","","    const cleanupListeners = () => {","        window.removeEventListener(\"pointermove\", onPointerMove);","        window.removeEventListener(\"pointerup\", onPointerUp);","        window.removeEventListener(\"pointercancel\", onPointerCancel);","    };","","    const onPointerUp = (ev: PointerEvent) => {","        if (currentPointerId !== ev.pointerId) return;","","        cleanupListeners();","","        const endX = ev.clientX;","        const endY = ev.clientY;","        const rect: SelectionRect = {","            x: Math.min(startX, endX),","            y: Math.min(startY, endY),","            width: Math.abs(endX - startX),","            height: Math.abs(endY - startY),","        };","","        // ðŸš€ Hide overlay instantly (no transparency seen in capture)","        if (overlay) overlay.style.display = \"none\";","","        // Notify background itâ€™s safe to capture","        chrome.runtime.sendMessage({ action: \"HIDE_OVERLAY_AND_CAPTURE\", rect });","","        // Then hard-remove overlay after short delay (cleanup DOM)","        setTimeout(hardRemoveOverlay, 300);","    };","","    const onPointerCancel = () => {","        cleanupListeners();","        hardRemoveOverlay();","    };","","    const onKeyDown = (ev: KeyboardEvent) => {","        if (ev.key === \"Escape\") {","            cleanupListeners();","            hardRemoveOverlay();","        }","    };","","    overlay!.addEventListener(\"pointerdown\", onPointerDown);","    window.addEventListener(\"keydown\", onKeyDown);","}","","/** Listener entry */","chrome.runtime.onMessage.addListener((msg) => {","    if (msg.action === \"START_SELECTIVE_CAPTURE\") {","        startSingleSelection();","    }","});",""]}],[13,{"id":13,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/DevPanel.tsx","size":21295,"mtime":1762437153942.1208,"lines":["// extension/devtools/DevPanel.tsx","import React, { useEffect, useState, useCallback } from \"react\";","// import { analyzeBug } from \"../ai/analyze\";","import { FaRegCopy } from \"react-icons/fa\";","import { getFormattedDate } from \"../utils/formattedDate\";","","import { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";","import { atomDark } from \"react-syntax-highlighter/dist/esm/styles/prism\";","// ------------------------------------------","","type ConsoleErrorItem = {","  ts: number;","  type: string;","  message: string;","  filename?: string;","  lineno?: number;","  colno?: number;","  stack?: string | null;","  raw?: any;","};","","type BugClipboard = {","  title: string;","  description: string;","  steps: string[];","  screenshotDataUrl?: string | null;","  createdAt: string;","  source: { type: \"console\" | \"selection\" | \"image\" | \"link\"; raw: any };","  replayActions?: any[];","};","","","","export default function DevPanel() {","  const [errors, setErrors] = useState<ConsoleErrorItem[]>([]);","  const [loading, setLoading] = useState(false);","  const [message, setMessage] = useState<string | null>(null);","  const [successBanner, setSuccessBanner] = useState(false);","  const [clipboardData, setClipboardData] = useState<BugClipboard | null>(null);","  const [isPreviewVisible, setIsPreviewVisible] = useState(false);","","  const [showExtraModal, setShowExtraModal] = useState(false);","  const [extraText, setExtraText] = useState(\"\");","  const [onExtraConfirm, setOnExtraConfirm] = useState<null | ((text: string | null) => void)>(null);","","  // ... (All your useEffects and functions from createBug... to insertIntoSheet... are unchanged) ...","","  useEffect(() => {","    const load = () => {","      chrome.storage.local.get([\"recentConsoleErrors\"], (res) => {","        const arr = Array.isArray(res?.recentConsoleErrors) ? res.recentConsoleErrors : [];","        setErrors(arr.slice(-200).reverse());","      });","    };","    load();","    const onChange = (changes: any, areaName: string) => {","      if (changes.recentConsoleErrors) {","        const arr = Array.isArray(changes.recentConsoleErrors.newValue) ? changes.recentConsoleErrors.newValue : [];","        setErrors(arr.slice(-200).reverse());","      }","      if (changes.bugClipboard && areaName === \"local\") {","        setSuccessBanner(true);","        setTimeout(() => setSuccessBanner(false), 3000);","      }","    };","    chrome.storage.onChanged.addListener(onChange);","    return () => chrome.storage.onChanged.removeListener(onChange);","  }, []);","","  // Ask user for additional bug details (optional)","  function promptForExtraDetails(): Promise<string | null> {","    return new Promise((resolve) => {","      setExtraText(\"\");","      setOnExtraConfirm(() => resolve);","      setShowExtraModal(true);","    });","  }","","  const captureScreenshot = useCallback(async (mode: \"full\" | \"selective\" = \"full\") => {","    if (mode === \"selective\") {","      return new Promise<string | null>((resolve) => {","        const listener = (msg: any) => {","          if (msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" && msg.mode === \"selective\" && msg.screenshot) {","            chrome.runtime.onMessage.removeListener(listener);","            resolve(msg.screenshot);","          }","        };","        chrome.runtime.onMessage.addListener(listener);","      });","    }","","    // Default full-screen capture","    return new Promise<string | null>((resolve) => {","      chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","        if (chrome.runtime.lastError) {","          console.warn(\"CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","          resolve(null);","        } else {","          resolve(resp?.screenshot || null);","        }","      });","    });","  }, []);","","  const getReplayActions = useCallback(async () => {","    return new Promise<any[]>((resolve) => {","      chrome.runtime.sendMessage({ action: \"GET_REPLAY_LOGS\" }, (resp) => {","        if (chrome.runtime.lastError) resolve([]);","        else resolve(resp?.actions || []);","      });","    });","  }, []);","","  const callAIForBug = useCallback(async (","    source: {","      console?: ConsoleErrorItem;","      selectionText?: string;","      srcUrl?: string;","      linkUrl?: string;","      extraDetails?: string | null; // âœ… new field","    },","    screenshot: string | null,","    replayActions: any[]","  ) => {","    try {","      setMessage(\"ðŸ¤– Sending data to BugSense AI backend...\");","      const response = await fetch(\"http://localhost:3000/ai/analyze\", {","        method: \"POST\",","        headers: { \"Content-Type\": \"application/json\" },","        body: JSON.stringify({","          ...source,","          screenshot,","          replayActions,","          extraDetails: source.extraDetails || null,","        }),","      });","","      if (!response.ok) {","        const text = await response.text();","        throw new Error(`AI backend error: ${text}`);","      }","","      const ai = await response.json();","      console.log(\"[BugSense AI] Response from backend:\", ai);","      return ai;","    } catch (err) {","      console.error(\"AI backend call failed:\", err);","      const message =","        source.console?.message ||","        source.selectionText ||","        source.srcUrl ||","        source.linkUrl ||","        \"Bug captured (AI unavailable)\";","      return {","        title: `Bug Report: ${String(message).slice(0, 120)}`,","        description: source.console?.stack || message || \"Bug captured manually\",","        steps: [","          \"1. Observe the error or selected text\",","          \"2. Reproduce steps from replay buffer\",","        ],","      };","    }","  }, []);","","","  const createBugFromError = useCallback(async (item: ConsoleErrorItem) => {","    setLoading(true);","    setMessage(\"Capturing screenshot...\");","    try {","      const screenshot = await captureScreenshot();","      setMessage(\"Fetching recent replay actions...\");","      const replayActions = await getReplayActions();","      // ðŸ§  Ask user for optional details","      const extraDetails = await promptForExtraDetails();","      setMessage(\"ðŸ¤– Analyzing with BugSense AI... This may take a few seconds â³\");","","      const ai = await callAIForBug(","        { console: item, extraDetails },","        screenshot,","        replayActions","      );","","      const bug: BugClipboard = {","        title: ai.title,","        description: ai.description,","        steps: ai.steps || [],","        screenshotDataUrl: screenshot,","        createdAt: getFormattedDate(),","        source: { type: \"console\", raw: item },","        replayActions,","      };","","      await new Promise((res) => chrome.storage.local.set({ bugClipboard: bug }, () => res(true)));","      setMessage(\"Bug created and saved to BugSense clipboard âœ…\");","      setLoading(false);","      return bug;","    } catch (err) {","      console.error(err);","      setMessage(\"Failed to create bug: \" + String(err));","      setLoading(false);","    }","  }, [captureScreenshot, getReplayActions, callAIForBug]);","","  const createBugFromContext = useCallback(async (context: { selectionText?: string, srcUrl?: string, linkUrl?: string }) => {","    setLoading(true);","    setMessage(\"Capturing screenshot for UI bug...\");","    try {","      const screenshot = await captureScreenshot();","      setMessage(\"Fetching recent replay actions...\");","      const replayActions = await getReplayActions();","      // ðŸ§  Ask user for optional details","      const extraDetails = await promptForExtraDetails();","      setMessage(\"ðŸ¤– Analyzing UI bug with BugSense AI... â³\");","","      const ai = await callAIForBug({ ...context, extraDetails }, screenshot, replayActions);","","","      let rawSource = context.selectionText","        ? { type: \"selection\" as const, raw: { text: context.selectionText } }","        : context.srcUrl","          ? { type: \"image\" as const, raw: { srcUrl: context.srcUrl } }","          : context.linkUrl","            ? { type: \"link\" as const, raw: { linkUrl: context.linkUrl } }","            : { type: \"selection\" as const, raw: { text: \"Unknown context\" } };","","      const bug: BugClipboard = {","        title: ai.title,","        description: ai.description,","        steps: ai.steps || [],","        screenshotDataUrl: screenshot,","        createdAt: getFormattedDate(),","        source: rawSource,","        replayActions,","      };","","      await new Promise((res) => chrome.storage.local.set({ bugClipboard: bug }, () => res(true)));","      setMessage(\"Bug created and saved to BugSense clipboard âœ…\");","      setLoading(false);","      return bug;","    } catch (err) {","      console.error(err);","      setMessage(\"Failed to create bug: \" + String(err));","      setLoading(false);","    }","  }, [captureScreenshot, getReplayActions, callAIForBug]);","","  useEffect(() => {","    const messageListener = (msg: any) => {","      // For existing context menu trigger","      if (","        msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" &&","        (msg.selectionText || msg.srcUrl || msg.linkUrl)","      ) {","        createBugFromContext({","          selectionText: msg.selectionText,","          srcUrl: msg.srcUrl,","          linkUrl: msg.linkUrl,","        });","      }","","      // ðŸ§© NEW: Handle selective screenshot trigger","      if (msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" && msg.mode === \"selective\" && msg.screenshot) {","        (async () => {","          setMessage(\"Capturing selected area...\");","          const replayActions = await getReplayActions();","          const extraDetails = await promptForExtraDetails();","","          setMessage(\"Analyzing selective screenshot with BugSense AI...\");","","          const ai = await callAIForBug({ extraDetails }, msg.screenshot, replayActions);","","          const bug: BugClipboard = {","            title: ai.title,","            description: ai.description,","            steps: ai.steps || [],","            screenshotDataUrl: msg.screenshot,","            createdAt: getFormattedDate(),","            source: { type: \"selection\", raw: {} },","            replayActions,","          };","","          await new Promise((res) =>","            chrome.storage.local.set({ bugClipboard: bug }, () => res(true))","          );","","          setMessage(\"Selective area bug captured âœ…\");","          setSuccessBanner(true);","          setTimeout(() => setSuccessBanner(false), 3000);","        })();","      }","    };","","    chrome.runtime.onMessage.addListener(messageListener);","    return () => chrome.runtime.onMessage.removeListener(messageListener);","  }, [createBugFromContext, getReplayActions, callAIForBug]);","","","  async function insertIntoSheet(bug: BugClipboard) {","    try {","      const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });","      let spreadsheetId: string | null = null;","      if (tab?.url) {","        const m = String(tab.url).match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","        spreadsheetId = m ? m[1] : null;","      }","      if (!spreadsheetId) {","        const input = prompt(\"Enter target Google Spreadsheet ID (or click Cancel to abort)\");","        if (!input) return;","        spreadsheetId = input;","      }","","      const range = \"bug_report!A1:Z1\";","      const row = [","        bug.title,","        bug.description,","        (bug.steps || []).join(\"\\n\"),","        bug.screenshotDataUrl ? \"screenshot_attached\" : \"\",","        new Date(bug.createdAt).toISOString(),","        \"Bug Sense\",","      ];","","      setMessage(\"Appending row to spreadsheet...\");","      chrome.runtime.sendMessage({ action: \"APPEND_SHEET_ROW\", sheetId: spreadsheetId, range, row }, (resp) => {","        if (chrome.runtime.lastError) {","          setMessage(\"Append failed: \" + chrome.runtime.lastError.message);","          return;","        }","        if (resp?.success) setMessage(\"Row appended âœ…\");","        else setMessage(\"Append failed: \" + JSON.stringify(resp?.error || \"unknown\"));","      });","    } catch (err) {","      console.error(err);","      setMessage(\"Insert error: \" + String(err));","    }","  }","","  const handlePreviewClick = () => {","    if (isPreviewVisible) {","      setIsPreviewVisible(false);","    } else {","      chrome.storage.local.get([\"bugClipboard\"], (res) => {","        setClipboardData(res?.bugClipboard || null);","        setIsPreviewVisible(true);","      });","    }","  };","","  const handleCopyToClipboard = () => {","    if (clipboardData) {","      const dataToCopy = { ...clipboardData };","      if (dataToCopy.screenshotDataUrl) {","        delete dataToCopy.screenshotDataUrl;","      }","      const jsonString = JSON.stringify(dataToCopy, null, 2);","      try {","        const tempTextArea = document.createElement(\"textarea\");","        tempTextArea.value = jsonString;","        tempTextArea.style.position = \"absolute\";","        tempTextArea.style.left = \"-9999px\";","        document.body.appendChild(tempTextArea);","        tempTextArea.select();","        document.execCommand(\"copy\");","        // Clean up","        document.body.removeChild(tempTextArea);","        setMessage(\"Clipboard JSON copied! âœ…\");","      } catch (err) {","        console.error(\"Failed to copy text: \", err);","        setMessage(\"Failed to copy to clipboard.\");","      }","    }","  };","","  // âœ… --- THIS IS THE CORRECTED STYLE ---","  return (","    <div style={{","      padding: 12,","      width: '100%', // Takes full width of its parent","      // maxWidth: 420, // <-- REMOVED THIS","      // margin: '0 auto', // <-- REMOVED THIS","      fontFamily: \"Inter, Roboto, sans-serif\",","      background: \"#0B1220\",","      color: \"#e0e0e0\",","      minHeight: \"100vh\",","      boxSizing: 'border-box' // Keep padding from breaking layout","    }}>","      {/* ... (rest of the component is unchanged) ... */}","      <div className=\"text-lg font-semibold text-gray-400 mb-2 flex items-center\" >","        <img","          src=\"../icons/icon48.png\"","          alt=\"Bug Sense icon\"","          style={{","            marginRight: 8,","            width: 20,","            height: 20","          }}","        />","        <div>Bug Sense â€” Console captures</div>","      </div>","","      <div style={{ marginBottom: 8, color: \"#a0a0a0\", fontSize: 12 }}>","        Select a console message to create an AI-generated bug report. Uses instant screenshot + replay buffer.","      </div>","","      {successBanner && (","        <div","          style={{","            background: \"#1a911a\",","            color: \"#ffffff\",","            padding: \"6px 10px\",","            borderRadius: 6,","            fontSize: 13,","            marginBottom: 10,","          }}","        >","          âœ… Bug captured successfully!","        </div>","      )}","","      <div style={{","        maxHeight: 320,","        overflow: \"auto\",","        border: \"1px solid #444\",","        padding: 8,","        borderRadius: 6,","        background: \"#252525\"","      }}>","        {errors.length === 0 && <div style={{ color: \"#888\" }}>No captured console messages (open site & reproduce)</div>}","        {errors.map((e, idx) => (","          <div key={e.ts + \"-\" + idx} style={{","            marginBottom: 8,","            padding: 8,","            borderRadius: 6,","            background: \"#3c3c3c\",","            boxShadow: \"0 0 0 1px #444 inset\"","          }}>","            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>","              <div style={{ fontSize: 13, fontWeight: 600, color: \"#f0f0f0\" }}>{String(e.message).slice(0, 120)}</div>","              <div style={{ fontSize: 11, color: \"#b0b0b0\" }}>{new Date(e.ts).toLocaleTimeString()}</div>","            </div>","            <div style={{ marginTop: 6, fontSize: 12, color: \"#cccccc\", whiteSpace: \"pre-wrap\" }}>{e.stack || (e.raw ? JSON.stringify(e.raw) : \"\")}</div>","","            <div style={{ marginTop: 8 }}>","              <button","                onClick={async () => {","                  setMessage(\"Creating bug...\");","                  const bug = await createBugFromError(e as ConsoleErrorItem);","                  if (bug) {","                    const ok = confirm(\"Bug created and saved to clipboard. Insert into sheet now?\");","                    if (ok) insertIntoSheet(bug);","                  }","                }}","                disabled={loading}","                style={{","                  marginRight: 8,","                  background: \"#3a7dff\",","                  color: \"white\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  border: \"none\",","                  cursor: \"pointer\"","                }}","              >","                Create bug from this error","              </button>","            </div>","          </div>","        ))}","      </div>","","      <div style={{ marginTop: 12 }}>","        <button","          onClick={handlePreviewClick}","          style={{","            background: \"#555\",","            color: \"#f0f0f0\",","            padding: \"6px 10px\",","            borderRadius: 6,","            border: \"1px solid #666\",","            cursor: \"pointer\"","          }}","        >","          {isPreviewVisible ? \"Hide clipboard\" : \"Preview clipboard\"}","        </button>","      </div>","","      <div style={{ marginTop: 10 }}>","        <div style={{ fontSize: 12, color: \"#a0a0a0\" }}>{message}</div>","      </div>","","      {isPreviewVisible && (","        <div style={{","          marginTop: 20,","          background: \"#252525\",","          border: \"1px solid #444\",","          borderRadius: 4,","          maxHeight: 400,","          overflow: \"auto\"","        }}>","          <h4 className=\"sticky top-0\" style={{","            margin: 0,","            padding: \"8px 12px\",","            borderBottom: \"1px solid #444\",","            background: \"#333\",","            fontSize: 13,","            fontWeight: 600,","            color: \"#f0f0f0\",","            display: \"flex\",","            alignItems: \"center\",","            justifyContent: \"space-between\"","          }}>","            Clipboard Contents","            <FaRegCopy","              onClick={handleCopyToClipboard}","              style={{ cursor: \"pointer\", fontSize: 14, color: \"#f0f0f0\" }}","              title=\"Copy JSON (raw)\"","            />","          </h4>","","          {clipboardData?.screenshotDataUrl && (","            <div style={{ padding: 12, borderBottom: '1px solid #444', background: '#333' }}>","              <img","                src={clipboardData.screenshotDataUrl}","                alt=\"Bug Screenshot\"","                style={{ width: '100%', borderRadius: 4, border: '1px solid #555' }}","                title=\"Right-click to copy or save this image\"","              />","            </div>","          )}","","          <SyntaxHighlighter","            language=\"json\"","            style={atomDark}","            customStyle={{","              margin: 0,","              padding: \"12px\",","              fontSize: \"11px\",","              whiteSpace: \"pre-wrap\",","              wordBreak: \"break-all\",","              background: \"#2d2d2d\"","            }}","          >","            {(() => {","              if (!clipboardData) return \"No clipboard data found.\";","              const displayData = { ...clipboardData };","              if (displayData.screenshotDataUrl) {","                delete displayData.screenshotDataUrl;","              }","              return JSON.stringify(displayData, null, 2);","            })()}","          </SyntaxHighlighter>","        </div>","      )}","","      {showExtraModal && (","        <div","          style={{","            position: \"fixed\",","            inset: 0,","            background: \"rgba(0,0,0,0.7)\",","            display: \"flex\",","            alignItems: \"center\",","            justifyContent: \"center\",","            zIndex: 9999,","          }}","        >","          <div","            style={{","              background: \"#0B1220\",","              color: \"white\",","              padding: 20,","              borderRadius: 8,","              width: \"90%\",","              maxWidth: 400,","              boxShadow: \"0 0 10px rgba(0,0,0,0.5)\",","            }}","          >","            <h3 style={{ marginTop: 0 }}>ðŸ“ Add Extra Details (optional)</h3>","            <textarea","              value={extraText}","              onChange={(e) => setExtraText(e.target.value)}","              placeholder=\"Describe more about the issue, environment, or special conditions (optional)...\"","              style={{","                width: \"100%\",","                height: 120,","                padding: 8,","                borderRadius: 6,","                border: \"1px solid #333\",","                background: \"#1b1f2b\",","                color: \"#eee\",","                resize: \"none\",","                fontSize: 13,","                fontFamily: \"Inter, sans-serif\",","              }}","            />","            <div style={{ display: \"flex\", justifyContent: \"flex-end\", gap: 8, marginTop: 10 }}>","              <button","                style={{","                  background: \"#555\",","                  color: \"#fff\",","                  border: \"none\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  cursor: \"pointer\",","                }}","                onClick={() => {","                  setShowExtraModal(false);","                  if (onExtraConfirm) onExtraConfirm(null);","                }}","              >","                Skip","              </button>","              <button","                style={{","                  background: \"#3a7dff\",","                  color: \"white\",","                  border: \"none\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  cursor: \"pointer\",","                }}","                onClick={() => {","                  setShowExtraModal(false);","                  if (onExtraConfirm) onExtraConfirm(extraText.trim() || null);","                }}","              >","                Send","              </button>","            </div>","          </div>","        </div>","      )}","","    </div>","  );","}"]}],[14,{"id":14,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/main.tsx","size":418,"mtime":1762257355590.9172,"lines":["import React from \"react\";","import ReactDOM from \"react-dom/client\";","import DevPanel from \"./DevPanel\";","","// import { initAI } from \"../ai/analyze\";","","// initAI().then(() => console.log(\"[BugSense AI] model ready âœ…\"));","","","ReactDOM.createRoot(document.getElementById(\"root\") as HTMLElement).render(","  <React.StrictMode>","    <DevPanel />","  </React.StrictMode>",");","","console.log(\"[BugSense] DevTools React app mounted âœ…\");",""]}],[15,{"id":15,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/register.ts","size":261,"mtime":1762232260287.808,"lines":["// extension/devtools/register.ts","","chrome.devtools.panels.create(","  \"Bug Sense\", // tab title in DevTools","  \"extension/icons/icon48.png\", // <--- FIX 1: Make this path root-relative","  \"extension/devtools/index.html\" // <--- FIX 2: This is the critical change",");"]}],[16,{"id":16,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/App.tsx","size":1923,"mtime":1762414252687.914,"lines":["import React, { useState } from \"react\";","import ScreenshotTool from \"./components/ScreenshotTool\";","import RecorderTool from \"./components/RecorderTool\";","import MarkerTool from \"./components/MarkerTool\";","import GifMaker from \"./components/GifMaker\";","import InstantReplay from \"./components/InstantReplay\";","","export default function App() {","  const [activeTool, setActiveTool] = useState<\"home\" | \"marker\">(\"home\");","  const [annotateImage, setAnnotateImage] = useState<string | null>(null);","","  const handleAnnotate = (image: string) => {","    setAnnotateImage(image);","    setActiveTool(\"marker\");","  };","","  // Header used for both main and marker views to keep consistent spacing","  const Header = () => (","    <div className=\"flex items-center justify-between\">","      <div>","        <div className=\"text-lg font-semibold text-gray-400 mb-3 flex items-center\" >","          <img","            src=\"../icons/icon48.png\"","            alt=\"Bug Sense icon\"","            style={{","              marginRight: 8,","              width: 20,","              height: 20","            }}","          />","          <div>Bug Sense</div>","        </div>","        {/* <div className=\"text-xs text-gray-400\">v1.0.0</div> */}","      </div>","      <div />","    </div>","  );","","  if (activeTool === \"marker\" && annotateImage) {","    return (","      <div className=\"w-[320px] p-3 bg-white rounded-lg shadow-lg\">","        <Header />","        <div className=\"mt-3\">","          <MarkerTool","            image={annotateImage}","            onClose={() => {","              setAnnotateImage(null);","              setActiveTool(\"home\");","            }}","          />","        </div>","      </div>","    );","  }","","  return (","    <div className=\"w-[320px] p-3 shadow-lg bg-[#0B1220]\">","      <Header />","","      <div className=\"mt-3 space-y-3\">","        <ScreenshotTool onAnnotate={handleAnnotate} />","","        <RecorderTool />","","        <GifMaker />","","        <InstantReplay />","      </div>","    </div>","  );","}",""]}],[17,{"id":17,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/GifMaker.tsx","size":1692,"mtime":1762342303405.2344,"lines":["import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","","export default function GifMaker() {","  const [gifUrl, setGifUrl] = useState<string | null>(null);","  const [processing, setProcessing] = useState(false);","","  useEffect(() => {","    chrome.storage.local.get(\"generatedGifFromUploader\", (data) => {","      if (data.generatedGifFromUploader) setGifUrl(data.generatedGifFromUploader);","    });","","    const listener = (changes: Record<string, chrome.storage.StorageChange>) => {","      if (changes.generatedGifFromUploader) {","        setGifUrl(changes.generatedGifFromUploader.newValue);","        setProcessing(false);","      }","    };","    chrome.storage.onChanged.addListener(listener);","    return () => chrome.storage.onChanged.removeListener(listener);","  }, []);","","  const openUploader = () => {","    setProcessing(true);","    chrome.runtime.sendMessage({ action: \"OPEN_GIF_UPLOADER\" }, (resp) => {","      // uploader window opened","    });","  };","","  const downloadGif = () => {","    if (!gifUrl) return;","    const a = document.createElement(\"a\");","    a.href = gifUrl;","    a.download = `bug-sense-gif-${Date.now()}.gif`;","    a.click();","  };","","  return (","    <div className=\"space-y-3\">","      <DisplayButton name={processing ? \"Processing...\" : \"ðŸ” Select & Convert Recording\"} onClick={() => openUploader()} color=\"dark\" disable={processing} />","","      {gifUrl && (","        <div>","          <img src={gifUrl} alt=\"GIF\" className=\"w-full rounded mt-2\" />","          <button onClick={downloadGif} className=\"mt-2 w-full bg-green-500 text-white py-2 rounded\">","            â¬‡ï¸ Download GIF","          </button>","        </div>","      )}","    </div>","  );","}","",""]}],[18,{"id":18,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/Header.tsx","size":680,"mtime":1761807200466.7773,"lines":["// extension/popup/components/Header.tsx","","export default function Header() {","  const runDuplicateScan = () => {","    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {","      const tab = tabs[0];","      if (tab.id) {","        chrome.tabs.sendMessage(tab.id, { action: \"RUN_DUPLICATE_SCAN\" });","      }","    });","  };","","  return (","    <div className=\"flex items-center justify-between\">","      <h1 className=\"text-lg font-semibold text-gray-800\">Bug Sense</h1>","      <button","        onClick={runDuplicateScan}","        className=\"bg-indigo-600 text-white px-2 py-1 text-xs rounded hover:bg-indigo-700\"","      >","        ðŸ” Scan Duplicates","      </button>","    </div>","  );","}",""]}],[19,{"id":19,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/InstantReplay.tsx","size":11696,"mtime":1762405689056.5645,"lines":["import React, { useEffect, useRef, useState } from \"react\";","import { FaChevronLeft, FaChevronRight, FaDownload, FaPause, FaPlay } from \"react-icons/fa\";","import DisplayButton from \"../../components/DisplayButton\";","import { LuStepBack, LuStepForward } from \"react-icons/lu\";","import { FaBackwardStep, FaForwardStep } from \"react-icons/fa6\";","","/**"," * extension/popup/components/InstantReplay.tsx"," *"," * Adds \"Session Replay Download\" feature: combines screenshots stored in"," * chrome.storage.local.recentScreenshots into a WebM video (client-side)"," * using a Canvas + MediaRecorder."," *"," * - Preserves frame timing when timestamps exist (clamped to sane ranges)."," * - Shows build progress and allows direct download when ready."," * - Provides a preview player after building."," */","","type ScreenshotItem = { screenshot: string; timestamp: number };","","type ActionEvent = { type: string; timestamp: number; details: any };","","const DEFAULT_FRAME_INTERVAL_MS = 800; // used if timestamps not available or identical","const MIN_FRAME_MS = 40; // ~25fps max","const MAX_FRAME_MS = 5000; // cap extremely large gaps","","export default function InstantReplay(): JSX.Element {","    const [screenshots, setScreenshots] = useState<ScreenshotItem[]>([]);","    const [actions, setActions] = useState<ActionEvent[]>([]);","    const [playing, setPlaying] = useState(false);","    const [index, setIndex] = useState(0);","","    // export-related state","    const [isBuilding, setIsBuilding] = useState(false);","    const [buildProgress, setBuildProgress] = useState(0);","    const [videoUrl, setVideoUrl] = useState<string | null>(null);","    const [error, setError] = useState<string | null>(null);","    const [showReplay, setShowReplay] = useState(false);","    const intervalRef = useRef<number | null>(null);","","    useEffect(() => {","        chrome.storage.local.get([\"recentScreenshots\", \"recentActions\"], (res) => {","            if (chrome.runtime.lastError) {","                console.warn(\"InstantReplay storage.get error:\", chrome.runtime.lastError);","            }","            const ss: ScreenshotItem[] = Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const ac: ActionEvent[] = Array.isArray(res?.recentActions) ? res.recentActions : [];","            // Normalize timestamps & sort","            const normalized = ss","                .map((s) => ({ screenshot: s.screenshot, timestamp: Number(s.timestamp) || Date.now() }))","                .sort((a, b) => a.timestamp - b.timestamp);","            setScreenshots(normalized);","            setActions(ac);","            setIndex(0);","        });","","        const onChange = (changes: Record<string, chrome.storage.StorageChange>) => {","            if (changes.recentScreenshots) {","                const newVal = changes.recentScreenshots.newValue || [];","                const normalized = Array.isArray(newVal)","                    ? newVal.map((s: any) => ({ screenshot: s.screenshot, timestamp: Number(s.timestamp) || Date.now() })).sort((a: ScreenshotItem, b: ScreenshotItem) => a.timestamp - b.timestamp)","                    : [];","                setScreenshots(normalized);","                setIndex(0);","            }","            if (changes.recentActions) setActions(changes.recentActions.newValue || []);","        };","","        chrome.storage.onChanged.addListener(onChange);","        return () => chrome.storage.onChanged.removeListener(onChange);","    }, []);","","    useEffect(() => {","        if (playing && screenshots.length > 0) startPlayback();","        else stopPlayback();","        // eslint-disable-next-line react-hooks/exhaustive-deps","    }, [playing, index, screenshots]);","","    // Cleanup video blob URL to prevent memory leaks","    useEffect(() => {","        return () => {","            if (videoUrl) {","                URL.revokeObjectURL(videoUrl);","            }","        };","    }, [videoUrl]);","","    function startPlayback() {","        stopPlayback();","        const id = window.setInterval(() => {","            setIndex((prev) => {","                const next = prev + 1;","                return next >= screenshots.length ? 0 : next;","            });","        }, 800);","        intervalRef.current = id as unknown as number;","    }","","    function stopPlayback() {","        if (intervalRef.current !== null) {","            window.clearInterval(intervalRef.current);","            intervalRef.current = null;","        }","    }","","    function togglePlay() {","        setPlaying((p) => !p);","    }","","    function prevFrame() {","        setIndex((i) => (i - 1 + screenshots.length) % Math.max(1, screenshots.length));","    }","","    function nextFrame() {","        setIndex((i) => (i + 1) % Math.max(1, screenshots.length));","    }","","    // ---------- VIDEO BUILDING ----------","","    async function buildVideoAndDownload() {","        setError(null);","","        if (!screenshots || screenshots.length === 0) {","            setError(\"No screenshots available for export.\");","            return;","        }","","        try {","            // save current screenshots in storage (so background can access)","            await chrome.storage.local.set({ replayExportQueue: screenshots });","","            // open export page via background (keeps popup lightweight)","            chrome.runtime.sendMessage({ action: \"OPEN_REPLAY_EXPORT_PAGE\" });","","            setIsBuilding(true);","            setBuildProgress(0);","","            // show a short message","            setTimeout(() => {","                setIsBuilding(false);","                alert(\"Replay export started in a separate tab â€” you can close this popup safely.\");","            }, 1000);","        } catch (err) {","            console.error(\"Failed to start replay export:\", err);","            setError(String(err));","        }","    }","","","","","    return (","        <div className=\"space-y-3\">","            <DisplayButton name=\"ðŸ” Instant Visual Replay\" onClick={() => setShowReplay(prev => !prev)} color=\"dark\" title=\"Toggle replay preview\" />","","            {showReplay && <>","                <div className=\"text-sm font-medium text-gray-400 text-center\">Instant Visual Replay</div>","","                {screenshots && screenshots.length > 0 ? (","                    <div className=\"space-y-2\">","                        <div className=\"bg-black rounded overflow-hidden\">","                            <img src={screenshots[index].screenshot} alt=\"replay frame\" className=\"w-full object-contain max-h-48\" />","                        </div>","","                        <div className=\"flex items-center justify-between gap-3 py-1\">","                            {/* Left controls: prev / play-pause / next */}","                            <div className=\"flex items-center gap-2\">","                                <button","                                    onClick={prevFrame}","                                    className=\"flex items-center justify-center w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full transition\"","                                    title=\"Previous Frame\"","                                >","                                    <FaBackwardStep size={16} className=\"text-gray-500\" />","                                </button>","","                                <button","                                    onClick={togglePlay}","                                    className=\"flex items-center justify-center w-8 h-8 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full shadow-sm transition\"","                                    title={playing ? \"Pause\" : \"Play\"}","                                >","                                    {playing ? <FaPause size={12} /> : <FaPlay size={15} />}","                                </button>","","                                <button","                                    onClick={nextFrame}","                                    className=\"flex items-center justify-center w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full transition\"","                                    title=\"Next Frame\"","                                >","                                    <FaForwardStep size={16} className=\"text-gray-500\" />","                                </button>","                            </div>","","                            {/* Right controls: download + index/timestamp */}","                            <div className=\"flex items-center gap-3\">","                                <button","                                    title=\"Download Replay as Video\"","                                    onClick={buildVideoAndDownload}","                                    disabled={isBuilding}","                                    className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition ${isBuilding","                                        ? \"bg-indigo-400 cursor-wait\"","                                        : \"bg-indigo-600 hover:bg-indigo-700\"","                                        }`}","                                >","                                    {isBuilding ? (","                                        <span className=\"text-xs\">{`Building... ${buildProgress}%`}</span>","                                    ) : (","                                        <>","                                            <FaDownload size={14} />","                                            <span className=\"text-xs font-semibold\">Export</span>","                                        </>","                                    )}","                                </button>","","                                <div className=\"text-xs text-gray-400 text-right\">","                                    {index + 1}/{screenshots.length} â€¢ <br />","                                    {new Date(screenshots[index].timestamp).toLocaleTimeString()}","                                </div>","                            </div>","                        </div>","","","                        {/* progress bar */}","                        {isBuilding && (","                            <div className=\"w-full bg-gray-200 h-2 rounded overflow-hidden mt-2\">","                                <div className=\"bg-blue-500 h-2\" style={{ width: `${buildProgress}%`, transition: \"width 0.2s\" }} />","                            </div>","                        )}","","                        {error && <div className=\"text-xs text-red-600\">{error}</div>}","","                        {videoUrl && (","                            <div className=\"mt-2\">","                                <video src={videoUrl} controls className=\"w-full rounded shadow-md\" />","                            </div>","                        )}","                    </div>","                ) : (","                    <div className=\"text-sm text-gray-600\">No recent screenshots available. Showing textual actions instead.</div>","                )}","","                {/* textual fallback */}","                {screenshots.length === 0 && actions && actions.length > 0 && (","                    <div className=\"text-left text-sm max-h-48 overflow-auto\">","                        {actions.slice().reverse().slice(0, 30).map((a, idx) => (","                            <div key={idx} className=\"py-1 border-b border-gray-100\">","                                <div className=\"text-xs text-gray-400\">{new Date(a.timestamp).toLocaleTimeString()}</div>","                                <div className=\"text-sm\">","                                    <strong>{String(a.type).toUpperCase()}</strong> â€” <span className=\"text-gray-400\">{JSON.stringify(a.details)}</span>","                                </div>","                            </div>","                        ))}","                    </div>","                )}","","                <div className=\"text-xs text-gray-400 text-center\">Shows visual replay (latest ~30-60s snapshots). Export to WebM video.</div>","            </>}","        </div>","    );","}",""]}],[20,{"id":20,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/MarkerTool.tsx","size":7766,"mtime":1762332041336.1484,"lines":["import React, { useRef, useState, useEffect } from \"react\";","import { IoIosSave } from \"react-icons/io\";","import { IoClose } from \"react-icons/io5\";","","interface MarkerToolProps {","  image?: string;","  onClose?: () => void;","}","","export default function MarkerTool({ image, onClose }: MarkerToolProps) {","  const canvasRef = useRef<HTMLCanvasElement | null>(null);","  const [tool, setTool] = useState<\"pen\" | \"rect\" | \"arrow\" | \"text\">(\"pen\");","  const [color, setColor] = useState(\"#ff0000\");","  const [isDrawing, setIsDrawing] = useState(false);","  const [startPos, setStartPos] = useState<{ x: number; y: number } | null>(null);","  const [textInput, setTextInput] = useState(\"\");","  const [textPos, setTextPos] = useState<{ x: number; y: number } | null>(null);","  const backgroundRef = useRef<HTMLImageElement | null>(null);","","  useEffect(() => {","    if (!image || !canvasRef.current) return;","    const canvas = canvasRef.current;","    const ctx = canvas.getContext(\"2d\")!;","    const img = new Image();","    img.src = image;","    img.onload = () => {","      // âœ… FIX: Set canvas to the exact 1:1 pixel size of the image.","      // This stops any blurry scaling.","      canvas.width = img.naturalWidth;","      canvas.height = img.naturalHeight;","","      // Draw image 1:1","      ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);","","      // Keep visible size responsive in popup (this is correct)","      canvas.style.width = \"100%\";","      canvas.style.height = \"auto\";","","      backgroundRef.current = img;","    };","  }, [image]);","","  // map client coords -> canvas pixel coords","  const toCanvasCoords = (e: React.MouseEvent<HTMLCanvasElement>) => {","    const canvas = canvasRef.current!;","    const rect = canvas.getBoundingClientRect();","    const scaleX = canvas.width / rect.width;","    const scaleY = canvas.height / rect.height;","    return {","      x: (e.clientX - rect.left) * scaleX,","      y: (e.clientY - rect.top) * scaleY,","    };","  };","","  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {","    if (tool === \"text\") {","      const pos = toCanvasCoords(e);","      setTextPos(pos);","      return;","    }","","    const pos = toCanvasCoords(e);","    setIsDrawing(true);","    setStartPos(pos);","","    // snapshot current canvas state once (for shape overlays)","    if (canvasRef.current) {","      const snap = new Image();","      snap.src = canvasRef.current.toDataURL();","      backgroundRef.current = snap;","    }","","    // init pen drawing path","    if (tool === \"pen\" && canvasRef.current) {","      const ctx = canvasRef.current.getContext(\"2d\")!;","      ctx.strokeStyle = color;","      ctx.lineWidth = 4;","      ctx.lineCap = \"round\";","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","    }","  };","","  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {","    if (!isDrawing || !startPos || !canvasRef.current) return;","    const ctx = canvasRef.current.getContext(\"2d\")!;","    const pos = toCanvasCoords(e);","","    // pen: continuous without re-draw from snapshot (smooth)","    if (tool === \"pen\") {","      ctx.strokeStyle = color;","      ctx.lineWidth = 4;","      ctx.lineCap = \"round\";","      ctx.lineTo(pos.x, pos.y);","      ctx.stroke();","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","      return;","    }","","    // other tools: redraw snapshot then draw shape overlay","    const bg = backgroundRef.current;","    if (bg) {","      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);","      ctx.drawImage(bg, 0, 0);","    }","","    ctx.strokeStyle = color;","    ctx.lineWidth = 4;","    ctx.lineCap = \"round\";","","    if (tool === \"rect\") {","      ctx.strokeRect(startPos.x, startPos.y, pos.x - startPos.x, pos.y - startPos.y);","    } else if (tool === \"arrow\") {","      ctx.beginPath();","      ctx.moveTo(startPos.x, startPos.y);","      ctx.lineTo(pos.x, pos.y);","      ctx.stroke();","      // arrow head","      const angle = Math.atan2(pos.y - startPos.y, pos.x - startPos.x);","      const headlen = Math.max(8, canvasRef.current.width / 120);","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","      ctx.lineTo(pos.x - headlen * Math.cos(angle - Math.PI / 6), pos.y - headlen * Math.sin(angle - Math.PI / 6));","      ctx.lineTo(pos.x - headlen * Math.cos(angle + Math.PI / 6), pos.y - headlen * Math.sin(angle + Math.PI / 6));","      ctx.closePath();","      ctx.fillStyle = color;","      ctx.fill();","    }","  };","","  const handleMouseUp = () => {","    setIsDrawing(false);","    setStartPos(null);","  };","","  const addText = () => {","    if (!canvasRef.current || !textPos || !textInput) return;","    const ctx = canvasRef.current.getContext(\"2d\")!;","    ctx.font = \"20px sans-serif\";","    ctx.fillStyle = color;","    ctx.fillText(textInput, textPos.x, textPos.y);","    setTextInput(\"\");","    setTextPos(null);","  };","","  const saveAnnotated = () => {","    if (!canvasRef.current) return;","","    const canvas = canvasRef.current;","    canvas.toBlob(","      (blob) => {","        if (!blob) {","          console.error(\"[BugSense] Failed to create annotated blob\");","          return;","        }","        const reader = new FileReader();","        reader.onloadend = () => {","          const dataUrl = reader.result as string;","          chrome.runtime.sendMessage(","            { action: \"SAVE_ANNOTATED_IMAGE_DATAURL\", dataUrl },","            (resp) => {","              if (resp?.success) {","                console.log(\"[BugSense] Annotated image saved successfully âœ…\");","              } else {","                console.error(\"[BugSense] MarkerTool background failed:\", resp?.error);","              }","            }","          );","        };","        reader.readAsDataURL(blob);","      },","      \"image/jpeg\",","      1.0 // maximum quality","    );","  };","","  return (","    <div className=\"w-full\">","      <div className=\"flex items-center justify-between gap-2\">","        <div className=\"flex items-center gap-2\">","          <select","            value={tool}","            onChange={(e) => setTool(e.target.value as any)}","            className=\"border rounded px-2 py-1 text-sm\"","          >","            <option value=\"pen\">Pen</option>","            <option value=\"rect\">Rectangle</option>","            <option value=\"arrow\">Arrow</option>","            <option value=\"text\">Text</option>","          </select>","","          <input","            type=\"color\"","            value={color}","            onChange={(e) => setColor(e.target.value)}","            className=\"w-10 h-8 p-0 border rounded\"","            aria-label=\"color\"","          />","        </div>","","        <div className=\"flex items-center gap-2\">","          <button title=\"Save\"","            onClick={saveAnnotated}","            className=\"bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-1 rounded text-sm\"","          >","            <IoIosSave />","          </button>","","          <button title=\"Close\"","            onClick={onClose}","            className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded text-sm\"","          >","            <IoClose />","          </button>","        </div>","      </div>","","      {tool === \"text\" && (","        <div className=\"mt-2 flex gap-2\">","          <input","            value={textInput}","            onChange={(e) => setTextInput(e.target.value)}","            placeholder=\"Enter text\"","            className=\"flex-1 border rounded px-2 py-1 text-sm\"","          />","          <button onClick={addText} className=\"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm\">","            Add","          </button>","        </div>","      )}","","      <div className=\"mt-3 border rounded overflow-hidden bg-black\">","        <canvas","          ref={canvasRef}","          onMouseDown={handleMouseDown}","          onMouseMove={handleMouseMove}","          onMouseUp={handleMouseUp}","          onMouseLeave={handleMouseUp}","          className=\"w-full block\"","          style={{ cursor: \"crosshair\", display: \"block\" }}","        />","      </div>","    </div>","  );","}",""]}],[21,{"id":21,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/RecorderTool.tsx","size":2651,"mtime":1762342319455.9485,"lines":["// RecorderTool.tsx","import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","","/**"," * RecorderTool â€” simplified popup controller."," * The recording runs fully inside a separate persistent window (recorder.html)."," * The popup only launches that window â€” no stop logic or preview here."," *"," * Change requested:"," *  - When recording is active, show \"Processing...\" on the Start button (green),"," *    instead of a long red status line. Disable the button while processing."," */","","export default function RecorderTool() {","  const [isRecording, setIsRecording] = useState(false);","","  useEffect(() => {","    // Load recording flag on mount","    chrome.storage.local.get([\"isRecording\"], (data) => {","      setIsRecording(Boolean(data?.isRecording));","    });","","    // Watch for recording state updates","    const handleChange = (changes: Record<string, chrome.storage.StorageChange>) => {","      if (changes.isRecording) {","        setIsRecording(Boolean(changes.isRecording.newValue));","      }","    };","","    chrome.storage.onChanged.addListener(handleChange);","    return () => chrome.storage.onChanged.removeListener(handleChange);","  }, []);","","  const startRecording = () => {","    // Ask background to start recording. Background may reply:","    //  - { success: true }         => background started recording","    //  - { requireRecorderWindow }  => popup should open recorder window (getDisplayMedia there)","    //  - { success: false, error }  => failure","    chrome.runtime.sendMessage({ action: \"START_RECORDING\" }, (resp) => {","      if (chrome.runtime.lastError) {","        console.error(\"Error starting recording:\", chrome.runtime.lastError);","        alert(\"Failed to start recording.\");","        return;","      }","","      if (resp?.requireRecorderWindow) {","        // Background asked us to open the separate recorder window (fallback flow)","        // Background handler should implement OPEN_RECORDER_WINDOW","        chrome.runtime.sendMessage({ action: \"OPEN_RECORDER_WINDOW\" });","        return;","      }","","      if (resp?.success) {","        // background-based recording started; set flag so main UI shows \"Processing...\"","        setIsRecording(true);","        try {","          chrome.storage.local.set({ isRecording: true });","        } catch { }","      } else {","        console.error(\"Could not start recording:\", resp);","        alert(\"Could not start recording. Please retry.\");","      }","    });","  };","","  return (","    <div className=\"space-y-3 \">","      <DisplayButton name={isRecording ? \"Processing...\" : \"ðŸŽ¥ Start Recording\"} onClick={() => startRecording()} color=\"dark\" disable={isRecording} />","    </div>","  );","}",""]}],[22,{"id":22,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/ScreenshotTool.tsx","size":3376,"mtime":1762414153708.365,"lines":["// extension/popup/components/ScreenshotTool.tsx","import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","import { FaDownload, FaEdit } from \"react-icons/fa\";","import { MdEdit } from \"react-icons/md\";","","export default function ScreenshotTool({","  onAnnotate,","}: {","  onAnnotate?: (img: string) => void;","}) {","  const [imageUrl, setImageUrl] = useState<string | null>(null);","  const [capturing, setCapturing] = useState(false);","  const [fullKey, setFullKey] = useState<string | null>(null);","  const [filename, setFilename] = useState<string | null>(null);","","  useEffect(() => {","    return () => {","      if (imageUrl && imageUrl.startsWith(\"blob:\")) URL.revokeObjectURL(imageUrl);","    };","  }, [imageUrl]);","","  const captureScreenshot = () => {","    if (capturing) return;","    setCapturing(true);","","    chrome.runtime.sendMessage({ action: \"TAKE_SCREENSHOT\" }, (resp) => {","      if (chrome.runtime.lastError) {","        console.error(\"Screenshot message failed:\", chrome.runtime.lastError);","        setCapturing(false);","        return;","      }","","      if (resp?.success) {","        setImageUrl(resp.preview);","        setFullKey(resp.fullKey);","        setFilename(resp.filename || null);","        console.log(\"[BugSense] Screenshot preview ready âœ…\");","      } else {","        console.error(\"Screenshot failed:\", resp?.error);","      }","","      setCapturing(false);","    });","  };","","  const downloadScreenshot = () => {","    if (!fullKey) return;","    chrome.runtime.sendMessage(","      { action: \"DOWNLOAD_FULL_SCREENSHOT\", fullKey },","      (resp) => {","        if (chrome.runtime.lastError) {","          console.error(\"Download message failed:\", chrome.runtime.lastError);","          return;","        }","        if (!resp?.success) console.error(\"Download failed:\", resp?.error);","        else console.log(\"Download started:\", resp.downloadId);","      }","    );","  };","","  return (","    <div className=\"space-y-3\">","      <DisplayButton name={capturing ? \"Capturing...\" : \"ðŸ“¸ Take Screenshot\"} onClick={() => captureScreenshot()} color=\"dark\" disable={capturing} />","","      {imageUrl && (","        <div className=\"mt-3 text-center\">","          <img","            src={imageUrl}","            alt=\"Screenshot preview\"","            className=\"rounded shadow-md mb-2 max-h-40 mx-auto\"","          />","          <div className=\"flex justify-center space-x-2\">","","            <button","              onClick={downloadScreenshot}","              className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition bg-indigo-600 hover:bg-indigo-700","                `}","            >","              <>","                <FaDownload size={14} />","                <span className=\"text-xs font-semibold\">Download</span>","              </>","            </button>","","            <button","              onClick={() => onAnnotate?.(imageUrl)}","              className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition bg-yellow-500 hover:bg-yellow-600","                `}","            >","              <>","                <MdEdit size={14} />","                <span className=\"text-xs font-semibold\">Annotate</span>","              </>","            </button>","          </div>","          {filename && <div className=\"text-xs text-gray-500 mt-1\">{filename}</div>}","        </div>","      )}","    </div>","  );","}",""]}],[23,{"id":23,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/main.tsx","size":248,"mtime":1761715013625.649,"lines":["import React from \"react\";","import ReactDOM from \"react-dom/client\";","import App from \"./App\";","import \"../styles/tailwind.css\";","","ReactDOM.createRoot(document.getElementById(\"root\")!).render(","  <React.StrictMode>","    <App />","  </React.StrictMode>",");","",""]}],[24,{"id":24,"path":"/home/milan/Desktop/bug-sense/frontend/extension/recorder/recorder.js","size":2839,"mtime":1762333706450.5066,"lines":["// extension/recorder.js","// Final version â€” no extra popup window, just inline preview in same recorder tab.","","let stream = null;","let mediaRecorder = null;","let chunks = [];","","const startBtn = document.getElementById(\"startBtn\");","const statusText = document.getElementById(\"status\");","const previewSection = document.getElementById(\"previewSection\");","const preview = document.getElementById(\"preview\");","","function setUI(isRecording) {","    if (isRecording) {","        startBtn.disabled = true;","        startBtn.classList.add(\"opacity-50\", \"cursor-not-allowed\");","        statusText.textContent = \"ðŸ”´ Recording in progress...\";","        previewSection.classList.add(\"hidden\");","    } else {","        startBtn.disabled = false;","        startBtn.classList.remove(\"opacity-50\", \"cursor-not-allowed\");","        statusText.textContent = \"ðŸŸ¢ Ready to record\";","    }","}","","async function startRecording() {","    try {","        stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });","        chunks = [];","","        try {","            mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm;codecs=vp9\" });","        } catch {","            mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm\" });","        }","","        mediaRecorder.ondataavailable = (e) => {","            if (e.data && e.data.size > 0) chunks.push(e.data);","        };","","        mediaRecorder.onstop = async () => {","            try {","                const blob = new Blob(chunks, { type: \"video/webm\" });","                const url = URL.createObjectURL(blob);","                preview.src = url;","                preview.autoplay = true;","                previewSection.classList.remove(\"hidden\");","","                await chrome.storage.local.set({ recordedVideo: url, isRecording: false });","                setUI(false);","                stream?.getTracks().forEach((t) => t.stop());","","                // ðŸ§¹ Removed: No new preview window is created","            } catch (err) {","                console.error(\"Finalize error:\", err);","            } finally {","                mediaRecorder = null;","                stream = null;","                chunks = [];","            }","        };","","        mediaRecorder.start();","        await chrome.storage.local.set({ isRecording: true });","        setUI(true);","","        // Automatically stop when Chrome's native â€œStop sharingâ€ is clicked","        stream.getVideoTracks().forEach((t) =>","            t.addEventListener(\"ended\", () => {","                if (mediaRecorder?.state === \"recording\") {","                    mediaRecorder.stop();","                }","            })","        );","    } catch (err) {","        console.error(\"getDisplayMedia error:\", err);","        alert(\"Screen capture permission denied or failed.\");","        setUI(false);","    }","}","","startBtn.addEventListener(\"click\", startRecording);","setUI(false);",""]}],[25,{"id":25,"path":"/home/milan/Desktop/bug-sense/frontend/extension/replay-export/replay-export.js","size":2674,"mtime":1762364737115.7014,"lines":["async function main() {","    const prog = document.getElementById(\"prog\");","    const status = document.getElementById(\"status\");","","    const res = await chrome.storage.local.get(\"replayExportQueue\");","    const frames = res.replayExportQueue || [];","    if (!frames.length) {","        status.textContent = \"âŒ No frames found. Please capture again.\";","        return;","    }","","    status.textContent = `Preparing ${frames.length} frames...`;","","    // Determine target resolution","    const firstBlob = await (await fetch(frames[0].screenshot)).blob();","    const firstBitmap = await createImageBitmap(firstBlob);","    let w = firstBitmap.width, h = firstBitmap.height;","    const MAX_W = 1280;","    if (w > MAX_W) {","        const ratio = MAX_W / w;","        w = Math.round(w * ratio);","        h = Math.round(h * ratio);","    }","","    const canvas = document.createElement(\"canvas\");","    canvas.width = w;","    canvas.height = h;","    const ctx = canvas.getContext(\"2d\");","    document.body.appendChild(canvas);","","    const stream = canvas.captureStream(25);","    const mimeType = MediaRecorder.isTypeSupported(\"video/webm;codecs=vp9\")","        ? \"video/webm;codecs=vp9\"","        : \"video/webm\";","    const recorder = new MediaRecorder(stream, {","        mimeType,","        videoBitsPerSecond: 8_000_000, // boost quality","    });","","    const chunks = [];","    recorder.ondataavailable = (e) => e.data && chunks.push(e.data);","","    const stopPromise = new Promise((res) => {","        recorder.onstop = () => res(new Blob(chunks, { type: mimeType }));","    });","","    recorder.start(100);","","    for (let i = 0; i < frames.length; i++) {","        const f = frames[i];","        try {","            const blob = await (await fetch(f.screenshot)).blob();","            const bmp = await createImageBitmap(blob, {","                resizeWidth: w,","                resizeHeight: h,","                resizeQuality: \"high\",","            });","            ctx.fillStyle = \"#000\";","            ctx.fillRect(0, 0, w, h);","            ctx.drawImage(bmp, 0, 0, w, h);","            bmp.close();","            prog.value = ((i + 1) / frames.length) * 100;","            status.textContent = `Frame ${i + 1}/${frames.length}`;","            await new Promise((r) => setTimeout(r, 750)); // Wait 750 ms between frames","        } catch (e) {","            console.warn(\"Frame failed:\", e);","        }","    }","","    recorder.stop();","    const blob = await stopPromise;","    const url = URL.createObjectURL(blob);","    const a = document.createElement(\"a\");","    a.href = url;","    a.download = `bug-sense-replay-${Date.now()}.webm`;","    a.click();","","    status.textContent = \"âœ… Export complete!\";","    chrome.storage.local.remove(\"replayExportQueue\");","}","","main();",""]}],[26,{"id":26,"path":"/home/milan/Desktop/bug-sense/frontend/extension/uploader/uploader.js","size":6086,"mtime":1762286201503.3477,"lines":["// extension/uploader.js","// Final version: GIF never appears in main popup, safe & clean processing.","","import GIF from \"gif.js.optimized\";","window.GIF = GIF;","","(async function () {","  console.log(\"[BugSense Uploader] Started\");","","  const MAX_SIZE = 50 * 1024 * 1024;","  const MAX_SECONDS = 6;","  const FPS = 8;","  const MAX_FRAMES = Math.min(MAX_SECONDS * FPS, 48);","","  const el = (id) => document.getElementById(id);","  const fileInput = el(\"file\");","  const startBtn = el(\"start\");","  const closeBtn = el(\"close\");","  const status = el(\"status\");","  const previewImg = el(\"preview\");","  const videoEl = el(\"video\");","  const canvas = el(\"canvas\");","  let controls = el(\"controls\");","","  if (!controls) {","    controls = document.createElement(\"div\");","    controls.id = \"controls\";","    controls.style.marginTop = \"10px\";","    document.body.appendChild(controls);","  }","","  // ðŸ”¹ Immediately clear any leftover public key (prevents popup flash)","  chrome.storage.local.remove(\"generatedGifFromUploader\", () => {","    console.log(\"[BugSense Uploader] Pre-cleaned leftover keys.\");","  });","","  const safeSetStatus = (msg) => {","    if (status && document.visibilityState === \"visible\") status.textContent = msg;","    console.log(\"[Uploader]\", msg);","  };","","  closeBtn?.addEventListener(\"click\", () => window.close());","","  startBtn?.addEventListener(\"click\", async () => {","    const file = fileInput?.files?.[0];","    if (!file) return alert(\"Please choose a file first.\");","    if (file.size > MAX_SIZE) return alert(\"File too large (max 50MB).\");","","    // Reset UI","    previewImg.style.display = \"none\";","    previewImg.src = \"\";","    controls.innerHTML = \"\";","    safeSetStatus(\"Loading video...\");","","    try {","      const url = URL.createObjectURL(file);","      videoEl.src = url;","      videoEl.muted = true;","      videoEl.playsInline = true;","","      await new Promise((res, rej) => {","        videoEl.onloadedmetadata = res;","        videoEl.onerror = rej;","      });","","      const duration = Math.min(videoEl.duration || MAX_SECONDS, MAX_SECONDS);","      const framesToCapture = Math.min(Math.ceil(duration * FPS), MAX_FRAMES);","","      const targetW = 480;","      const targetH = 270;","      canvas.width = targetW;","      canvas.height = targetH;","      const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });","","      const gif = new GIF({","        workers: 2,","        quality: 8,","        width: targetW,","        height: targetH,","        workerScript: chrome.runtime.getURL(\"extension/assets/gif.worker.js\"),","        background: \"#000\",","        repeat: 0,","      });","","      let captured = 0;","      for (let i = 0; i < framesToCapture; i++) {","        const t = i / FPS;","        videoEl.currentTime = Math.min(t, duration - 0.05);","        await new Promise((res) => (videoEl.onseeked = res));","","        ctx.clearRect(0, 0, targetW, targetH);","        const vw = videoEl.videoWidth || targetW;","        const vh = videoEl.videoHeight || targetH;","        const aspect = vw / vh;","        let drawW = targetW,","          drawH = targetH;","        if (vw > vh) drawH = Math.round(targetW / aspect);","        else drawW = Math.round(targetH * aspect);","        const dx = Math.floor((targetW - drawW) / 2);","        const dy = Math.floor((targetH - drawH) / 2);","        ctx.drawImage(videoEl, 0, 0, vw, vh, dx, dy, drawW, drawH);","","        gif.addFrame(ctx, { copy: true, delay: 1000 / FPS });","        captured++;","        safeSetStatus(`Captured ${captured}/${framesToCapture} frames...`);","      }","","      safeSetStatus(\"Rendering GIF (please wait)...\");","","      gif.on(\"finished\", async (blob) => {","        const blobUrl = URL.createObjectURL(blob);","        previewImg.src = blobUrl;","        previewImg.style.display = \"block\";","        safeSetStatus(\"GIF ready ðŸŽ‰\");","","        // --- Download button ---","        const downloadBtn = document.createElement(\"button\");","        downloadBtn.textContent = \"â¬‡ï¸ Download GIF\";","        downloadBtn.style.marginRight = \"8px\";","        downloadBtn.onclick = async () => {","          try {","            const blobData = await blob.arrayBuffer();","            const blobCopy = new Blob([blobData], { type: \"image/gif\" });","            const url = URL.createObjectURL(blobCopy);","            const a = document.createElement(\"a\");","            a.href = url;","            a.download = \"bugsense_output.gif\";","            document.body.appendChild(a);","            a.click();","            a.remove();","            URL.revokeObjectURL(url);","          } catch (err) {","            console.error(\"Download error:\", err);","            alert(\"Failed to download GIF: \" + err.message);","          }","        };","","        // --- Copy link ---","        // const copyBtn = document.createElement(\"button\");","        // copyBtn.textContent = \"ðŸ“‹ Copy Path\";","        // copyBtn.style.marginRight = \"8px\";","        // copyBtn.onclick = async () => {","        //   try {","        //     await navigator.clipboard.writeText(blobUrl);","        //     alert(\"GIF Blob URL copied!\");","        //   } catch (err) {","        //     alert(\"Clipboard error: \" + err.message);","        //   }","        // };","","        // --- Close button ---","        const manualCloseBtn = document.createElement(\"button\");","        manualCloseBtn.textContent = \"âŒ Close\";","        manualCloseBtn.onclick = () => window.close();","","        controls.appendChild(downloadBtn);","        // controls.appendChild(copyBtn);","        controls.appendChild(manualCloseBtn);","","        // --- Store privately (popup won't detect this key) ---","        chrome.storage.local.set({ generatedGif_temp_private: blobUrl }, () => {","          console.log(\"[BugSense Uploader] Stored privately (not visible to popup).\");","          setTimeout(() => {","            chrome.storage.local.remove(\"generatedGif_temp_private\");","          }, 1000);","        });","","        // ðŸš« No message to popup anymore","        // chrome.runtime.sendMessage({ action: \"GIF_READY\", url: blobUrl });","      });","","      gif.render();","    } catch (err) {","      console.error(\"Processing failed:\", err);","      alert(\"GIF generation failed: \" + err.message);","      safeSetStatus(\"Error during processing.\");","    }","  });","})();",""]}],[27,{"id":27,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/cache.ts","size":771,"mtime":1762403631521.9106,"lines":["// Local caching utility (browser localStorage or chrome.storage.local)","const CACHE_KEY = \"bugsense_duplicate_ignore_list\";","","export async function getIgnoredPairs(): Promise<string[]> {","  const data = localStorage.getItem(CACHE_KEY);","  if (!data) return [];","  try {","    return JSON.parse(data);","  } catch {","    return [];","  }","}","","export async function addIgnoredPair(idA: number, idB: number) {","  const key = [idA, idB].sort().join(\"-\");","  const list = await getIgnoredPairs();","  if (!list.includes(key)) {","    list.push(key);","    localStorage.setItem(CACHE_KEY, JSON.stringify(list));","  }","}","","export async function isIgnoredPair(idA: number, idB: number) {","  const key = [idA, idB].sort().join(\"-\");","  const list = await getIgnoredPairs();","  return list.includes(key);","}","",""]}],[28,{"id":28,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/formattedDate.ts","size":868,"mtime":1762239108018.1702,"lines":["export function getFormattedDate() {","    const d = new Date();","    const day = d.getDate();","    // Function to get \"st\", \"nd\", \"rd\", \"th\"","    const nth = (d: number) => {","        if (d > 3 && d < 21) return 'th';","        switch (d % 10) {","            case 1: return \"st\";","            case 2: return \"nd\";","            case 3: return \"rd\";","            default: return \"th\";","        }","    };","    const dayStr = day + nth(day);","    const monthStr = d.toLocaleDateString('en-US', { month: 'short' });","    const yearStr = d.getFullYear();","    let hour = d.getHours();","    const ampm = hour >= 12 ? 'Pm' : 'Am';","    hour = hour % 12;","    hour = hour ? hour : 12; // the hour '0' should be '12'","    const minStr = d.getMinutes().toString().padStart(2, '0');","","    // Returns \"4th Nov 2025 | 12.16 Pm\"","    return `${dayStr} ${monthStr} ${yearStr} | ${hour}.${minStr} ${ampm}`;","}"]}],[29,{"id":29,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/replayBuffer.ts","size":562,"mtime":1761715013626.6875,"lines":["// replayBuffer.ts","type ActionEvent = {","  type: \"click\" | \"keypress\";","  timestamp: number;","  details: any;","};","","const MAX_BUFFER_TIME = 30 * 1000; // 30 seconds","let events: ActionEvent[] = [];","","export function logAction(event: ActionEvent) {","  const now = Date.now();","  events.push(event);","  events = events.filter((e) => now - e.timestamp < MAX_BUFFER_TIME);","}","","export function getRecentActions(): ActionEvent[] {","  const now = Date.now();","  return events.filter((e) => now - e.timestamp < MAX_BUFFER_TIME);","}","","export function clearActions() {","  events = [];","}","",""]}],[30,{"id":30,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/sheetsAPI.ts","size":8512,"mtime":1762404735347.7888,"lines":["// extension/utils/sheetsAPI.ts","// extension/utils/sheetsAPI.ts","export async function getSheetData(spreadsheetId: string, range: string) {","  return new Promise<any>(async (resolve, reject) => {","    try {","      console.group(\"[BugSense][getSheetData] start\");","      console.log(\"spreadsheetId:\", spreadsheetId);","      console.log(\"range:\", range);","","      // 1ï¸âƒ£ Ask background for token","      const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","        try {","          chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => {","            res(response);","          });","        } catch (sendErr) {","          console.error(\"[BugSense][getSheetData] sendMessage threw:\", sendErr);","          res({ success: false, error: sendErr });","        }","      });","","      console.log(\"[BugSense][getSheetData] tokenResponse:\", tokenResponse);","","      if (!tokenResponse?.success || !tokenResponse.token) {","        console.error(\"[BugSense][getSheetData] Failed to get token:\", tokenResponse?.error);","        console.groupEnd();","        return reject(tokenResponse?.error || new Error(\"Failed to get token\"));","      }","","      const token = tokenResponse.token;","      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(range)}?majorDimension=ROWS`;","","      console.log(\"[BugSense][getSheetData] fetch url:\", url);","","      const response = await fetch(url, {","        headers: { Authorization: `Bearer ${token}` },","      });","","      console.log(`[BugSense][getSheetData] fetch status: ${response.status} ${response.statusText}`);","","      if (!response.ok) {","        const text = await response.text().catch(() => \"<could not read response body>\");","        console.error(\"[BugSense][getSheetData] fetch returned non-ok:\", response.status, text);","        console.groupEnd();","        return reject(new Error(`Sheets API error ${response.status}: ${text}`));","      }","","      const data = await response.json().catch((e) => {","        console.error(\"[BugSense][getSheetData] json parse error:\", e);","        return null;","      });","","      console.log(\"[BugSense][getSheetData] response data:\", data);","      console.groupEnd();","      resolve(data);","    } catch (err) {","      console.error(\"[BugSense][getSheetData] outer catch:\", err);","      reject(err);","    }","  });","}","","","export async function highlightDuplicates(","  spreadsheetId: string,","  rows: string[][],","  pairs: any[]",") {","  if (!pairs || pairs.length === 0) {","    console.log(\"[BugSense] No duplicates found for highlighting.\");","    return;","  }","","  // get token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) return;","  const token = tokenResponse.token;","","  // Fetch actual sheetId","  const metaRes = await fetch(","    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?fields=sheets.properties`,","    { headers: { Authorization: `Bearer ${token}` } }","  );","  const meta = await metaRes.json();","  const targetSheet = meta.sheets.find((s: any) => s.properties.title === \"bug_report\");","  const actualSheetId = targetSheet?.properties?.sheetId ?? 0;","","  // Build request","  const uniqueRows = new Set<number>();","  pairs.forEach((p: any) => {","    if (Array.isArray(p)) {","      p.forEach((id: number) => uniqueRows.add(id + 1)); // +1 skip header","    } else if (p.i !== undefined && p.j !== undefined) {","      uniqueRows.add(p.i + 1);","      uniqueRows.add(p.j + 1);","    }","  });","","  const requests = [...uniqueRows].map((rowIndex) => ({","    repeatCell: {","      range: {","        sheetId: actualSheetId,","        startRowIndex: rowIndex,","        endRowIndex: rowIndex + 1,","      },","      cell: {","        userEnteredFormat: {","          backgroundColor: { red: 1, green: 0.6, blue: 0.6 },","        },","      },","      fields: \"userEnteredFormat.backgroundColor\",","    },","  }));","","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}:batchUpdate`, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify({ requests }),","  });","","  if (resp.ok) {","    console.log(\"[BugSense] Highlighted duplicate rows in red ðŸš¨\");","  } else {","    console.warn(\"[BugSense] Highlight request failed:\", await resp.text());","  }","}","","export async function clearHighlights(","  spreadsheetId: string,","  pairs: any[]",") {","  if (!pairs || pairs.length === 0) {","    console.log(\"[BugSense] No rows to clear highlights.\");","    return;","  }","","  // get token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) return;","  const token = tokenResponse.token;","","  // fetch sheetId","  const metaRes = await fetch(","    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?fields=sheets.properties`,","    { headers: { Authorization: `Bearer ${token}` } }","  );","  const meta = await metaRes.json();","  const targetSheet = meta.sheets.find((s: any) => s.properties.title === \"bug_report\");","  const actualSheetId = targetSheet?.properties?.sheetId ?? 0;","","  // collect row indices","  const uniqueRows = new Set<number>();","  pairs.forEach((p: any) => {","    if (Array.isArray(p)) {","      p.forEach((id: number) => uniqueRows.add(id + 1));","    } else if (p.i !== undefined && p.j !== undefined) {","      uniqueRows.add(p.i + 1);","      uniqueRows.add(p.j + 1);","    }","  });","","  // build requests to reset background","  const requests = [...uniqueRows].map((rowIndex) => ({","    repeatCell: {","      range: {","        sheetId: actualSheetId,","        startRowIndex: rowIndex,","        endRowIndex: rowIndex + 1,","      },","      cell: {","        userEnteredFormat: {","          backgroundColor: null, // ðŸ§¹ removes red fill","        },","      },","      fields: \"userEnteredFormat.backgroundColor\",","    },","  }));","","  // execute","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}:batchUpdate`, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify({ requests }),","  });","","  if (resp.ok) {","    console.log(\"[BugSense] Cleared duplicate highlights ðŸ§¹\");","  } else {","    console.warn(\"[BugSense] Failed to clear highlights:\", await resp.text());","  }","}","","// extension/utils/sheetsAPI.ts  (append to existing file)","export async function appendRow(sheetId: string, range: string, rowValues: any[]) {","  // ask background for token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","","  if (!tokenResponse?.success || !tokenResponse.token) {","    throw new Error(\"Failed to get token for append\");","  }","  const token = tokenResponse.token;","","  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS`;","  const body = { values: [rowValues] };","","  const resp = await fetch(url, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify(body),","  });","","  if (!resp.ok) {","    const err = await resp.json().catch(() => ({ status: resp.status, statusText: resp.statusText }));","    throw new Error(`Sheets append error: ${JSON.stringify(err)}`);","  }","","  return await resp.json();","}","","export async function getSheetsProperties(sheetId: string) {","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) throw new Error(\"Failed to get token\");","  const token = tokenResponse.token;","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}?fields=sheets.properties`, {","    headers: { Authorization: `Bearer ${token}` },","  });","  if (!resp.ok) {","    const j = await resp.json().catch(() => null);","    throw new Error(`getSheetsProperties error: ${JSON.stringify(j)}`);","  }","  return await resp.json();","}","",""]}],[31,{"id":31,"path":"/home/milan/Desktop/bug-sense/frontend/global.d.ts","size":24,"mtime":1761715013623.0479,"lines":["declare module \"*.css\";",""]}],[32,{"id":32,"path":"/home/milan/Desktop/bug-sense/frontend/vite.config.devtools.ts","size":1160,"mtime":1762226242802.7227,"lines":["import { defineConfig } from \"vite\";","import react from \"@vitejs/plugin-react\";","import { resolve } from \"path\";","","export default defineConfig({","    // Set the root to the devtools source directory","    root: \"extension/devtools\",","","    // Use relative paths for assets","    base: \"./\",","","    build: {","        // Build *into* the correct subfolder of the main build's output dir","        outDir: resolve(__dirname, \"dist/extension/devtools\"),","","        // CRITICAL: This MUST be true. ","        // It deletes the source files (copied by crx) before writing the compiled files.","        emptyOutDir: true,","        sourcemap: true,","","        rollupOptions: {","            // Define BOTH of your HTML files as inputs for Vite","            input: {","                main: resolve(__dirname, \"extension/devtools/index.html\"),","                register: resolve(__dirname, \"extension/devtools/register.html\"),","            },","","            // Keep the output filenames simple and predictable","            output: {","                entryFileNames: \"[name].js\",","                assetFileNames: \"assets/[name]-[hash][extname]\",","            },","        },","    },","    plugins: [react()],","});"]}],[33,{"id":33,"path":"/home/milan/Desktop/bug-sense/frontend/vite.config.ts","size":2304,"mtime":1762432921013.4023,"lines":["// vite.config.ts (replace file with this)","import { defineConfig } from \"vite\";","import react from \"@vitejs/plugin-react\";","import { crx } from \"@crxjs/vite-plugin\";","import manifest from \"./extension/manifest.json\";","import { resolve } from \"path\";","import fs from \"fs\";","","export default defineConfig({","  plugins: [","    react(),","    crx({ manifest }),","","    // copy key.pem -> dist if present","    {","      name: \"copy-key-pem\",","      closeBundle() {","        const src = resolve(__dirname, \"key.pem\");","        const dest = resolve(__dirname, \"dist/key.pem\");","        if (!fs.existsSync(src)) {","          console.warn(\"âš ï¸ key.pem not found â€” skipping (dev).\");","          return;","        }","        try {","          fs.copyFileSync(src, dest);","          console.log(\"âœ… key.pem copied to dist/\");","        } catch (err) {","          console.error(\"âŒ Failed to copy key.pem:\", err);","        }","      },","    },","  ],","","  // IMPORTANT: disable publicDir to prevent accidental copies","  publicDir: false,","","  build: {","    outDir: \"dist\",","    emptyOutDir: true,","    sourcemap: true,","    rollupOptions: {","      input: {","        popup: resolve(__dirname, \"extension/popup/index.html\"),","        uploader: resolve(__dirname, \"extension/uploader/uploader.html\"),","        background: resolve(__dirname, \"extension/background/index.ts\"),","        replayListener: resolve(__dirname, \"extension/content/replayListener.ts\"),","        duplicateBugDetector: resolve(__dirname, \"extension/content/duplicateBugDetector.ts\"),","        consoleListener: resolve(__dirname, \"extension/content/consoleListener.ts\"),","        recorder: resolve(__dirname, \"extension/recorder/recorder.html\"),","        replayExport: resolve(__dirname, \"extension/replay-export/replay-export.html\"),","        selectionOverlay: resolve(__dirname, \"extension/content/selectionOverlay.ts\"),","        // NOTE: Do NOT add devtools HTML here â€” devtools build is separate","      },","      output: {","        entryFileNames: (chunk) => {","          if (chunk.name === \"background\") return \"extension/background/[name].js\";","          if (chunk.name === \"replayListener\") return \"extension/content/[name].js\";","          if (chunk.name === \"selectionOverlay\") return \"extension/content/[name].js\";","          return \"assets/[name]-[hash].js\";","        },","      },","    },","  },","});",""]}],[34,{"id":34,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/ast-extractor.js","size":2452,"mtime":1766417828185.0942,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.extractSymbols = extractSymbols;","const parser_1 = require(\"@babel/parser\");","const traverse_1 = __importDefault(require(\"@babel/traverse\"));","function extractSymbols(code, fileId) {","    let ast;","    try {","        ast = (0, parser_1.parse)(code, {","            sourceType: 'unambiguous',","            plugins: [","                'typescript',","                'jsx',","                'classProperties',","                'classPrivateProperties',","                'classPrivateMethods',","                'decorators-legacy',","                'dynamicImport',","                'topLevelAwait',","                'exportDefaultFrom',","                'exportNamespaceFrom',","                'importMeta',","            ],","            errorRecovery: true,","            allowAwaitOutsideFunction: true,","            allowReturnOutsideFunction: true,","        });","    }","    catch (err) {","        console.warn('[AST] hard parse failed, skipping file');","        return [];","    }","    const symbols = [];","    try {","        (0, traverse_1.default)(ast, {","            FunctionDeclaration(path) {","                const name = path.node.id?.name;","                if (!name)","                    return;","                symbols.push({","                    name,","                    fileId,","                    startLine: path.node.loc?.start.line ?? 0,","                    endLine: path.node.loc?.end.line ?? 0,","                    kind: 'function',","                });","            },","            VariableDeclarator(path) {","                const id = path.node.id;","                const init = path.node.init;","                if (id.type === 'Identifier' &&","                    (init?.type === 'ArrowFunctionExpression' ||","                        init?.type === 'FunctionExpression')) {","                    symbols.push({","                        name: id.name,","                        fileId,","                        startLine: path.node.loc?.start.line ?? 0,","                        endLine: path.node.loc?.end.line ?? 0,","                        kind: 'function',","                    });","                }","            },","        });","    }","    catch (err) {","        console.warn('[AST] traverse failed partially, returning what we have');","    }","    return symbols;","}",""]}],[35,{"id":35,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/file-scanner.js","size":1159,"mtime":1766417828194.0366,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.scanFiles = scanFiles;","const node_fs_1 = __importDefault(require(\"node:fs\"));","const node_path_1 = __importDefault(require(\"node:path\"));","const ALLOWED_EXT = new Set(['.js', '.ts', '.jsx', '.tsx']);","const IGNORED_DIRS = new Set([","    'node_modules',","    'dist',","    'build',","    '.git',","    '.next',","    '.turbo',","    'out',","    'coverage',","]);","function scanFiles(dir, out = []) {","    const base = node_path_1.default.basename(dir);","    if (IGNORED_DIRS.has(base))","        return out;","    let entries;","    try {","        entries = node_fs_1.default.readdirSync(dir, { withFileTypes: true });","    }","    catch {","        return out;","    }","    for (const e of entries) {","        const full = node_path_1.default.join(dir, e.name);","        if (e.isDirectory()) {","            scanFiles(full, out);","        }","        else if (ALLOWED_EXT.has(node_path_1.default.extname(e.name))) {","            out.push(full);","        }","    }","    return out;","}",""]}],[36,{"id":36,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/helpers.js","size":827,"mtime":1766417828206.093,"lines":["\"use strict\";","function intersectSets(sets) {","    if (sets.length === 0)","        return new Set();","    if (sets.length === 1)","        return sets[0];","    sets.sort((a, b) => a.size - b.size);","    const result = new Set();","    outer: for (const v of sets[0]) {","        for (let i = 1; i < sets.length; i++) {","            if (!sets[i].has(v))","                continue outer;","        }","        result.add(v);","    }","    return result;","}","function scoreMatch(symbol, query) {","    const s = symbol.toLowerCase();","    const q = query.toLowerCase();","    if (s === q)","        return 100;","    if (s.startsWith(q))","        return 90;","    // camelCase / snake_case boundary boost","    const boundaryRegex = new RegExp(`(^|_|-)${q}`);","    if (boundaryRegex.test(s))","        return 80;","    if (s.includes(q))","        return 60;","    return 0;","}",""]}],[37,{"id":37,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/index-manager.js","size":4773,"mtime":1766417828247.0908,"lines":["\"use strict\";","var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {","    if (k2 === undefined) k2 = k;","    var desc = Object.getOwnPropertyDescriptor(m, k);","    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {","      desc = { enumerable: true, get: function() { return m[k]; } };","    }","    Object.defineProperty(o, k2, desc);","}) : (function(o, m, k, k2) {","    if (k2 === undefined) k2 = k;","    o[k2] = m[k];","}));","var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {","    Object.defineProperty(o, \"default\", { enumerable: true, value: v });","}) : function(o, v) {","    o[\"default\"] = v;","});","var __importStar = (this && this.__importStar) || (function () {","    var ownKeys = function(o) {","        ownKeys = Object.getOwnPropertyNames || function (o) {","            var ar = [];","            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;","            return ar;","        };","        return ownKeys(o);","    };","    return function (mod) {","        if (mod && mod.__esModule) return mod;","        var result = {};","        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);","        __setModuleDefault(result, mod);","        return result;","    };","})();","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.indexManager = void 0;","const fs = __importStar(require(\"node:fs\"));","const file_scanner_1 = require(\"./file-scanner\");","const ast_extractor_1 = require(\"./ast-extractor\");","const trigram_1 = require(\"./trigram\");","const CACHE_PATH = 'index-cache.json';","class IndexManager {","    store = {","        files: new Map(),","        tokenIndex: new Map(),","        symbolIndex: new Map(),","        trigramIndex: new Map(),","    };","    nextFileId = 1;","    build(projectPaths) {","        for (const root of projectPaths) {","            const files = (0, file_scanner_1.scanFiles)(root);","            for (const filePath of files) {","                let code;","                let stat;","                try {","                    code = fs.readFileSync(filePath, 'utf-8');","                    stat = fs.statSync(filePath);","                }","                catch {","                    continue;","                }","                const lines = code.split('\\n');","                const fileId = this.nextFileId++;","                this.store.files.set(fileId, {","                    id: fileId,","                    path: filePath,","                    size: stat.size,","                    mtime: stat.mtimeMs,","                    lines,","                });","                let symbols = [];","                try {","                    symbols = (0, ast_extractor_1.extractSymbols)(code, fileId);","                }","                catch {","                    continue;","                }","                for (const sym of symbols) {","                    const name = sym.name.toLowerCase();","                    if (!this.store.symbolIndex.has(name)) {","                        this.store.symbolIndex.set(name, []);","                    }","                    this.store.symbolIndex.get(name).push(sym);","                    this._addToken(name, fileId);","                }","            }","        }","        console.log('[INDEX] Sample symbols:', [...this.store.symbolIndex.keys()].slice(0, 20));","    }","    _addToken(token, fileId) {","        if (!this.store.tokenIndex.has(token)) {","            this.store.tokenIndex.set(token, new Set());","        }","        this.store.tokenIndex.get(token).add(fileId);","        for (const tri of (0, trigram_1.trigrams)(token)) {","            if (!this.store.trigramIndex.has(tri)) {","                this.store.trigramIndex.set(tri, new Set());","            }","            this.store.trigramIndex.get(tri).add(fileId);","        }","    }","    persist() {","        const serialized = JSON.stringify({","            files: [...this.store.files],","            tokenIndex: [...this.store.tokenIndex].map(([k, v]) => [k, [...v]]),","            symbolIndex: [...this.store.symbolIndex],","            trigramIndex: [...this.store.trigramIndex].map(([k, v]) => [k, [...v]]),","        });","        fs.writeFileSync(CACHE_PATH, serialized);","    }","    loadFromDisk() {","        if (!fs.existsSync(CACHE_PATH))","            return false;","        const raw = JSON.parse(fs.readFileSync(CACHE_PATH, 'utf-8'));","        this.store.files = new Map(raw.files);","        this.store.tokenIndex = new Map(raw.tokenIndex.map(([k, v]) => [k, new Set(v)]));","        this.store.symbolIndex = new Map(raw.symbolIndex);","        this.store.trigramIndex = new Map(raw.trigramIndex.map(([k, v]) => [k, new Set(v)]));","        return true;","    }","}","exports.indexManager = new IndexManager();",""]}],[38,{"id":38,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/search-engine.js","size":1090,"mtime":1766417828254.0903,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.searchIndex = searchIndex;","function searchIndex(store, query, limit = 50) {","    const q = query.trim().toLowerCase();","    if (!q)","        return [];","    const results = [];","    for (const [name, symbols] of store.symbolIndex) {","        // âœ… PREFIX / CONTAINS MATCH (CRITICAL FIX)","        if (!name.includes(q))","            continue;","        for (const sym of symbols) {","            results.push({","                name: sym.name,","                fileId: sym.fileId,","                filePath: store.files.get(sym.fileId)?.path ?? '',","                kind: sym.kind,","                startLine: sym.startLine,","                endLine: sym.endLine,","                score: score(name, q),","            });","        }","    }","    return results","        .sort((a, b) => b.score - a.score)","        .slice(0, limit);","}","function score(symbol, query) {","    if (symbol === query)","        return 100;","    if (symbol.startsWith(query))","        return 80;","    if (symbol.includes(query))","        return 60;","    return 0;","}",""]}],[39,{"id":39,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/indexer/trigram.js","size":366,"mtime":1766417828210.06,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.trigrams = trigrams;","function trigrams(word) {","    const w = word.toLowerCase().trim();","    if (w.length < 3)","        return [];","    const s = `__${w}__`;","    const out = [];","    for (let i = 0; i < s.length - 2; i++) {","        out.push(s.slice(i, i + 3));","    }","    return out;","}",""]}],[40,{"id":40,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/code.handlers.js","size":581,"mtime":1766417828135.9133,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","electron_1.ipcMain.handle('code:extract', (_, fileId, start, end) => {","    return new Promise((resolve) => {","        const { worker } = require('./worker-bridge');","        worker.once('message', (msg) => {","            if (msg.type === 'code:extract:result') {","                resolve(msg.code);","            }","        });","        worker.postMessage({","            type: 'code:extract',","            fileId,","            start,","            end,","        });","    });","});",""]}],[41,{"id":41,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/fs.handlers.js","size":603,"mtime":1766417828123.098,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","const worker_bridge_1 = require(\"./worker-bridge\");","electron_1.ipcMain.handle('fs:select-folders', async () => {","    console.log('[FS] select-folders handler invoked');","    const result = await electron_1.dialog.showOpenDialog({","        properties: ['openDirectory'],","    });","    if (result.canceled || !result.filePaths.length)","        return [];","    worker_bridge_1.worker.postMessage({","        type: 'build',","        paths: result.filePaths,","    });","    return result.filePaths;","});",""]}],[42,{"id":42,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/index.js","size":191,"mtime":1766417828147.0964,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","require(\"./fs.handlers\");","require(\"./search.handlers\");","require(\"./code.handlers\");","require(\"./inject.handlers\");",""]}],[43,{"id":43,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/inject.handlers.js","size":1490,"mtime":1766417828143.0967,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","const node_fs_1 = __importDefault(require(\"node:fs\"));","const node_path_1 = __importDefault(require(\"node:path\"));","electron_1.ipcMain.handle('code:inject', async (_, payload) => {","    const { targetPath, code } = payload;","    // Safety checks","    if (!node_fs_1.default.existsSync(targetPath)) {","        throw new Error('Target file does not exist');","    }","    const stat = node_fs_1.default.statSync(targetPath);","    if (!stat.isFile()) {","        throw new Error('Target path is not a file');","    }","    const allowedExt = new Set(['.js', '.ts', '.tsx', '.jsx', '.css', '.html', '.py']);","    if (!allowedExt.has(node_path_1.default.extname(targetPath))) {","        throw new Error('File type not allowed for injection');","    }","    const original = node_fs_1.default.readFileSync(targetPath, 'utf-8');","    // Backup (same folder)","    const backupPath = `${targetPath}.bak`;","    if (!node_fs_1.default.existsSync(backupPath)) {","        node_fs_1.default.writeFileSync(backupPath, original);","    }","    // Default strategy: append at bottom with spacing","    const next = original.replace(/\\s*$/, '\\n\\n' + code + '\\n');","    node_fs_1.default.writeFileSync(targetPath, next);","    return {","        success: true,","        backupPath","    };","});",""]}],[44,{"id":44,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/search.handlers.js","size":603,"mtime":1766417828130.0974,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","const worker_bridge_1 = require(\"./worker-bridge\");","electron_1.ipcMain.handle('search:query', (_, query) => {","    console.log('[SEARCH] query received:', query);","    return new Promise((resolve) => {","        worker_bridge_1.worker.once('message', (msg) => {","            if (msg.type === 'search:result') {","                resolve(msg.results);","            }","        });","        worker_bridge_1.worker.postMessage({","            type: 'search',","            query,","        });","    });","});",""]}],[45,{"id":45,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/worker-bridge.js","size":465,"mtime":1766417828115.0984,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.worker = void 0;","const worker_threads_1 = require(\"worker_threads\");","const node_path_1 = __importDefault(require(\"node:path\"));","exports.worker = new worker_threads_1.Worker(node_path_1.default.join(__dirname, '../workers/index-worker.js'));",""]}],[46,{"id":46,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/worker-instance.js","size":475,"mtime":1766417828257.09,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.indexWorker = void 0;","const worker_threads_1 = require(\"worker_threads\");","const node_path_1 = __importDefault(require(\"node:path\"));","exports.indexWorker = new worker_threads_1.Worker(node_path_1.default.join(__dirname, '../workers/index-worker.js'));",""]}],[47,{"id":47,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/ipc/worket-bridge.js","size":465,"mtime":1766417557171.9807,"lines":["\"use strict\";","var __importDefault = (this && this.__importDefault) || function (mod) {","    return (mod && mod.__esModule) ? mod : { \"default\": mod };","};","Object.defineProperty(exports, \"__esModule\", { value: true });","exports.worker = void 0;","const worker_threads_1 = require(\"worker_threads\");","const node_path_1 = __importDefault(require(\"node:path\"));","exports.worker = new worker_threads_1.Worker(node_path_1.default.join(__dirname, '../workers/index-worker.js'));",""]}],[48,{"id":48,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/main.js","size":2405,"mtime":1766417828160.0957,"lines":["\"use strict\";","var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {","    if (k2 === undefined) k2 = k;","    var desc = Object.getOwnPropertyDescriptor(m, k);","    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {","      desc = { enumerable: true, get: function() { return m[k]; } };","    }","    Object.defineProperty(o, k2, desc);","}) : (function(o, m, k, k2) {","    if (k2 === undefined) k2 = k;","    o[k2] = m[k];","}));","var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {","    Object.defineProperty(o, \"default\", { enumerable: true, value: v });","}) : function(o, v) {","    o[\"default\"] = v;","});","var __importStar = (this && this.__importStar) || (function () {","    var ownKeys = function(o) {","        ownKeys = Object.getOwnPropertyNames || function (o) {","            var ar = [];","            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;","            return ar;","        };","        return ownKeys(o);","    };","    return function (mod) {","        if (mod && mod.__esModule) return mod;","        var result = {};","        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);","        __setModuleDefault(result, mod);","        return result;","    };","})();","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","const path = __importStar(require(\"node:path\"));","require(\"./ipc\");","let win = null;","function createWindow() {","    win = new electron_1.BrowserWindow({","        width: 1200,","        height: 800,","        webPreferences: {","            preload: path.join(__dirname, 'preload.js')","        }","    });","    const isDev = !electron_1.app.isPackaged;","    if (isDev) {","        const devURL = 'http://localhost:5173';","        win.loadURL(devURL);","        // ðŸ”‘ THIS LINE FIXES THE BLANK SCREEN","        win.webContents.on('did-fail-load', () => {","            setTimeout(() => {","                win?.loadURL(devURL);","            }, 300);","        });","        win.webContents.openDevTools();","    }","    else {","        win.loadFile(path.join(__dirname, '../index.html'));","    }","}","electron_1.app.whenReady().then(createWindow);","electron_1.app.on('window-all-closed', () => {","    if (process.platform !== 'darwin')","        electron_1.app.quit();","});",""]}],[49,{"id":49,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/preload.js","size":540,"mtime":1766417828167.0955,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","const electron_1 = require(\"electron\");","electron_1.contextBridge.exposeInMainWorld('api', {","    selectFolders: () => electron_1.ipcRenderer.invoke('fs:select-folders'),","    search: (query) => electron_1.ipcRenderer.invoke('search:query', query),","    extractCode: (fileId, start, end) => electron_1.ipcRenderer.invoke('code:extract', fileId, start, end),","    injectCode: (targetPath, code) => electron_1.ipcRenderer.invoke('code:inject', { targetPath, code })","});",""]}],[50,{"id":50,"path":"/home/milan/Desktop/code_vault/dist-electron/electron/workers/index-worker.js","size":1776,"mtime":1766417828270.0894,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });","const worker_threads_1 = require(\"worker_threads\");","const index_manager_1 = require(\"../indexer/index-manager\");","const search_engine_1 = require(\"../indexer/search-engine\");","worker_threads_1.parentPort?.on('message', (msg) => {","    try {","        // ðŸ”¹ BUILD INDEX","        if (msg.type === 'build') {","            console.log('[WORKER] build:', msg.paths);","            index_manager_1.indexManager.build(msg.paths);","            index_manager_1.indexManager.persist();","            worker_threads_1.parentPort.postMessage({","                type: 'build:done',","                files: index_manager_1.indexManager.store.files.size,","                symbols: index_manager_1.indexManager.store.symbolIndex.size,","            });","        }","        // ðŸ”¹ SEARCH","        if (msg.type === 'search') {","            console.log('[WORKER] search:', msg.query);","            const results = (0, search_engine_1.searchIndex)(index_manager_1.indexManager.store, msg.query);","            worker_threads_1.parentPort.postMessage({","                type: 'search:result',","                results,","            });","        }","        // ðŸ”¹ CODE EXTRACT","        if (msg.type === 'code:extract') {","            const { fileId, start, end } = msg;","            const file = index_manager_1.indexManager.store.files.get(fileId);","            worker_threads_1.parentPort.postMessage({","                type: 'code:extract:result',","                code: file","                    ? file.lines.slice(start - 1, end).join('\\n')","                    : '',","            });","        }","    }","    catch (err) {","        worker_threads_1.parentPort.postMessage({","            type: 'error',","            error: String(err),","        });","    }","});",""]}],[51,{"id":51,"path":"/home/milan/Desktop/code_vault/dist-electron/shared/models.js","size":77,"mtime":1766417828271.0894,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });",""]}],[52,{"id":52,"path":"/home/milan/Desktop/code_vault/dist-electron/shared/types.js","size":77,"mtime":1766417828169.0952,"lines":["\"use strict\";","Object.defineProperty(exports, \"__esModule\", { value: true });",""]}],[53,{"id":53,"path":"/home/milan/Desktop/code_vault/electron/indexer/ast-extractor.ts","size":2242,"mtime":1766416742293.1973,"lines":["import { parse } from '@babel/parser'","import traverse from '@babel/traverse'","import type { SymbolEntry } from '@shared/types'","","export function extractSymbols(code: string, fileId: number): SymbolEntry[] {","    let ast","","    try {","        ast = parse(code, {","            sourceType: 'unambiguous',","            plugins: [","                'typescript',","                'jsx',","                'classProperties',","                'classPrivateProperties',","                'classPrivateMethods',","                'decorators-legacy',","                'dynamicImport',","                'topLevelAwait',","                'exportDefaultFrom',","                'exportNamespaceFrom',","                'importMeta',","            ],","            errorRecovery: true,","            allowAwaitOutsideFunction: true,","            allowReturnOutsideFunction: true,","        })","    } catch (err) {","        console.warn('[AST] hard parse failed, skipping file')","        return []","    }","","    const symbols: SymbolEntry[] = []","","    try {","        traverse(ast, {","            FunctionDeclaration(path) {","                const name = path.node.id?.name","                if (!name) return","","                symbols.push({","                    name,","                    fileId,","                    startLine: path.node.loc?.start.line ?? 0,","                    endLine: path.node.loc?.end.line ?? 0,","                    kind: 'function',","                })","            },","","            VariableDeclarator(path) {","                const id = path.node.id","                const init = path.node.init","","                if (","                    id.type === 'Identifier' &&","                    (init?.type === 'ArrowFunctionExpression' ||","                        init?.type === 'FunctionExpression')","                ) {","                    symbols.push({","                        name: id.name,","                        fileId,","                        startLine: path.node.loc?.start.line ?? 0,","                        endLine: path.node.loc?.end.line ?? 0,","                        kind: 'function',","                    })","                }","            },","        })","    } catch (err) {","        console.warn('[AST] traverse failed partially, returning what we have')","    }","","    return symbols","}",""]}],[54,{"id":54,"path":"/home/milan/Desktop/code_vault/electron/indexer/file-scanner.ts","size":817,"mtime":1766402884948.4124,"lines":["import fs from 'node:fs'","import path from 'node:path'","","const ALLOWED_EXT = new Set(['.js', '.ts', '.jsx', '.tsx'])","","const IGNORED_DIRS = new Set([","    'node_modules',","    'dist',","    'build',","    '.git',","    '.next',","    '.turbo',","    'out',","    'coverage',","])","","export function scanFiles(dir: string, out: string[] = []): string[] {","    const base = path.basename(dir)","","    if (IGNORED_DIRS.has(base)) return out","","    let entries: fs.Dirent[]","    try {","        entries = fs.readdirSync(dir, { withFileTypes: true })","    } catch {","        return out","    }","","    for (const e of entries) {","        const full = path.join(dir, e.name)","","        if (e.isDirectory()) {","            scanFiles(full, out)","        } else if (ALLOWED_EXT.has(path.extname(e.name))) {","            out.push(full)","        }","    }","","    return out","}",""]}],[55,{"id":55,"path":"/home/milan/Desktop/code_vault/electron/indexer/helpers.ts","size":806,"mtime":1766403174419.6267,"lines":["function intersectSets(sets: Set<number>[]): Set<number> {","    if (sets.length === 0) return new Set()","    if (sets.length === 1) return sets[0]","","    sets.sort((a, b) => a.size - b.size)","","    const result = new Set<number>()","","    outer: for (const v of sets[0]) {","        for (let i = 1; i < sets.length; i++) {","            if (!sets[i].has(v)) continue outer","        }","        result.add(v)","    }","","    return result","}","","","function scoreMatch(symbol: string, query: string): number {","    const s = symbol.toLowerCase()","    const q = query.toLowerCase()","","    if (s === q) return 100","","    if (s.startsWith(q)) return 90","","    // camelCase / snake_case boundary boost","    const boundaryRegex = new RegExp(`(^|_|-)${q}`)","    if (boundaryRegex.test(s)) return 80","","    if (s.includes(q)) return 60","","    return 0","}","",""]}],[56,{"id":56,"path":"/home/milan/Desktop/code_vault/electron/indexer/index-manager.ts","size":3383,"mtime":1766404264543.8914,"lines":["import * as fs from 'node:fs'","import { scanFiles } from './file-scanner'","import { extractSymbols } from './ast-extractor'","import { trigrams } from './trigram'","import type { IndexStore } from '@shared/types'","","const CACHE_PATH = 'index-cache.json'","","class IndexManager {","    store: IndexStore = {","        files: new Map(),","        tokenIndex: new Map(),","        symbolIndex: new Map(),","        trigramIndex: new Map(),","    }","","    private nextFileId = 1","","    build(projectPaths: string[]) {","        for (const root of projectPaths) {","            const files = scanFiles(root)","","            for (const filePath of files) {","                let code: string","                let stat: fs.Stats","","                try {","                    code = fs.readFileSync(filePath, 'utf-8')","                    stat = fs.statSync(filePath)","                } catch {","                    continue","                }","","                const lines = code.split('\\n')","                const fileId = this.nextFileId++","","                this.store.files.set(fileId, {","                    id: fileId,","                    path: filePath,","                    size: stat.size,","                    mtime: stat.mtimeMs,","                    lines,","                })","","                let symbols = []","","                try {","                    symbols = extractSymbols(code, fileId)","                } catch {","                    continue","                }","","                for (const sym of symbols) {","                    const name = sym.name.toLowerCase()","","                    if (!this.store.symbolIndex.has(name)) {","                        this.store.symbolIndex.set(name, [])","                    }","","                    this.store.symbolIndex.get(name)!.push(sym)","                    this._addToken(name, fileId)","                }","            }","        }","        console.log(","            '[INDEX] Sample symbols:',","            [...this.store.symbolIndex.keys()].slice(0, 20)","        )","","    }","","    private _addToken(token: string, fileId: number) {","        if (!this.store.tokenIndex.has(token)) {","            this.store.tokenIndex.set(token, new Set())","        }","        this.store.tokenIndex.get(token)!.add(fileId)","","        for (const tri of trigrams(token)) {","            if (!this.store.trigramIndex.has(tri)) {","                this.store.trigramIndex.set(tri, new Set())","            }","            this.store.trigramIndex.get(tri)!.add(fileId)","        }","    }","","    persist() {","        const serialized = JSON.stringify({","            files: [...this.store.files],","            tokenIndex: [...this.store.tokenIndex].map(([k, v]) => [k, [...v]]),","            symbolIndex: [...this.store.symbolIndex],","            trigramIndex: [...this.store.trigramIndex].map(([k, v]) => [k, [...v]]),","        })","","        fs.writeFileSync(CACHE_PATH, serialized)","    }","","    loadFromDisk() {","        if (!fs.existsSync(CACHE_PATH)) return false","","        const raw = JSON.parse(fs.readFileSync(CACHE_PATH, 'utf-8'))","","        this.store.files = new Map(raw.files)","        this.store.tokenIndex = new Map(","            raw.tokenIndex.map(([k, v]: any) => [k, new Set(v)])","        )","        this.store.symbolIndex = new Map(raw.symbolIndex)","        this.store.trigramIndex = new Map(","            raw.trigramIndex.map(([k, v]: any) => [k, new Set(v)])","        )","","        return true","    }","}","","export const indexManager = new IndexManager()",""]}],[57,{"id":57,"path":"/home/milan/Desktop/code_vault/electron/indexer/search-engine.ts","size":1086,"mtime":1766417164023.5435,"lines":["import type { IndexStore, SearchMatch } from '@shared/types'","","export function searchIndex(","    store: IndexStore,","    query: string,","    limit = 50","): SearchMatch[] {","    const q = query.trim().toLowerCase()","    if (!q) return []","","    const results: SearchMatch[] = []","","    for (const [name, symbols] of store.symbolIndex) {","        // âœ… PREFIX / CONTAINS MATCH (CRITICAL FIX)","        if (!name.includes(q)) continue","","        for (const sym of symbols) {","            results.push({","                name: sym.name,","                fileId: sym.fileId,","                filePath: store.files.get(sym.fileId)?.path ?? '',","                kind: sym.kind,","                startLine: sym.startLine,","                endLine: sym.endLine,","                score: score(name, q),","            })","        }","    }","","    return results","        .sort((a, b) => b.score - a.score)","        .slice(0, limit)","}","","function score(symbol: string, query: string): number {","    if (symbol === query) return 100","    if (symbol.startsWith(query)) return 80","    if (symbol.includes(query)) return 60","    return 0","}",""]}],[58,{"id":58,"path":"/home/milan/Desktop/code_vault/electron/indexer/trigram.ts","size":283,"mtime":1766403075031.1719,"lines":["export function trigrams(word: string): string[] {","    const w = word.toLowerCase().trim()","    if (w.length < 3) return []","","    const s = `__${w}__`","    const out: string[] = []","","    for (let i = 0; i < s.length - 2; i++) {","        out.push(s.slice(i, i + 3))","    }","    return out","}",""]}],[59,{"id":59,"path":"/home/milan/Desktop/code_vault/electron/ipc/code.handlers.ts","size":584,"mtime":1766417531890.2297,"lines":["import { ipcMain } from 'electron'","","ipcMain.handle(","    'code:extract',","    (_, fileId: number, start: number, end: number) => {","        return new Promise((resolve) => {","            const { worker } = require('./worker-bridge')","","            worker.once('message', (msg: any) => {","                if (msg.type === 'code:extract:result') {","                    resolve(msg.code)","                }","            })","","            worker.postMessage({","                type: 'code:extract',","                fileId,","                start,","                end,","            })","        })","    }",")",""]}],[60,{"id":60,"path":"/home/milan/Desktop/code_vault/electron/ipc/fs.handlers.ts","size":471,"mtime":1766417589669.251,"lines":["import { ipcMain, dialog } from 'electron'","import { worker } from './worker-bridge'","","ipcMain.handle('fs:select-folders', async () => {","    console.log('[FS] select-folders handler invoked')","","    const result = await dialog.showOpenDialog({","        properties: ['openDirectory'],","    })","","    if (result.canceled || !result.filePaths.length) return []","","    worker.postMessage({","        type: 'build',","        paths: result.filePaths,","    })","","    return result.filePaths","})",""]}],[61,{"id":61,"path":"/home/milan/Desktop/code_vault/electron/ipc/index.ts","size":102,"mtime":1766388826624.026,"lines":["import './fs.handlers'","import './search.handlers'","import './code.handlers'","import './inject.handlers'",""]}],[62,{"id":62,"path":"/home/milan/Desktop/code_vault/electron/ipc/inject.handlers.ts","size":1170,"mtime":1766390347918.5579,"lines":["import { ipcMain } from 'electron'","import fs from 'node:fs';","import path from 'node:path'","type InjectPayload = {","    targetPath: string","    code: string","}","","ipcMain.handle('code:inject', async (_, payload: InjectPayload) => {","    const { targetPath, code } = payload","","    // Safety checks","    if (!fs.existsSync(targetPath)) {","        throw new Error('Target file does not exist')","    }","","    const stat = fs.statSync(targetPath)","    if (!stat.isFile()) {","        throw new Error('Target path is not a file')","    }","","    const allowedExt = new Set(['.js', '.ts', '.tsx', '.jsx', '.css', '.html', '.py'])","    if (!allowedExt.has(path.extname(targetPath))) {","        throw new Error('File type not allowed for injection')","    }","","    const original = fs.readFileSync(targetPath, 'utf-8')","","    // Backup (same folder)","    const backupPath = `${targetPath}.bak`","    if (!fs.existsSync(backupPath)) {","        fs.writeFileSync(backupPath, original)","    }","","    // Default strategy: append at bottom with spacing","    const next = original.replace(/\\s*$/, '\\n\\n' + code + '\\n')","","    fs.writeFileSync(targetPath, next)","","    return {","        success: true,","        backupPath","    }","})",""]}],[63,{"id":63,"path":"/home/milan/Desktop/code_vault/electron/ipc/search.handlers.ts","size":472,"mtime":1766417612544.5857,"lines":["import { ipcMain } from 'electron'","import { worker } from './worker-bridge'","","ipcMain.handle('search:query', (_, query: string) => {","    console.log('[SEARCH] query received:', query)","","    return new Promise((resolve) => {","        worker.once('message', (msg) => {","            if (msg.type === 'search:result') {","                resolve(msg.results)","            }","        })","","        worker.postMessage({","            type: 'search',","            query,","        })","    })","})",""]}],[64,{"id":64,"path":"/home/milan/Desktop/code_vault/electron/ipc/worker-bridge.ts","size":161,"mtime":1766417556769.9407,"lines":["import { Worker } from 'worker_threads'","import path from 'node:path'","","export const worker = new Worker(","    path.join(__dirname, '../workers/index-worker.js')",")",""]}],[65,{"id":65,"path":"/home/milan/Desktop/code_vault/electron/ipc/worker-instance.ts","size":166,"mtime":1766404950547.3833,"lines":["import { Worker } from 'worker_threads'","import path from 'node:path'","","export const indexWorker = new Worker(","    path.join(__dirname, '../workers/index-worker.js')",")",""]}],[66,{"id":66,"path":"/home/milan/Desktop/code_vault/electron/main.ts","size":931,"mtime":1766394001221.9248,"lines":["import { app, BrowserWindow } from 'electron'","import * as path from 'node:path'","import './ipc'","","","let win: BrowserWindow | null = null","","function createWindow() {","    win = new BrowserWindow({","        width: 1200,","        height: 800,","        webPreferences: {","            preload: path.join(__dirname, 'preload.js')","        }","    })","","    const isDev = !app.isPackaged","","    if (isDev) {","        const devURL = 'http://localhost:5173'","","        win.loadURL(devURL)","","        // ðŸ”‘ THIS LINE FIXES THE BLANK SCREEN","        win.webContents.on('did-fail-load', () => {","            setTimeout(() => {","                win?.loadURL(devURL)","            }, 300)","        })","","        win.webContents.openDevTools()","    } else {","        win.loadFile(","            path.join(__dirname, '../index.html')","        )","    }","}","","app.whenReady().then(createWindow)","","app.on('window-all-closed', () => {","    if (process.platform !== 'darwin') app.quit()","})",""]}],[67,{"id":67,"path":"/home/milan/Desktop/code_vault/electron/preload.ts","size":549,"mtime":1766406027458.6238,"lines":["import { contextBridge, ipcRenderer } from 'electron'","","contextBridge.exposeInMainWorld('api', {","    selectFolders: () =>","        ipcRenderer.invoke('fs:select-folders') as Promise<string[]>,","","    search: (query: string) =>","        ipcRenderer.invoke('search:query', query),","","    extractCode: (","        fileId: number,","        start: number,","        end: number","    ) => ipcRenderer.invoke('code:extract', fileId, start, end),","","    injectCode: (targetPath: string, code: string) =>","        ipcRenderer.invoke('code:inject', { targetPath, code })","","})",""]}],[68,{"id":68,"path":"/home/milan/Desktop/code_vault/electron/workers/index-worker.ts","size":1519,"mtime":1766417462988.2593,"lines":["import { parentPort } from 'worker_threads'","import { indexManager } from '../indexer/index-manager'","import { searchIndex } from '../indexer/search-engine'","","parentPort?.on('message', (msg) => {","    try {","        // ðŸ”¹ BUILD INDEX","        if (msg.type === 'build') {","            console.log('[WORKER] build:', msg.paths)","            indexManager.build(msg.paths)","            indexManager.persist()","","            parentPort!.postMessage({","                type: 'build:done',","                files: indexManager.store.files.size,","                symbols: indexManager.store.symbolIndex.size,","            })","        }","","        // ðŸ”¹ SEARCH","        if (msg.type === 'search') {","            console.log('[WORKER] search:', msg.query)","","            const results = searchIndex(","                indexManager.store,","                msg.query","            )","","            parentPort!.postMessage({","                type: 'search:result',","                results,","            })","        }","","        // ðŸ”¹ CODE EXTRACT","        if (msg.type === 'code:extract') {","            const { fileId, start, end } = msg","            const file = indexManager.store.files.get(fileId)","","            parentPort!.postMessage({","                type: 'code:extract:result',","                code: file","                    ? file.lines.slice(start - 1, end).join('\\n')","                    : '',","            })","        }","    } catch (err) {","        parentPort!.postMessage({","            type: 'error',","            error: String(err),","        })","    }","})",""]}],[69,{"id":69,"path":"/home/milan/Desktop/code_vault/postcss.config.js","size":90,"mtime":1765779177714.4329,"lines":["export default {","    plugins: {","        tailwindcss: {},","        autoprefixer: {}","    }","}",""]}],[70,{"id":70,"path":"/home/milan/Desktop/code_vault/shared/models.ts","size":75,"mtime":1766378473103.609,"lines":["export type Project = {","    id: string","    path: string","    name: string","}",""]}],[71,{"id":71,"path":"/home/milan/Desktop/code_vault/shared/types.ts","size":1159,"mtime":1766388870833.3215,"lines":["export type FileID = number","","export type FileMeta = {","    id: FileID","    path: string","    size: number","    mtime: number","    lines: string[]","}","","export type SymbolEntry = {","    name: string","    fileId: FileID","    startLine: number","    endLine: number","    kind: 'function' | 'class' | 'variable' | 'component'","}","","export type IndexStore = {","    files: Map<FileID, FileMeta>","    tokenIndex: Map<string, Set<FileID>>","    symbolIndex: Map<string, SymbolEntry[]>","    trigramIndex: Map<string, Set<FileID>>","}","","export type SearchMatch = {","    name: string","    fileId: FileID","    filePath: string","    kind: 'function' | 'class' | 'variable' | 'component'","    startLine: number","    endLine: number","    score: number","}","","export type ElectronAPI = {","    selectFolders(): Promise<string[]>","    search(query: string): Promise<SearchMatch[]>","    extractCode(fileId: FileID, startLine: number, endLine: number): Promise<string>","    injectCode(targetPath: string, code: string): Promise<InjectResult>","}","","","export type ExtractCodeParams = {","    fileId: FileID","    startLine: number","    endLine: number","}","","export type InjectResult = {","    success: boolean","    backupPath: string","}",""]}],[72,{"id":72,"path":"/home/milan/Desktop/code_vault/src/App.tsx","size":2533,"mtime":1766406077834.541,"lines":["import { useState } from 'react'","import { useSearch } from './app/hooks'","import { detectLanguage } from './utils/lang'","import type { SearchMatch } from '@shared/types'","import { CodeClipboard } from './components/CodeClipboard'","import { SearchResults } from './components/SearchResults'","import { useDispatch, useSelector } from 'react-redux'","import { addProjects } from './features/projects/projectSlice'","import { Sidebar } from './layouts/Sidebar'","","","export default function App() {","    const [query, setQuery] = useState('')","    const results = useSearch(query)","","    const [selected, setSelected] = useState<SearchMatch | null>(null)","    const [code, setCode] = useState('')","","    const dispatch = useDispatch()","","    const importProjects = async () => {","        const paths = await window.api.selectFolders()","        console.log('Imported paths:', paths)","","        if (paths.length) {","            dispatch(addProjects(paths))","        }","    }","","    const projects = useSelector(","        (state: any) => state.projects.projects","    )","","","    const onSelect = async (item: SearchMatch) => {","        setSelected(item)","        const extracted = await window.api.extractCode(","            item.fileId,","            item.startLine,","            item.endLine","        )","        setCode(extracted)","    }","","    return (","        <div className=\"flex h-screen\">","            {/* LEFT PANEL */}","            <Sidebar />","            <div className=\"w-1/3 border-r p-4 space-y-3\">","                <button","                    onClick={importProjects}","                    className=\"w-full rounded bg-blue-600 text-white py-2 hover:bg-blue-700\"","                >","                    Import Project Folder","                </button>","","                <input","                    className=\"w-full border rounded p-2\"","                    placeholder=\"Search function / symbol\"","                    value={query}","                    onChange={(e) => setQuery(e.target.value)}","                />","","                <SearchResults results={results} onSelect={onSelect} />","            </div>","","            {/* RIGHT PANEL */}","            <div className=\"flex-1 p-4\">","                {selected ? (","                    <CodeClipboard","                        code={code}","                        language={detectLanguage(selected.filePath)}","                    />","                ) : (","                    <div className=\"text-gray-400\">","                        Select a result to view code","                    </div>","                )}","            </div>","        </div>","    )","}",""]}],[73,{"id":73,"path":"/home/milan/Desktop/code_vault/src/app/hooks.ts","size":523,"mtime":1766386669047.152,"lines":["import { SearchMatch } from '@shared/types'","import { useEffect, useState } from 'react'","","export function useSearch(query: string) {","    const [results, setResults] = useState<SearchMatch[]>([])","","    useEffect(() => {","        if (!query.trim()) {","            setResults([])","            return","        }","","        const id = setTimeout(async () => {","            const res = await window.api.search(query)","            setResults(res)","        }, 120)","","        return () => clearTimeout(id)","    }, [query])","","    return results","}",""]}],[74,{"id":74,"path":"/home/milan/Desktop/code_vault/src/app/store.ts","size":316,"mtime":1766378620068.795,"lines":["import { configureStore } from '@reduxjs/toolkit'","import projectReducer from '../features/projects/projectSlice'","","export const store = configureStore({","    reducer: {","        projects: projectReducer","    }","})","","export type RootState = ReturnType<typeof store.getState>","export type AppDispatch = typeof store.dispatch",""]}],[75,{"id":75,"path":"/home/milan/Desktop/code_vault/src/components/CodeClipboard.tsx","size":763,"mtime":1766397278708.349,"lines":["import Editor from '@monaco-editor/react'","","    // Disable Monaco SharedArrayBuffer usage in Electron dev","    ; (self as any).MonacoEnvironment = {","        getWorker: () => undefined,","    }","","","export function CodeClipboard({","    code,","    language","}: {","    code: string","    language: string","}) {","    return (","        <div className=\"h-full border rounded overflow-hidden\">","            <Editor","                height=\"100%\"","                language={language}","                value={code}","                theme=\"vs-dark\"","                options={{","                    minimap: { enabled: false },","                    fontSize: 13,","                    wordWrap: 'on',","                    automaticLayout: true","                }}","            />","        </div>","    )","}",""]}],[76,{"id":76,"path":"/home/milan/Desktop/code_vault/src/components/InjectPanel.tsx","size":1049,"mtime":1766388909039.813,"lines":["import { useState } from 'react'","","export function InjectPanel({","    code","}: {","    code: string","}) {","    const [path, setPath] = useState('')","    const [status, setStatus] = useState<string | null>(null)","","    const inject = async () => {","        try {","            const res = await window.api.injectCode(path, code)","            setStatus(`Injected. Backup: ${res.backupPath}`)","        } catch (e: any) {","            setStatus(e.message || 'Injection failed')","        }","    }","","    return (","        <div className=\"mt-4 space-y-2\">","            <input","                value={path}","                onChange={e => setPath(e.target.value)}","                placeholder=\"Absolute path to target file\"","                className=\"w-full p-2 border rounded\"","            />","            <button","                onClick={inject}","                className=\"px-4 py-2 bg-green-600 text-white rounded\"","            >","                Inject Code","            </button>","            {status && <div className=\"text-sm text-gray-600\">{status}</div>}","        </div>","    )","}",""]}],[77,{"id":77,"path":"/home/milan/Desktop/code_vault/src/components/SearchResults.tsx","size":758,"mtime":1766383108541.367,"lines":["import { SearchMatch } from \"shared/types\"","","export function SearchResults({","    results,","    onSelect","}: {","    results: SearchMatch[]","    onSelect: (item: SearchMatch) => void","}) {","    return (","        <div className=\"space-y-1\">","            {results.map(r => (","                <div","                    key={`${r.fileId}-${r.startLine}`}","                    onClick={() => onSelect(r)}","                    className=\"p-2 border rounded hover:bg-gray-100 cursor-pointer\"","                >","                    <div className=\"font-mono text-sm\">{r.name}</div>","                    <div className=\"text-xs text-gray-500\">","                        {r.filePath}:{r.startLine}","                    </div>","                </div>","            ))}","        </div>","    )","}",""]}],[78,{"id":78,"path":"/home/milan/Desktop/code_vault/src/features/projects/projectImporter.tsx","size":716,"mtime":1766378561807.3787,"lines":["import { useDispatch } from 'react-redux'","import { addProjects } from './projectSlice'","","export default function ProjectImporter() {","    const dispatch = useDispatch()","","    const importFolders = async () => {","        const paths = await window?.api.selectFolders()","        dispatch(","            addProjects(","                paths.map((p: string) => ({","                    id: crypto.randomUUID(),","                    path: p,","                    name: p.split('/').pop()!","                }))","            )","        )","    }","","    return (","        <button","            onClick={importFolders}","            className=\"px-4 py-2 bg-blue-600 text-white rounded\"","        >","            Import Projects","        </button>","    )","}",""]}],[79,{"id":79,"path":"/home/milan/Desktop/code_vault/src/features/projects/projectSlice.ts","size":613,"mtime":1766399766536.8904,"lines":["import { createSlice, PayloadAction } from '@reduxjs/toolkit'","","type ProjectState = {","    projects: string[]","}","","const initialState: ProjectState = {","    projects: [],","}","","const projectSlice = createSlice({","    name: 'projects',","    initialState,","    reducers: {","        addProjects(state, action: PayloadAction<string[]>) {","            for (const path of action.payload) {","                if (!state.projects.includes(path)) {","                    state.projects.push(path)","                }","            }","        },","    },","})","","export const { addProjects } = projectSlice.actions","export default projectSlice.reducer",""]}],[80,{"id":80,"path":"/home/milan/Desktop/code_vault/src/global.d.ts","size":155,"mtime":1766388298559.2502,"lines":["declare module \"*.css\";","","import type { ElectronAPI } from '@shared'","","export { }","","declare global {","    interface Window {","        api: ElectronAPI","    }","}","",""]}],[81,{"id":81,"path":"/home/milan/Desktop/code_vault/src/layouts/Sidebar.tsx","size":955,"mtime":1766400167405.4104,"lines":["import { useSelector } from 'react-redux'","","export function Sidebar() {","    const projects = useSelector(","        (state: any) => state.projects.projects","    )","","    return (","        <div className=\"w-64 border-r p-2 h-full\">","            <h3 className=\"text-sm font-semibold mb-2\">","                Imported Projects","            </h3>","","            {projects.length === 0 && (","                <div className=\"text-xs text-gray-400\">","                    No projects imported","                </div>","            )}","","            <ul className=\"space-y-1\">","                {projects.map((path: string) => (","                    <li","                        key={path}","                        className=\"text-xs truncate px-2 py-1 rounded hover:bg-gray-100 cursor-pointer\"","                        title={path}","                    >","                        {path.split('/').pop()}","                    </li>","                ))}","            </ul>","        </div>","    )","}",""]}],[82,{"id":82,"path":"/home/milan/Desktop/code_vault/src/main.tsx","size":377,"mtime":1766400406982.8787,"lines":["import React from 'react'","import ReactDOM from 'react-dom/client'","import App from './App'","import './index.css'","import { Provider } from 'react-redux'","import { store } from './app/store'","","ReactDOM.createRoot(","    document.getElementById('root')!",").render(","    <React.StrictMode>","        <Provider store={store}>","            <App />","        </Provider>","    </React.StrictMode>",")",""]}],[83,{"id":83,"path":"/home/milan/Desktop/code_vault/src/utils/lang.ts","size":266,"mtime":1766387010346.5579,"lines":["export function detectLanguage(filePath: string): string {","    if (filePath.endsWith('.ts') || filePath.endsWith('.tsx'))","        return 'typescript'","    if (filePath.endsWith('.js') || filePath.endsWith('.jsx'))","        return 'javascript'","    return 'plaintext'","}",""]}],[84,{"id":84,"path":"/home/milan/Desktop/code_vault/tailwind.config.js","size":157,"mtime":1765779201164.8772,"lines":["export default {","    content: [","        \"./index.html\",","        \"./src/**/*.{js,ts,jsx,tsx}\"","    ],","    theme: {","        extend: {}","    },","    plugins: []","}",""]}],[85,{"id":85,"path":"/home/milan/Desktop/github/canary-deployment/frontend/eslint.config.js","size":621,"mtime":1758369296052.416,"lines":["import js from '@eslint/js'","import globals from 'globals'","import reactHooks from 'eslint-plugin-react-hooks'","import reactRefresh from 'eslint-plugin-react-refresh'","import tseslint from 'typescript-eslint'","import { defineConfig, globalIgnores } from 'eslint/config'","","export default defineConfig([","  globalIgnores(['dist']),","  {","    files: ['**/*.{ts,tsx}'],","    extends: [","      js.configs.recommended,","      tseslint.configs.recommended,","      reactHooks.configs['recommended-latest'],","      reactRefresh.configs.vite,","    ],","    languageOptions: {","      ecmaVersion: 2020,","      globals: globals.browser,","    },","  },","])",""]}],[86,{"id":86,"path":"/home/milan/Desktop/github/canary-deployment/frontend/src/App.tsx","size":903,"mtime":1758369296053.7295,"lines":["import { useState } from 'react'","import reactLogo from './assets/react.svg'","import viteLogo from '/vite.svg'","import './App.css'","","function App() {","  const [count, setCount] = useState(0)","","  return (","    <>","      <div>","        <a href=\"https://vite.dev\" target=\"_blank\">","          <img src={viteLogo} className=\"logo\" alt=\"Vite logo\" />","        </a>","        <a href=\"https://react.dev\" target=\"_blank\">","          <img src={reactLogo} className=\"logo react\" alt=\"React logo\" />","        </a>","      </div>","      <h1>Vite + React</h1>","      <div className=\"card\">","        <button onClick={() => setCount((count) => count + 1)}>","          count is {count}","        </button>","        <p>","          Edit <code>src/App.tsx</code> and save to test HMR","        </p>","      </div>","      <p className=\"read-the-docs\">","        Click on the Vite and React logos to learn more","      </p>","    </>","  )","}","","export default App",""]}],[87,{"id":87,"path":"/home/milan/Desktop/github/canary-deployment/frontend/src/main.tsx","size":230,"mtime":1758369296053.7688,"lines":["import { StrictMode } from 'react'","import { createRoot } from 'react-dom/client'","import './index.css'","import App from './App.tsx'","","createRoot(document.getElementById('root')!).render(","  <StrictMode>","    <App />","  </StrictMode>,",")",""]}],[88,{"id":88,"path":"/home/milan/Desktop/github/canary-deployment/frontend/src/vite-env.d.ts","size":38,"mtime":1758369296053.7688,"lines":["/// <reference types=\"vite/client\" />",""]}],[89,{"id":89,"path":"/home/milan/Desktop/github/canary-deployment/frontend/vite.config.ts","size":161,"mtime":1758369296055.8416,"lines":["import { defineConfig } from 'vite'","import react from '@vitejs/plugin-react'","","// https://vite.dev/config/","export default defineConfig({","  plugins: [react()],","})",""]}],[90,{"id":90,"path":"/home/milan/Desktop/bug-sense/backend/ai-server.js","size":541,"mtime":1762257942761.6558,"lines":["// backend/ai-server.js","import express from \"express\";","import cors from \"cors\";","import aiAnalysisRoute from \"./routes/aiAnalysis.js\";","","const app = express();","app.use(cors());","// âœ… --- THIS IS THE FIX ---","// Increase the JSON payload limit to 50mb to allow for screenshots","app.use(express.json({ limit: \"50mb\" }));","app.use(express.urlencoded({ limit: \"50mb\", extended: true }));","","// Register route","app.use(\"/ai\", aiAnalysisRoute);","","const PORT = 3000;","app.listen(PORT, () => console.log(`ðŸ¤– BugSense AI backend running on port ${PORT}`));",""]}],[91,{"id":91,"path":"/home/milan/Desktop/bug-sense/backend/routes/aiAnalysis.js","size":431,"mtime":1762255532340.3474,"lines":["// backend/routes/aiAnalysis.js","import express from \"express\";","import { analyzeBug } from \"../services/transformerService.js\";","","const router = express.Router();","","router.post(\"/analyze\", async (req, res) => {","  try {","    const result = await analyzeBug(req.body);","    res.json(result);","  } catch (err) {","    console.error(\"AI analysis error:\", err);","    res.status(500).json({ error: err.message });","  }","});","","export default router;",""]}],[92,{"id":92,"path":"/home/milan/Desktop/bug-sense/backend/services/transformerService.js","size":2660,"mtime":1762412819633.0608,"lines":["// backend/services/transformerService.js","import { pipeline, env } from \"@xenova/transformers\";","","// Allow remote model loading","env.allowLocalModels = false;","env.allowRemoteModels = true;","","// Disable WASM limitations (use Node CPU backend)","env.backends.onnx.wasm.numThreads = 2;","env.backends.onnx.wasm.proxy = false;","env.backends.onnx.wasm.simd = false;","","let summarizer = null;","let textGenerator = null;","","// Initialize models once","export async function initAI() {","  if (!summarizer) {","    console.log(\"[BugSense AI] Loading summarizer model...\");","    summarizer = await pipeline(\"summarization\", \"Xenova/t5-small\");","  }","  if (!textGenerator) {","    console.log(\"[BugSense AI] Loading text generator model...\");","    textGenerator = await pipeline(\"text-generation\", \"Xenova/distilgpt2\");","  }","  console.log(\"[BugSense AI] Models initialized âœ…\");","}","","// Analyze bug text and generate report","export async function analyzeBug(input = {}) {","  const {","    console: consoleError,","    selectionText,","    srcUrl,","    linkUrl,","    replayActions,","    extraDetails,","  } = input;","","","  let contextText = \"\";","  if (consoleError) {","    contextText = `","Error: ${consoleError.message || \"\"}","File: ${consoleError.filename || \"unknown\"}","Line: ${consoleError.lineno || \"\"}","Stack: ${consoleError.stack || \"\"}","`;","  } else if (selectionText) {","    contextText = `User selected: \"${selectionText}\"`;","  } else if (srcUrl) {","    contextText = `User right-clicked image: ${srcUrl}`;","  } else if (linkUrl) {","    contextText = `User right-clicked link: ${linkUrl}`;","  }","","  contextText += `\\nActions before error: ${JSON.stringify(replayActions?.slice(-5) || [], null, 2)}`;","","  if (extraDetails) {","    contextText += `\\n\\nðŸ” Additional User Notes:\\n${extraDetails}`;","  }","","  await initAI();","","  const titleSummary = await summarizer(`Summarize this bug: ${contextText}`, {","    max_length: 25,","    min_length: 8,","  });","","  const descSummary = await summarizer(","    `Explain the issue clearly for a developer: ${contextText}`,","    { max_length: 80, min_length: 30 }","  );","","  const stepsGen = await textGenerator(","    `Based on this bug, describe how to reproduce it: ${contextText}\\nSteps:\\n1.`,","    { max_length: 100, temperature: 0.8 }","  );","","  const steps = stepsGen[0].generated_text","    .split(\"\\n\")","    .filter((s) => s.trim().match(/^\\d+\\./))","    .slice(0, 5);","","  return {","    title: titleSummary[0].summary_text || \"Auto Bug Report\",","    description: descSummary[0].summary_text || \"Bug description not available\",","    steps:","      steps.length > 0","        ? steps","        : [","          \"1. Observe the error on the page\",","          \"2. Follow actions from replay buffer\",","        ],","  };","}",""]}],[93,{"id":93,"path":"/home/milan/Desktop/bug-sense/frontend/extension/ai/analyze.ts","size":4754,"mtime":1762255254691.8289,"lines":["import { pipeline, env } from \"@xenova/transformers\";","","// ==============================","// ðŸ”§ Environment Configuration (Type-safe)","// ==============================","","// Disable all WebAssembly (WASM) backends â€” blocked by Chrome CSP","(env.backends.onnx.wasm as any).wasmPaths = \"\";","(env.backends.onnx.wasm as any).proxy = false;","(env.backends.onnx.wasm as any).simd = false;","(env.backends.onnx.wasm as any).numThreads = 1;","","// Disable local model access (since extensions can't serve local assets)","env.allowLocalModels = false;","","// Enable fetching models from Hugging Face CDN","env.allowRemoteModels = true;","","// Force safe CPU-only backend","(env.backends.onnx as any).threads = 1;","(env.backends.onnx as any).preferJS = true;","","// Reduce concurrency (safe for Chrome extensions)","(env as any).maxConcurrency = 1;","","// ==============================","// ðŸ§  Model Initialization","// ==============================","let summarizer: any = null;","let textGenerator: any = null;","","export async function initAI() {","    if (!summarizer) {","        console.log(\"[BugSense AI] Loading summarizer model...\");","        summarizer = await pipeline(\"summarization\", \"Xenova/t5-small\", {","            revision: \"main\", quantized: true,","        });","        console.log(\"[BugSense AI] Summarizer ready âœ…\");","    }","","    if (!textGenerator) {","        console.log(\"[BugSense AI] Loading text generator model...\");","        textGenerator = await pipeline(\"text-generation\", \"Xenova/distilgpt2\", {","            revision: \"main\", quantized: true,","        });","        console.log(\"[BugSense AI] Text generator ready âœ…\");","    }","}","","// ==============================","// ðŸ§© Main AI Analysis Function","// ==============================","export async function analyzeBug(input: {","    console?: any;","    selectionText?: string;","    srcUrl?: string;","    linkUrl?: string;","    screenshot?: string | null;","    replayActions?: any[];","}) {","    const { console: consoleError, selectionText, srcUrl, linkUrl, replayActions } = input;","","    // Build contextual prompt for AI","    let contextText = \"\";","    if (consoleError) {","        contextText = `","Error: ${consoleError.message || \"\"}","File: ${consoleError.filename || \"unknown\"}","Line: ${consoleError.lineno || \"\"}","Stack: ${consoleError.stack || \"\"}","`;","    } else if (selectionText) {","        contextText = `UI Bug: User selected this text on the page: \"${selectionText}\"\\n`;","    } else if (srcUrl) {","        contextText = `UI Bug: User right-clicked this image: \"${srcUrl}\"\\n`;","    } else if (linkUrl) {","        contextText = `UI Bug: User right-clicked this link: \"${linkUrl}\"\\n`;","    }","","    contextText += `\\nActions before error: ${JSON.stringify(","        replayActions?.slice(-5) || [],","        null,","        2","    )}`;","","    // Ensure AI models are initialized","    await initAI();","","    try {","        // Add loading feedback to console","        console.log(\"ðŸ¤– Analyzing with BugSense AI...\");","","        // 1ï¸âƒ£ Generate concise title","        const titleSummary = await summarizer(`Summarize this bug: ${contextText}`, {","            max_length: 25,","            min_length: 8,","        });","","        // 2ï¸âƒ£ Generate a detailed description","        const descSummary = await summarizer(","            `Explain the issue clearly for a developer: ${contextText}`,","            { max_length: 80, min_length: 30 }","        );","","        // 3ï¸âƒ£ Generate reproducible steps","        const stepsGen = await textGenerator(","            `Based on this bug, describe how to reproduce it: ${contextText}\\nSteps:\\n1.`,","            { max_length: 100, temperature: 0.8 }","        );","","        const steps = stepsGen[0].generated_text","            .split(\"\\n\")","            .filter((s: string) => s.trim().match(/^\\d+\\./))","            .slice(0, 5);","","        console.log(\"âœ… AI generation complete\");","","        return {","            title: titleSummary?.[0]?.summary_text || \"Auto Bug Report\",","            description:","                descSummary?.[0]?.summary_text ||","                consoleError?.message ||","                selectionText ||","                srcUrl ||","                linkUrl ||","                \"Bug captured\",","            steps:","                steps.length > 0","                    ? steps","                    : [","                        \"1. Observe the error or selected text on the page\",","                        \"2. Follow actions similar to replay buffer\",","                    ],","        };","    } catch (err) {","        console.error(\"AI call failed:\", err);","        return {","            title: \"AI Model Unavailable\",","            description:","                \"BugSense AI failed to generate bug details. Please retry or check connectivity.\",","            steps: [\"1. Capture screenshot\", \"2. Note down observed issue manually\"],","        };","    }","}",""]}],[94,{"id":94,"path":"/home/milan/Desktop/bug-sense/frontend/extension/ai/transformer.ts","size":4183,"mtime":1761715013626.6875,"lines":["/**"," * extension/utils/transformer.ts"," *"," * Minimal wrapper around @xenova/transformers for:"," * - loading a sentence embedding pipeline"," * - embedding texts"," * - computing cosine similarities and detecting duplicates"," *"," * NOTE: This runs in the browser and will download model files on first use."," */","","import { pipeline, env } from \"@xenova/transformers\";","","type TensorLike = {","  tolist?: () => number[][];","  data?: Float32Array;","  dims?: number[];","};","","let extractor: any = null;","let initializing = false;","","/**"," * Initialize the feature-extraction pipeline (lazy)."," * Uses Xenova/all-MiniLM-L6-v2 (small & performant)."," */","export async function initModel() {","  if (extractor || initializing) return;","  initializing = true;","","  try {","    // allowLocalModels is false by default; we rely on hosted model via transformers.js","    // If you want to use local model files, set env.allowLocalModels = true and ensure files are available.","    env.allowLocalModels = false;","","    // Load a feature-extraction pipeline which returns embeddings.","    extractor = await pipeline(\"feature-extraction\", \"Xenova/all-MiniLM-L6-v2\");","  } catch (err) {","    console.error(\"Failed to initialize transformer pipeline:\", err);","    extractor = null;","    throw err;","  } finally {","    initializing = false;","  }","}","","/**"," * Embed an array of texts to vectors (JS arrays)."," * Returns number[][] where each item is the embedding vector (length ~384)."," */","export async function embedTexts(texts: string[]): Promise<number[][]> {","  if (!extractor) {","    await initModel();","  }","  if (!extractor) throw new Error(\"Transformer extractor not initialized\");","","  // The extractor may accept an array of strings or a single string.","  // We request pooling mean + normalize so vectors are comparable via cosine.","  const options = { pooling: \"mean\", normalize: true };","","  const output: TensorLike = await extractor(texts, options);","  // Many pipelines return a Tensor-like object with tolist() or `data` + `dims`.","  if (output?.tolist) {","    const arr = output.tolist() as number[][];","    return arr;","  }","","  // Fallback: try to read output.data + dims","  if (output?.data && output?.dims) {","    const dims = output.dims[1] || output.dims[0];","    const floatArr = Array.from(output.data as Float32Array);","    const vectors: number[][] = [];","    for (let i = 0; i < floatArr.length; i += dims) {","      vectors.push(floatArr.slice(i, i + dims));","    }","    return vectors;","  }","","  throw new Error(\"Unknown embedding output shape\");","}","","/**"," * Cosine similarity between two vectors a and b."," */","export function cosineSimilarity(a: number[], b: number[]) {","  if (!a || !b || a.length !== b.length) return 0;","  let dot = 0;","  let na = 0;","  let nb = 0;","  for (let i = 0; i < a.length; i++) {","    dot += a[i] * b[i];","    na += a[i] * a[i];","    nb += b[i] * b[i];","  }","  if (na === 0 || nb === 0) return 0;","  return dot / (Math.sqrt(na) * Math.sqrt(nb));","}","","/**"," * Given an array of objects with a `text` property (string),"," * returns a mapping of duplicates based on semantic similarity."," *"," * threshold: cosine similarity threshold (0..1). Default 0.85 (adjustable)."," *"," * Returns:"," * {"," *   embeddings: number[][],"," *   pairs: Array<{i:number, j:number, score:number}>  // pairs above threshold"," * }"," */","export async function findDuplicates(items: { id?: string | number; text: string }[], threshold = 0.85) {","  if (!Array.isArray(items) || items.length === 0) {","    return { embeddings: [], pairs: [] };","  }","","  // Concatenate texts (shorten if too long)","  const texts = items.map((it) => {","    // trim long input to ~250 tokens (approx). Keep within model limits.","    const t = (it.text || \"\").trim();","    if (t.length > 2000) return t.slice(0, 2000);","    return t;","  });","","  // Compute embeddings","  const embeddings = await embedTexts(texts);","","  // Compute pairwise similarity","  const pairs: Array<{ i: number; j: number; score: number }> = [];","  for (let i = 0; i < embeddings.length; i++) {","    for (let j = i + 1; j < embeddings.length; j++) {","      const score = cosineSimilarity(embeddings[i], embeddings[j]);","      if (score >= threshold) {","        pairs.push({ i, j, score });","      }","    }","  }","","  return { embeddings, pairs };","}","",""]}],[95,{"id":95,"path":"/home/milan/Desktop/bug-sense/frontend/extension/assets/gif.worker.js","size":10817,"mtime":1761738007660.98,"lines":["!function(t){function e(r){if(i[r])return i[r].exports;var s=i[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p=\"\",e(0)}([function(t,e,i){var r,s;r=i(1),s=function(t){var e,i,s,o;return e=new r(t.width,t.height),0===t.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(t.transparent),e.setRepeat(t.repeat),e.setDelay(t.delay),e.setQuality(t.quality),e.setDither(t.dither),e.setGlobalPalette(t.globalPalette),e.addFrame(t.data),t.last&&e.finish(),t.globalPalette===!0&&(t.globalPalette=e.getGlobalPalette()),s=e.stream(),t.data=s.pages,t.cursor=s.cursor,t.pageSize=s.constructor.pageSize,t.canTransfer?(o=function(){var e,r,s,o;for(s=t.data,o=[],e=0,r=s.length;e<r;e++)i=s[e],o.push(i.buffer);return o}(),self.postMessage(t,o)):self.postMessage(t)},self.onmessage=function(t){return s(t.data)}},function(t,e,i){function r(){this.page=-1,this.pages=[],this.newPage()}function s(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new r}var o=i(2),n=i(3);r.pageSize=4096,r.charMap={};for(var a=0;a<256;a++)r.charMap[a]=String.fromCharCode(a);r.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(r.pageSize),this.cursor=0},r.prototype.getData=function(){for(var t=\"\",e=0;e<this.pages.length;e++)for(var i=0;i<r.pageSize;i++)t+=r.charMap[this.pages[e][i]];return t},r.prototype.writeByte=function(t){this.cursor>=r.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},r.prototype.writeUTFBytes=function(t){for(var e=t.length,i=0;i<e;i++)this.writeByte(t.charCodeAt(i))},r.prototype.writeBytes=function(t,e,i){for(var r=i||t.length,s=e||0;s<r;s++)this.writeByte(t[s])},s.prototype.setDelay=function(t){this.delay=Math.round(t/10)},s.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},s.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},s.prototype.setRepeat=function(t){this.repeat=t},s.prototype.setTransparent=function(t){this.transparent=t},s.prototype.addFrame=function(t){this.image=t,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),this.globalPalette===!0&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.globalPalette||this.writePalette(),this.writePixels(),this.firstFrame=!1},s.prototype.finish=function(){this.out.writeByte(59)},s.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},s.prototype.setDither=function(t){t===!0&&(t=\"FloydSteinberg\"),this.dither=t},s.prototype.setGlobalPalette=function(t){this.globalPalette=t},s.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},s.prototype.writeHeader=function(){this.out.writeUTFBytes(\"GIF89a\")},s.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new o(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace(\"-serpentine\",\"\"),null!==this.dither.match(/-serpentine/)):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent,!0))},s.prototype.indexPixels=function(){var t=this.pixels.length/3;this.indexedPixels=new Uint8Array(t);for(var e=0,i=0;i<t;i++){var r=this.findClosestRGB(255&this.pixels[e++],255&this.pixels[e++],255&this.pixels[e++]);this.usedEntry[r]=!0,this.indexedPixels[i]=r}},s.prototype.ditherPixels=function(t,e){var i={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[.25,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!t||!i[t])throw\"Unknown dithering kernel: \"+t;var r=i[t],s=0,o=this.height,n=this.width,a=this.pixels,h=e?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var l=0;l<o;l++){e&&(h*=-1);for(var u=1==h?0:n-1,p=1==h?n:0;u!==p;u+=h){s=l*n+u;var f=3*s,c=a[f],y=a[f+1],w=a[f+2];f=this.findClosestRGB(c,y,w),this.usedEntry[f]=!0,this.indexedPixels[s]=f,f*=3;for(var d=this.colorTab[f],g=this.colorTab[f+1],x=this.colorTab[f+2],b=c-d,v=y-g,P=w-x,m=1==h?0:r.length-1,B=1==h?r.length:0;m!==B;m+=h){var S=r[m][1],T=r[m][2];if(S+u>=0&&S+u<n&&T+l>=0&&T+l<o){var M=r[m][0];f=s+S+T*n,f*=3,a[f]=Math.max(0,Math.min(255,a[f]+b*M)),a[f+1]=Math.max(0,Math.min(255,a[f+1]+v*M)),a[f+2]=Math.max(0,Math.min(255,a[f+2]+P*M))}}}}},s.prototype.findClosest=function(t,e){return this.findClosestRGB((16711680&t)>>16,(65280&t)>>8,255&t,e)},s.prototype.findClosestRGB=function(t,e,i,r){if(null===this.colorTab)return-1;if(this.neuQuant&&!r)return this.neuQuant.lookupRGB(t,e,i);for(var s=0,o=16777216,n=this.colorTab.length,a=0,h=0;a<n;h++){var l=t-(255&this.colorTab[a++]),u=e-(255&this.colorTab[a++]),p=i-(255&this.colorTab[a++]),f=l*l+u*u+p*p;(!r||this.usedEntry[h])&&f<o&&(o=f,s=h)}return s},s.prototype.getImagePixels=function(){var t=this.width,e=this.height;this.pixels=new Uint8Array(t*e*3);for(var i=this.image,r=0,s=0,o=0;o<e;o++)for(var n=0;n<t;n++)this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],this.pixels[s++]=i[r++],r++},s.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var t,e;null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&dispose),e<<=2,this.out.writeByte(0|e|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},s.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},s.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},s.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes(\"NETSCAPE2.0\"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},s.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},s.prototype.writeShort=function(t){this.out.writeByte(255&t),this.out.writeByte(t>>8&255)},s.prototype.writePixels=function(){var t=new n(this.width,this.height,this.indexedPixels,this.colorDepth);t.encode(this.out)},s.prototype.stream=function(){return this.out},t.exports=s},function(t,e){function i(t,e){function i(){z=[],E=new Int32Array(256),R=new Int32Array(s),U=new Int32Array(s),Q=new Int32Array(s>>3);var t,e;for(t=0;t<s;t++)e=(t<<n+8)/s,z[t]=new Float64Array([e,e,e,0]),U[t]=h/s,R[t]=0}function c(){for(var t=0;t<s;t++)z[t][0]>>=n,z[t][1]>>=n,z[t][2]>>=n,z[t][3]=t}function w(t,e,i,r,s){z[e][0]-=t*(z[e][0]-i)/b,z[e][1]-=t*(z[e][1]-r)/b,z[e][2]-=t*(z[e][2]-s)/b}function x(t,e,i,r,o){for(var n,a,h=Math.abs(e-t),l=Math.min(e+t,s),u=e+1,p=e-1,f=1;u<l||p>h;)a=Q[f++],u<l&&(n=z[u++],n[0]-=a*(n[0]-i)/B,n[1]-=a*(n[1]-r)/B,n[2]-=a*(n[2]-o)/B),p>h&&(n=z[p--],n[0]-=a*(n[0]-i)/B,n[1]-=a*(n[1]-r)/B,n[2]-=a*(n[2]-o)/B)}function v(t,e,i){t=0|t,e=0|e,i=0|i;var r,o,h,c,y,w=~(1<<31),d=w,g=-1,x=g;for(r=0;r<s;r++)o=z[r],h=Math.abs((0|o[0])-t)+Math.abs((0|o[1])-e)+Math.abs((0|o[2])-i)|0,h<w&&(w=h,g=r),c=h-((0|R[r])>>a-n),c<d&&(d=c,x=r),y=U[r]>>u,U[r]-=y,R[r]+=y<<l;return U[g]+=p,R[g]-=f,x}function m(){var t,e,i,r,n,a,h=0,l=0;for(t=0;t<s;t++){for(i=z[t],n=t,a=i[1],e=t+1;e<s;e++)r=z[e],r[1]<a&&(n=e,a=r[1]);if(r=z[n],t!=n&&(e=r[0],r[0]=i[0],i[0]=e,e=r[1],r[1]=i[1],i[1]=e,e=r[2],r[2]=i[2],i[2]=e,e=r[3],r[3]=i[3],i[3]=e),a!=h){for(E[h]=l+t>>1,e=h+1;e<a;e++)E[e]=t;h=a,l=t}}for(E[h]=l+o>>1,e=h+1;e<256;e++)E[e]=o}function C(t,e,i){t=0|t,e=0|e,i=0|i;for(var r,o,n,a=1e3,h=-1,l=0|E[e],u=l-1;l<s||u>=0;)l<s&&(o=z[l],n=(0|o[1])-e,n>=a?l=s:(l++,n<0&&(n=-n),r=(0|o[0])-t,r<0&&(r=-r),n+=r,n<a&&(r=(0|o[2])-i,r<0&&(r=-r),n+=r,n<a&&(a=n,h=0|o[3])))),u>=0&&(o=z[u],n=e-(0|o[1]),n>=a?u=-1:(u--,n<0&&(n=-n),r=(0|o[0])-t,r<0&&(r=-r),n+=r,n<a&&(r=(0|o[2])-i,r<0&&(r=-r),n+=r,n<a&&(a=n,h=0|o[3]))));return h}function I(){var i,s=t.length,o=30+(e-1)/3,a=s/(3*e),h=~~(a/r),l=b,u=d,p=u>>y;for(p<=1&&(p=0),i=0;i<p;i++)Q[i]=l*((p*p-i*i)*P/(p*p));var f;s<A?(e=1,f=3):f=s%S!==0?3*S:s%T!==0?3*T:s%M!==0?3*M:3*F;var c,m,B,C,I=0;for(i=0;i<a;)if(c=(255&t[I])<<n,m=(255&t[I+1])<<n,B=(255&t[I+2])<<n,C=v(c,m,B),w(l,C,c,m,B),0!==p&&x(p,C,c,m,B),I+=f,I>=s&&(I-=s),i++,0===h&&(h=1),i%h===0)for(l-=l/o,u-=u/g,p=u>>y,p<=1&&(p=0),C=0;C<p;C++)Q[C]=l*((p*p-C*C)*P/(p*p))}function D(){i(),I(),c(),m()}function G(){for(var t=[],e=[],i=0;i<s;i++)e[z[i][3]]=i;for(var r=0,o=0;o<s;o++){var n=e[o];t[r++]=z[n][0],t[r++]=z[n][1],t[r++]=z[n][2]}return t}var z,E,R,U,Q;this.buildColormap=D,this.getColormap=G,this.lookupRGB=C}var r=100,s=256,o=s-1,n=4,a=16,h=1<<a,l=10,u=10,p=h>>u,f=h<<l-u,c=s>>3,y=6,w=1<<y,d=c*w,g=30,x=10,b=1<<x,v=8,P=1<<v,m=x+v,B=1<<m,S=499,T=491,M=487,F=503,A=3*F;t.exports=i},function(t,e){function i(t,e,i,a){function h(t,e){S[x++]=t,x>=254&&c(e)}function l(t){u(o),A=P+2,C=!0,d(P,t)}function u(t){for(var e=0;e<t;++e)T[e]=-1}function p(t,e){var i,n,a,h,p,f,c;for(v=t,C=!1,n_bits=v,b=y(n_bits),P=1<<t-1,m=P+1,A=P+2,x=0,h=w(),c=0,i=o;i<65536;i*=2)++c;c=8-c,f=o,u(f),d(P,e);t:for(;(n=w())!=r;)if(i=(n<<s)+h,a=n<<c^h,T[a]!==i){if(T[a]>=0){p=f-a,0===a&&(p=1);do if((a-=p)<0&&(a+=f),T[a]===i){h=M[a];continue t}while(T[a]>=0)}d(h,e),h=n,A<1<<s?(M[a]=A++,T[a]=i):l(e)}else h=M[a];d(h,e),d(m,e)}function f(i){i.writeByte(B),remaining=t*e,curPixel=0,p(B+1,i),i.writeByte(0)}function c(t){x>0&&(t.writeByte(x),t.writeBytes(S,0,x),x=0)}function y(t){return(1<<t)-1}function w(){if(0===remaining)return r;--remaining;var t=i[curPixel++];return 255&t}function d(t,e){for(g&=n[F],F>0?g|=t<<F:g=t,F+=n_bits;F>=8;)h(255&g,e),g>>=8,F-=8;if((A>b||C)&&(C?(b=y(n_bits=v),C=!1):(++n_bits,b=n_bits==s?1<<s:y(n_bits))),t==m){for(;F>0;)h(255&g,e),g>>=8,F-=8;c(e)}}var g,x,b,v,P,m,B=Math.max(2,a),S=new Uint8Array(256),T=new Int32Array(o),M=new Int32Array(o),F=0,A=0,C=!1;this.encode=f}var r=-1,s=12,o=5003,n=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];t.exports=i}]);","//# sourceMappingURL=gif.worker.js.map"]}],[96,{"id":96,"path":"/home/milan/Desktop/bug-sense/frontend/extension/background/index.ts","size":30235,"mtime":1762451968777.9517,"lines":["// extension/background/index.ts","// Background service worker for Bug Sense (Manifest V3)","// Handles START/STOP recording (tabCapture), and handles one-shot CAPTURE_FRAME requests","// from content scripts to capture visible tab screenshot. Returns screenshot as data URL.","","type Msg =","  | { action: \"START_RECORDING\" }","  | { action: \"STOP_RECORDING\" }","  | { action: \"OPEN_GIF_UPLOADER\" }","  | { action: \"OPEN_RECORDER_WINDOW\" }","  | { action: \"CAPTURE_FRAME\" }","  | { action: \"TAKE_SCREENSHOT\" }","  | { action: \"SAVE_ANNOTATED_IMAGE_DATAURL\" }","  | { action: \"OPEN_REPLAY_EXPORT_PAGE\" }","  | { action: \"HIDE_OVERLAY_AND_CAPTURE\" };","","let mediaRecorder: MediaRecorder | null = null;","let recordedChunks: BlobPart[] = [];","let activeStream: MediaStream | null = null;","const lastSavedUrlKey = \"recordedVideo\";","","// Safety listener to silence \"async channel closed\" warnings","// This acts as a safety net for any message that truly never calls sendResponse.","// It doesn't replace proper fixes, but prevents random console spam while you fix remaining listeners.","chrome.runtime.onMessage.addListener(() => {","  // Intentionally no-op.","});","","function setRecordingFlag(on: boolean) {","  try {","    chrome.storage.local.set({ isRecording: on });","  } catch (e) {","    // ignore","  }","}","","function saveBlobUrlToStorage(key: string, url: string) {","  try {","    chrome.storage.local.get([key], (data) => {","      try {","        const prev = data?.[key];","        if (prev && typeof prev === \"string\") {","          try {","            URL.revokeObjectURL(prev);","          } catch { }","        }","      } catch { }","      try {","        chrome.storage.local.set({ [key]: url });","      } catch (err) {","        console.warn(\"Failed to set storage key:\", key, err);","      }","    });","  } catch (err) {","    console.warn(\"saveBlobUrlToStorage outer error:\", err);","    try {","      chrome.storage.local.set({ [key]: url });","    } catch { }","  }","}","","function finalizeRecording() {","  try {","    if (recordedChunks.length > 0) {","      const blob = new Blob(recordedChunks, { type: \"video/webm\" });","      const url = URL.createObjectURL(blob);","      saveBlobUrlToStorage(lastSavedUrlKey, url);","    }","  } catch (err) {","    console.error(\"finalizeRecording error:\", err);","  } finally {","    try {","      activeStream?.getTracks().forEach((t) => t.stop());","    } catch { }","    recordedChunks = [];","    mediaRecorder = null;","    activeStream = null;","    setRecordingFlag(false);","  }","}","","// Try background tab capture (tabCapture API)","function tryTabCapture(): Promise<MediaStream | null> {","  return new Promise((resolve) => {","    try {","      const tc: any = (chrome as any).tabCapture;","      if (!tc || typeof tc.capture !== \"function\") {","        resolve(null);","        return;","      }","      tc.capture({ video: true, audio: false }, (stream: MediaStream | undefined) => {","        if (!stream) {","          console.warn(\"tabCapture returned no stream:\", chrome.runtime.lastError?.message);","          resolve(null);","          return;","        }","        resolve(stream);","      });","    } catch (err) {","      console.warn(\"tryTabCapture threw:\", err);","      resolve(null);","    }","  });","}","","console.log(\"[BugSense Background] Service worker active âœ…\");","","//---------------------------------------------","chrome.runtime.onInstalled.addListener(() => {","  // Create parent menu","  chrome.contextMenus.create({","    id: \"BUGSENSE_MAIN_MENU\",","    title: \"Bug Sense\",","    contexts: [\"all\"],","  });","  // Add two submenus","  chrome.contextMenus.create({","    id: \"BUGSENSE_FULL_SCREENSHOT\",","    parentId: \"BUGSENSE_MAIN_MENU\",","    title: \"Create bug report (Full screen)\",","    contexts: [\"all\"],","  });","  chrome.contextMenus.create({","    id: \"BUGSENSE_SELECTIVE_SCREENSHOT\",","    parentId: \"BUGSENSE_MAIN_MENU\",","    title: \"Create bug report (Select area)\",","    contexts: [\"all\"],","  });","  console.log(\"[BugSense] Background installed. Context menu created âœ…\");","});","","// 2. Replace your onClicked listener with this new one","chrome.contextMenus.onClicked.addListener(async (info, tab) => {","  if (!tab?.id) return;","","  if (info.menuItemId === \"BUGSENSE_FULL_SCREENSHOT\") {","    chrome.runtime.sendMessage({","      action: \"TRIGGER_BUG_CREATION_FROM_CONTEXT\",","      mode: \"full\",","      selectionText: info.selectionText,","      srcUrl: info.srcUrl,","      linkUrl: info.linkUrl,","    });","  }","","  if (info.menuItemId === \"BUGSENSE_SELECTIVE_SCREENSHOT\") {","    // Inject selectionOverlay.js only once per page (guard in the page avoids duplicate listeners)","    try {","      await chrome.scripting.executeScript({","        target: { tabId: tab.id },","        func: () => {","          // Run in page context:","          // If already injected, mark won't re-inject","          // NOTE: window is page's window object (this function serializes into the page)","          // __bugSenseOverlayInjected is a page-global guard.","          if ((window as any).__bugSenseOverlayInjected) return;","          (window as any).__bugSenseOverlayInjected = true;","","          // Create a script tag that loads extension file (this avoids multiple copies of same content script","          // being registered by the extension engine)","          const s = document.createElement(\"script\");","          s.src = chrome.runtime.getURL(\"extension/content/selectionOverlay.js\");","          s.async = true;","          document.documentElement.appendChild(s);","        },","      });","    } catch (err) {","      // If programmatic injection fails, fallback to injecting via files (best-effort)","      console.warn(\"[BugSense] programmatic injection failed, falling back to file injection:\", err);","      try {","        await chrome.scripting.executeScript({","          target: { tabId: tab.id },","          files: [\"extension/content/selectionOverlay.js\"],","        });","      } catch (err2) {","        console.warn(\"[BugSense] fallback injection also failed:\", err2);","      }","    }","","    // Trigger the overlay to start selection (content script listens for this message)","    chrome.tabs.sendMessage(tab.id, { action: \"START_SELECTIVE_CAPTURE\" });","  }","});","//---------------------------------------------","","// ==========================================================","// ðŸ†• BUGSENSE SCREENSHOT HANDLER (Non-blocking + Full Res + Preview)","// ==========================================================","","type FullImageRecord = {","  dataUrl: string;      // full screenshot (dataURL)","  filename: string;     // download filename","  createdAt: number;    // timestamp for auto cleanup","};","","const FULL_IMAGE_CACHE = new Map<string, FullImageRecord>();","const FULL_IMAGE_TTL = 1000 * 60 * 5; // 5 minutes","","function scheduleScreenshotCleanup(key: string, delay = FULL_IMAGE_TTL) {","  setTimeout(() => {","    FULL_IMAGE_CACHE.delete(key);","  }, delay);","}","","async function createPreviewDataUrl(blob: Blob, maxW = 800, maxH = 600, quality = 0.7): Promise<string> {","  try {","    const bitmap = await createImageBitmap(blob);","    const scale = Math.min(1, Math.min(maxW / bitmap.width, maxH / bitmap.height));","    const w = Math.round(bitmap.width * scale);","    const h = Math.round(bitmap.height * scale);","","    const canvas = new OffscreenCanvas(w, h);","    const ctx = canvas.getContext(\"2d\");","    if (!ctx) throw new Error(\"Failed to create OffscreenCanvas context\");","","    ctx.drawImage(bitmap, 0, 0, w, h);","    const previewBlob = await (canvas as any).convertToBlob({ type: \"image/jpeg\", quality });","    bitmap.close();","","    const reader = new FileReader();","    return await new Promise((resolve, reject) => {","      reader.onload = () => resolve(reader.result as string);","      reader.onerror = reject;","      reader.readAsDataURL(previewBlob);","    });","  } catch (err) {","    console.warn(\"[BugSense] Preview downscale failed:\", err);","    return \"\";","  }","}","","// ðŸ§  TAKE_SCREENSHOT & DOWNLOAD_FULL_SCREENSHOT handler","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg?.action === \"TAKE_SCREENSHOT\") {","    try {","      console.log(\"[BugSense Background] TAKE_SCREENSHOT triggered ðŸ–¼ï¸\");","","      chrome.tabs.query({ active: true, currentWindow: true }, async (tabs) => {","        const tab = tabs?.[0];","        if (!tab || !tab.windowId) {","          sendResponse({ success: false, error: \"No active tab\" });","          return;","        }","","        chrome.tabs.captureVisibleTab(tab.windowId, { format: \"jpeg\", quality: 85 }, async (dataUrl) => {","          if (chrome.runtime.lastError) {","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"captureVisibleTab failed\",","            });","            return;","          }","","          if (!dataUrl) {","            sendResponse({ success: false, error: \"Empty screenshot\" });","            return;","          }","","          try {","            // Full image storage","            const filename = `bug-sense-screenshot-${Date.now()}.jpg`;","            const key = `bugSense_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;","            FULL_IMAGE_CACHE.set(key, { dataUrl, filename, createdAt: Date.now() });","            scheduleScreenshotCleanup(key);","","            // Generate small preview","            const blob = await (await fetch(dataUrl)).blob();","            let previewUrl = dataUrl;","            try {","              const preview = await createPreviewDataUrl(blob, 600, 400, 0.7);","              if (preview) previewUrl = preview;","            } catch { }","","            sendResponse({","              success: true,","              preview: previewUrl,","              fullKey: key,","              filename,","            });","          } catch (err) {","            sendResponse({ success: false, error: String(err) });","          }","        });","      });","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","","    return true; // keep sendResponse async","  }","","  if (msg?.action === \"DOWNLOAD_FULL_SCREENSHOT\" && msg.fullKey) {","    try {","      const entry = FULL_IMAGE_CACHE.get(msg.fullKey);","      if (!entry) {","        sendResponse({ success: false, error: \"Screenshot expired or missing\" });","        return;","      }","","      chrome.downloads.download(","        {","          url: entry.dataUrl,","          filename: entry.filename,","          saveAs: true,","        },","        (id) => {","          if (chrome.runtime.lastError) {","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"Download failed\",","            });","          } else {","            sendResponse({ success: true, downloadId: id });","          }","          FULL_IMAGE_CACHE.delete(msg.fullKey);","        }","      );","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","","    return true; // async","  }","});","// ==========================================================","// ðŸ§  FINAL: SAVE_ANNOTATED_IMAGE_DATAURL (High Quality JPEG)","// ==========================================================","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg?.action === \"SAVE_ANNOTATED_IMAGE_DATAURL\") {","    try {","      const { dataUrl } = msg;","      if (!dataUrl || !dataUrl.startsWith(\"data:image\")) {","        sendResponse({ success: false, error: \"Invalid data URL\" });","        return;","      }","","      // Force proper JPEG extension and MIME","      const filename = `bug-sense-annotated-${Date.now()}.jpg`;","      const jpegDataUrl = dataUrl.replace(/^data:image\\/[^;]+/, \"data:image/jpeg\");","","      chrome.downloads.download(","        {","          url: jpegDataUrl,","          filename,","          saveAs: true,","        },","        (downloadId) => {","          if (chrome.runtime.lastError) {","            console.error(\"[BugSense] Annotated JPEG download failed:\", chrome.runtime.lastError);","            sendResponse({","              success: false,","              error: chrome.runtime.lastError.message || \"Download failed\",","            });","          } else {","            console.log(\"[BugSense] Annotated image download started:\", downloadId);","            sendResponse({ success: true });","          }","        }","      );","    } catch (err) {","      console.error(\"[BugSense] SAVE_ANNOTATED_IMAGE_DATAURL failed:\", err);","      sendResponse({ success: false, error: String(err) });","    }","","    return true; // async response","  }","});","","// ---------- Recording & misc handler (single big listener) ----------","chrome.runtime.onMessage.addListener((msg: any, sender, sendResponse) => {","  // Wrap the handler logic in an async IIFE so we can await and always call sendResponse.","  (async () => {","    try {","      if (!msg || !msg.action) {","        // nothing to do","        return;","      }","","      if (msg.action === \"START_RECORDING\") {","        console.log(\"Background: START_RECORDING received\");","","        if (mediaRecorder && mediaRecorder.state === \"recording\") {","          sendResponse({ success: true, alreadyRecording: true });","          return;","        }","","        const stream = await tryTabCapture();","        if (!stream) {","          console.warn(\"tabCapture unavailable -> use separate recorder window\");","          sendResponse({ success: false, requireRecorderWindow: true });","          return;","        }","","        activeStream = stream;","        recordedChunks = [];","","        try {","          mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm\" });","        } catch (err) {","          console.error(\"MediaRecorder init failed:\", err);","          sendResponse({ success: false });","          return;","        }","","        mediaRecorder.ondataavailable = (e) => {","          if (e.data && e.data.size > 0) recordedChunks.push(e.data);","        };","        mediaRecorder.onstop = finalizeRecording;","        mediaRecorder.start();","","        setRecordingFlag(true);","        console.log(\"Background: Recording started ðŸŽ¥\");","        sendResponse({ success: true });","        return;","      }","","      if (msg.action === \"STOP_RECORDING\") {","        if (mediaRecorder && mediaRecorder.state === \"recording\") {","          console.log(\"Background: STOP_RECORDING triggered\");","          mediaRecorder.stop();","          sendResponse({ success: true });","        } else {","          setRecordingFlag(false);","          sendResponse({ success: true, alreadyStopped: true });","        }","        return;","      }","","      if (msg.action === \"OPEN_GIF_UPLOADER\") {","        const url = chrome.runtime.getURL(\"extension/uploader/uploader.html\");","        chrome.windows.create({ url, type: \"popup\", width: 660, height: 560 }, () => {","          sendResponse({ opened: true });","        });","        return;","      }","","      if (msg.action === \"OPEN_RECORDER_WINDOW\") {","        const url = chrome.runtime.getURL(\"extension/recorder/recorder.html\");","        chrome.windows.create({ url, type: \"popup\", width: 720, height: 520 }, () => {","          sendResponse({ opened: true });","        });","        return;","      }","","      // ===== CAPTURE FRAME (one-shot) =====","      if (msg.action === \"CAPTURE_FRAME\") {","        try {","          // Query active tab","          chrome.tabs.query({ active: true, currentWindow: true }, async (tabs) => {","            try {","              const tab = tabs?.[0];","              if (!tab) {","                sendResponse({ success: false, error: \"No active tab\" });","                return;","              }","","              // captureVisibleTab takes the windowId of the tab","              const winId = tab.windowId;","              if (typeof winId !== \"number\") {","                sendResponse({ success: false, error: \"Invalid window id\" });","                return;","              }","","              // capture as JPEG (quality to keep size reasonable)","              try {","                chrome.tabs.captureVisibleTab(winId, { format: \"jpeg\", quality: 60 }, (dataUrl) => {","                  if (chrome.runtime.lastError) {","                    console.warn(\"captureVisibleTab runtime error:\", chrome.runtime.lastError);","                    sendResponse({ success: false, error: String(chrome.runtime.lastError.message || chrome.runtime.lastError) });","                    return;","                  }","                  if (dataUrl) {","                    sendResponse({ success: true, screenshot: dataUrl });","                  } else {","                    sendResponse({ success: false, error: \"capture returned empty\" });","                  }","                });","              } catch (capErr) {","                console.error(\"captureVisibleTab call threw:\", capErr);","                sendResponse({ success: false, error: String(capErr) });","              }","            } catch (inner) {","              console.error(\"CAPTURE_FRAME inner error:\", inner);","              sendResponse({ success: false, error: String(inner) });","            }","          });","        } catch (err) {","          console.error(\"CAPTURE_FRAME error:\", err);","          sendResponse({ success: false, error: String(err) });","        }","        return;","      }","","      // ===== APPEND SHEET ROW =====","      // Replace callback-style chrome.identity.getAuthToken with a Promise wrapper so we always sendResponse","      if (msg.action === \"APPEND_SHEET_ROW\") {","        const { sheetId, range, row } = msg;","        try {","          const token = await new Promise<string>((resolve, reject) => {","            try {","              chrome.identity.getAuthToken({ interactive: true }, (t: any) => {","                if (chrome.runtime.lastError || !t) reject(chrome.runtime.lastError || new Error(\"No token\"));","                else resolve(t);","              });","            } catch (e) {","              reject(e);","            }","          });","","          const resp = await fetch(","            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS`,","            {","              method: \"POST\",","              headers: {","                Authorization: `Bearer ${token}`,","                \"Content-Type\": \"application/json\",","              },","              body: JSON.stringify({ values: [row] }),","            }","          );","","          if (!resp.ok) {","            const j = await resp.json().catch(() => null);","            sendResponse({ success: false, error: j || resp.statusText });","            return;","          }","","          const j = await resp.json();","          sendResponse({ success: true, result: j });","        } catch (err) {","          sendResponse({ success: false, error: String(err) });","        }","        return true; // keep message channel open for async response","      }","","    } catch (outer) {","      console.error(\"Background onMessage outer error:\", outer);","      try {","        sendResponse({ success: false, error: String(outer) });","      } catch { }","    }","  })();","","  // indicate we'll call sendResponse asynchronously (for branches that need it)","  return true;","});","","// Ensure replayListener is injected into pages that are navigated","chrome.runtime.onInstalled.addListener(() => {","  console.log(\"[BugSense] Background installed. ready to inject content scripts when tabs update.\");","});","","chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {","  try {","    if (changeInfo.status === \"complete\" && /^https?:/.test(tab.url || \"\")) {","      const fileToInject = \"extension/content/replayListener.js\";","      // small delay to ensure DOM is ready","      await new Promise((r) => setTimeout(r, 200));","      try {","        await chrome.scripting.executeScript({","          target: { tabId },","          files: [fileToInject],","        });","        console.log(`[BugSense] replayListener injected into ${tab.url}`);","      } catch (err) {","        console.warn(\"[BugSense] replayListener inject failed (maybe already injected):\", err);","      }","    }","  } catch (outer) {","    console.error(\"[BugSense] tabs.onUpdated handler error:\", outer);","  }","});","","// background/index.ts (in the service worker)","// Replace or add this injection logic (non-invasive)","chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {","  try {","    // only act when the tab finished loading and the url is a Google Sheet","    if (changeInfo.status !== \"complete\" || !tab?.url || !tab.url.includes(\"docs.google.com/spreadsheets\")) {","      return;","    }","","    console.log(\"[BugSense] Google Sheet tab detected â€” enumerating frames for injection...\");","","    // small delay to let Google mount frames","    await new Promise((r) => setTimeout(r, 800));","","    // get frame list for the tab (requires \"webNavigation\" permission)","    chrome.webNavigation.getAllFrames({ tabId }, async (frames) => {","      try {","        if (!frames || frames.length === 0) {","          console.warn(\"[BugSense] No frames returned by webNavigation.getAllFrames()\");","          // as fallback inject into top frame (best effort)","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (fallback)\");","          return;","        }","","        // attempt to inject into a best-match frame (sheet/grid frames often contain 'docs' or 'client' urls)","        let injected = false;","","        for (const f of frames) {","          const url = f.url || \"\";","          // pick frames that look like they belong to the sheet or docs app","          if (url.includes(\"docs.google.com\") || url.includes(\"client\") || url.includes(\"spreadsheets\")) {","            try {","              // Attempt injection into this frameId (only same-origin or injectable frames will succeed)","              await chrome.scripting.executeScript({","                target: { tabId, frameIds: [f.frameId] },","                files: [\"extension/content/duplicateBugDetector.js\"],","              });","              console.log(`[BugSense] duplicateBugDetector injected into frameId=${f.frameId} url=${url}`);","              injected = true;","              break;","            } catch (err) {","              // likely cross-origin / sandboxed frame - ignore and try next","              console.warn(`[BugSense] frame ${f.frameId} injection failed (ignored):`, url, err);","            }","          }","        }","","        // If none matched, fallback to injecting into top frame (best-effort)","        if (!injected) {","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (final fallback)\");","        }","      } catch (err) {","        console.warn(\"[BugSense] Error enumerating frames / injecting:\", err);","        // fallback to top frame injection","        try {","          await chrome.scripting.executeScript({","            target: { tabId },","            files: [\"extension/content/duplicateBugDetector.js\"],","          });","          console.log(\"[BugSense] duplicateBugDetector injected into top frame (error fallback)\");","        } catch (e) {","          console.warn(\"[BugSense] final fallback injection failed:\", e);","        }","      }","    });","  } catch (outer) {","    console.error(\"[BugSense] tabs.onUpdated injection outer error:\", outer);","  }","});","","//----------------","chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {","  if (message.action === \"GET_GOOGLE_TOKEN\") {","    // Wrap the chrome.identity.getAuthToken callback in a Promise to ensure we always call sendResponse.","    (async () => {","      try {","        const token = await new Promise<string>((resolve, reject) => {","          try {","            chrome.identity.getAuthToken({ interactive: true }, (t: any) => {","              if (chrome.runtime.lastError || !t) reject(chrome.runtime.lastError || new Error(\"No token\"));","              else resolve(t);","            });","          } catch (e) {","            reject(e);","          }","        });","        sendResponse({ success: true, token });","      } catch (e) {","        console.error(\"[BugSense Background] Failed to get auth token:\", e);","        sendResponse({ success: false, error: String(e) });","      }","    })();","","    return true; // keep message channel open for async response","  }","});","","// ========== Simple Caching Layer ==========","const CACHE_KEY = \"bugSenseCache\";","const CACHE_EXPIRY = 1000 * 60 * 10; // 10 minutes","","async function getCachedData(sheetId: string, range: string) {","  const cache = await chrome.storage.local.get(CACHE_KEY);","  const now = Date.now();","","  if (cache[CACHE_KEY] && now - cache[CACHE_KEY].timestamp < CACHE_EXPIRY) {","    console.log(\"[BugSense] Loaded data from cache ðŸ§ \");","    return cache[CACHE_KEY].data;","  }","","  // ask content script for new data","  return new Promise((resolve) => {","    chrome.runtime.sendMessage({ action: \"FETCH_SHEET_DATA\", sheetId, range }, async (response) => {","      await chrome.storage.local.set({","        [CACHE_KEY]: { data: response, timestamp: now },","      });","      console.log(\"[BugSense] Cached new data ðŸ§©\");","      resolve(response);","    });","  });","}","/////////////////////////////////////////","// === BugSense DevTools bridge ===","// This allows DevPanel to receive real-time console messages.","let bugsenseDevPorts: chrome.runtime.Port[] = [];","","chrome.runtime.onConnect.addListener((port) => {","  if (port.name === \"bugsense-devtools\") {","    console.log(\"[BugSense] DevTools connected âœ…\");","    bugsenseDevPorts.push(port);","","    port.onDisconnect.addListener(() => {","      bugsenseDevPorts = bugsenseDevPorts.filter((p) => p !== port);","      console.log(\"[BugSense] DevTools disconnected âŒ\");","    });","  }","});","","// Forward console events to DevTools panel (optional future use)","chrome.runtime.onMessage.addListener((msg, sender) => {","  if (msg.action === \"BUGSENSE_CONSOLE\") {","    bugsenseDevPorts.forEach((p) => p.postMessage(msg));","  }","});","","//-------------------------------","// bugsense_create_bug (single-shot)","chrome.runtime.onMessage.addListener(async (msg, sender, sendResponse) => {","  if (msg.action === \"bugsense_create_bug\") {","    try {","      const { message, file, line, column, time } = msg.payload;","","      // Take screenshot","      const screenshot = await chrome.tabs.captureVisibleTab();","","      // Construct bug object","      const bug = {","        title: `Bug from ${file ? file.split(\"/\").pop() : \"unknown source\"}`,","        description: message,","        file,","        line,","        column,","        time,","        screenshot,","        steps: \"AI will generate reproduction steps from replay and context.\",","        createdAt: new Date().toLocaleString(),","      };","","      await chrome.storage.local.set({ bugsense_clipboard: bug });","","      console.log(\"âœ… [BugSense] Bug saved to clipboard:\", bug);","      sendResponse({ success: true });","    } catch (err) {","      console.error(\"bugsense_create_bug failed:\", err);","      sendResponse({ success: false, error: String(err) });","    }","    return true;","  }","});","","// GET_REPLAY_LOGS handler (keeps channel open and responds)","chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {","  if (msg.action === \"GET_REPLAY_LOGS\") {","    try {","      chrome.storage.local.get([\"replayActionsLog\"], (res) => {","        if (chrome.runtime.lastError) {","          console.warn(\"Error getting replay logs:\", chrome.runtime.lastError);","          sendResponse({ success: false, actions: [] });","        } else {","          const actions = res?.replayActionsLog || [];","          console.log(\"[BugSense Background] Sent replay actions:\", actions);","          sendResponse({ success: true, actions: actions });","        }","      });","    } catch (e) {","      sendResponse({ success: false, error: String(e) });","    }","    return true;","  }","});","","// OPEN_REPLAY_EXPORT_PAGE","chrome.runtime.onMessage.addListener((msg) => {","  if (msg.action === \"OPEN_REPLAY_EXPORT_PAGE\") {","    const url = chrome.runtime.getURL(\"extension/replay-export/replay-export.html\");","    chrome.tabs.create({ url, active: true });","  }","});","","// ======================================================","// âœ… SINGLE handler for selective area capture","// ======================================================","let captureInProgress = false;","","chrome.runtime.onMessage.addListener(async (msg, sender, sendResponse) => {","  if (msg.action !== \"HIDE_OVERLAY_AND_CAPTURE\") return;","","  if (captureInProgress) {","    console.warn(\"[BugSense] Capture already in progress, skipping duplicate\");","    return;","  }","  captureInProgress = true;","","  try {","    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });","    if (!tab?.windowId) throw new Error(\"No active tab\");","","    // Make sure overlay disappears visually","    try {","      await chrome.scripting.executeScript({","        target: { tabId: tab?.id ?? 0 },","        func: () =>","          new Promise<void>((resolve) => {","            requestAnimationFrame(() => {","              document.body.offsetHeight; // flush paint","              resolve();","            });","          }),","      });","    } catch (err) {","      console.warn(\"[BugSense] Repaint script failed:\", err);","    }","","    await new Promise((r) => setTimeout(r, 150));","","    // Do the capture (no sendResponse, pure async)","    const dataUrl = await new Promise<string>((resolve, reject) => {","      chrome.tabs.captureVisibleTab(tab.windowId, { format: \"png\" }, (url) => {","        if (chrome.runtime.lastError || !url)","          reject(chrome.runtime.lastError?.message || \"captureVisibleTab failed\");","        else resolve(url);","      });","    });","","    const blob = await (await fetch(dataUrl)).blob();","    const bitmap = await createImageBitmap(blob);","    const scale = self.devicePixelRatio || 1;","    const canvas = new OffscreenCanvas(msg.rect.width, msg.rect.height);","    const ctx = canvas.getContext(\"2d\");","    if (!ctx) throw new Error(\"No OffscreenCanvas context\");","","    ctx.drawImage(","      bitmap,","      msg.rect.x * scale,","      msg.rect.y * scale,","      msg.rect.width * scale,","      msg.rect.height * scale,","      0,","      0,","      msg.rect.width,","      msg.rect.height","    );","    bitmap.close();","","    const croppedBlob = await canvas.convertToBlob({ type: \"image/png\", quality: 1 });","    const reader = new FileReader();","    reader.onload = () => {","      chrome.runtime.sendMessage({","        action: \"TRIGGER_BUG_CREATION_FROM_CONTEXT\",","        mode: \"selective\",","        screenshot: reader.result,","      });","      captureInProgress = false;","    };","    reader.readAsDataURL(croppedBlob);","  } catch (err) {","    console.error(\"[BugSense] Selective capture failed:\", err);","    captureInProgress = false;","  }","});",""]}],[97,{"id":97,"path":"/home/milan/Desktop/bug-sense/frontend/extension/components/DisplayButton.tsx","size":2873,"mtime":1762343896732.4648,"lines":["import React from 'react';","","// --- Helper Function ---","","/**"," * Calculates text color for a given OKLCH string."," * @param oklchColor - e.g., \"oklch(71.5% 0.143 215.221)\""," * @returns 'text-black' or 'text-white'"," */","function getTextColorForOklch(oklchColor: string): 'text-black' | 'text-white' {","    try {","        // Extracts the \"L\" value (lightness)","        const lightness = parseFloat(oklchColor.split('%')[0].split('(')[1]);","        // OKLCH Lightness is 0-100. Use black text on lighter backgrounds.","        return lightness > 60 ? 'text-black' : 'text-white';","    } catch (e) {","        console.error(\"Could not parse OKLCH string:\", oklchColor, e);","        return 'text-white'; // Default to white","    }","}","","// --- Color Definitions ---","","// 1. For Tailwind: Use underscores _ instead of spaces in arbitrary values","const colorClasses = {","    blue: 'bg-[oklch(70.7%_0.165_254.624)] hover:bg-[oklch(62.3%_0.214_259.815)]',","    green: 'bg-[oklch(79.2%_0.209_151.711)]   hover:bg-[oklch(72.3%_0.219_149.579)]',","    purple: 'bg-[oklch(71.4%_0.203_305.504)]  hover:bg-[oklch(62.7%_0.265_303.9)]',","    red: 'bg-[oklch(70.4%_0.191_22.216)]  hover:bg-[oklch(63.7%_0.237_25.331)]',","    slate: 'bg-[oklch(70.4%_0.04_256.788)] hover:bg-[oklch(55.4%_0.046_257.417)]',","","    dark: 'bg-[oklch(59.6%_0.145_163.225)] hover:bg-[oklch(50.8%_0.118_165.612)]',","}","","// 2. For Text-Contrast Helper: Use normal spaces","const baseColors = {","    blue: 'oklch(70.7% 0.165 254.624)',","    green: 'oklch(79.2% 0.209 151.711)',","    purple: 'oklch(71.4% 0.203 305.504)',","    red: 'oklch(70.4% 0.191 22.216)',","    slate: 'oklch(70.4% 0.04 256.788)',","","    dark: 'oklch(59.6% 0.145 163.225)',","}","","// Define the type for your color prop (adjust as needed)","type ButtonColor = 'blue' | 'green' | 'purple' | 'red' | 'slate' | 'dark';","","// --- Prop Interface ---","","interface buttonProps {","    name: string,","    title?: string,","    onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void,","    color: ButtonColor, // Use our specific color type","    disable?: boolean","}","","// --- Component ---","","function DisplayButton({ name, title = \"\", onClick = () => { }, color = \"slate\", disable = false }: buttonProps) {","","    // 1. Look up the Tailwind class string","    const buttonColorClasses = colorClasses[color];","","    // 2. Look up the base color and get the correct text color","    const baseOklch = baseColors[color];","    const textColorClass = getTextColorForOklch(baseOklch);","","    return (","        <button","            onClick={onClick}","            className={`","                w-full py-2 rounded-lg transition text-base","                ${buttonColorClasses}","                ${textColorClass}","                ${disable ? 'opacity-50 cursor-not-allowed' : ''}","            `}","            title={title}","            disabled={disable}","        >","            {name}","        </button>","    )","}","","export default DisplayButton;"]}],[98,{"id":98,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/consoleListener.ts","size":1651,"mtime":1762158655858.5977,"lines":["// extension/content/consoleListener.ts  (append or ensure similar exists)","(function () {","    const KEY = \"recentConsoleErrors\";","    function pushError(payload: any) {","        try {","            chrome.storage.local.get([KEY], (res) => {","                const arr = Array.isArray(res?.[KEY]) ? res[KEY] : [];","                arr.push({ ...payload, ts: Date.now() });","                // limit length","                const keep = arr.slice(-100);","                chrome.storage.local.set({ [KEY]: keep }, () => { });","            });","        } catch (err) {","            // ignore","        }","    }","","    // capture runtime errors","    window.addEventListener(\"error\", (ev: ErrorEvent) => {","        pushError({","            type: \"runtime\",","            message: ev.message,","            filename: ev.filename,","            lineno: ev.lineno,","            colno: ev.colno,","            stack: ev.error?.stack || null","        });","    });","","    // capture unhandled rejections","    window.addEventListener(\"unhandledrejection\", (ev) => {","        pushError({","            type: \"promise\",","            message: ev.reason?.message || String(ev.reason),","            detail: ev.reason,","            stack: ev.reason?.stack || null","        });","    });","","    // wrap console.error (best-effort, inside page)","    const origConsoleError = console.error?.bind(console) || ((...args: any[]) => { });","    console.error = function (...args: any[]) {","        try {","            pushError({ type: \"console\", message: args.map(x => (typeof x === \"string\" ? x : JSON.stringify(x))).join(\" \"), raw: args, ts: Date.now() });","        } catch { }","        origConsoleError(...args);","    };","})();",""]}],[99,{"id":99,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/duplicateBugDetector.ts","size":6107,"mtime":1762404832176.538,"lines":["// extension/content/duplicateBugDetector.ts","import { findDuplicates } from \"../ai/transformer\";","import { clearHighlights, getSheetData, highlightDuplicates } from \"../utils/sheetsAPI\";","import { addIgnoredPair, getIgnoredPairs, isIgnoredPair } from \"../utils/cache\";","","","console.log(\"%c[BugSense] AI Duplicate Bug Detector Active ðŸ§ \", \"color:#22d3ee\");","","async function initDuplicateDetector() {","  console.log(\"[BugSense] Fetching Google Sheets data via API...\");","","  // Extract spreadsheet ID from URL","  const match = window.location.href.match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","  const spreadsheetId = match ? match[1] : null;","","  if (!spreadsheetId) {","    console.error(\"[BugSense] Could not find spreadsheet ID in URL!\");","    return;","  }","","  try {","    // Fetch data from the sheet named 'bug_report'","    const sheetData: any = await getSheetData(spreadsheetId, \"bug_report!A1:Z1000\");","    const rows = sheetData.values || [];","","    console.log(`[BugSense] Retrieved ${rows.length} rows from Google Sheets âœ…`);","","    if (rows.length < 2) {","      console.warn(\"[BugSense] Not enough data rows to analyze duplicates.\");","      return;","    }","","    // Skip header row","    const header = rows[0];","    const dataRows = rows.slice(1);","","    // Prepare for duplicate detection","    const itemsForEmbedding = dataRows.map((cells: any, i: any) => ({","      id: i + 1,","      text: cells.join(\" . \")","    }));","","    // Find duplicates (via AI/semantic or string match)","    const dupResult = await findDuplicates(itemsForEmbedding, 0.86);","    const pairs = dupResult.pairs ?? [];","    // Filter out previously ignored pairs","    const ignored = await getIgnoredPairs();","    const filteredPairs = pairs.filter((p) => {","      const key = [p.i, p.j].sort().join(\"-\");","      return !ignored.includes(key);","    });","","    console.log(`[BugSense] ${filteredPairs.length} active duplicate pairs after ignoring cached ones.`);","","","    console.log(`[BugSense] Duplicate check complete â€” found ${pairs.length} pairs.`);","","    if (filteredPairs.length > 0) {","      // Call highlight function to mark them red","      await highlightDuplicates(spreadsheetId, rows, filteredPairs);","    }","","    // Show enhanced overlay summary","    renderOverlaySummary(filteredPairs, itemsForEmbedding.length);","  } catch (err) {","    console.error(\"[BugSense] Sheets API failed:\", err);","  }","}","","// ðŸ§© Enhanced overlay with row details","function renderOverlaySummary(pairs: any[], totalRows: number) {","  const overlay = document.createElement(\"div\");","  overlay.id = \"bugsense-summary\";","  Object.assign(overlay.style, {","    position: \"fixed\",","    right: \"12px\",","    bottom: \"12px\",","    background: \"#0b1220\",","    color: \"white\",","    padding: \"14px\",","    borderRadius: \"8px\",","    zIndex: \"999999\",","    width: \"340px\",","    fontFamily: \"Inter, sans-serif\",","    boxShadow: \"0 2px 8px rgba(0,0,0,0.25)\",","  });","","  const title = document.createElement(\"div\");","  title.innerText = \"ðŸ§  BugSense â€” Duplicate Verification\";","  title.style.fontWeight = \"bold\";","  title.style.marginBottom = \"6px\";","  overlay.appendChild(title);","","  const body = document.createElement(\"div\");","  if (pairs.length === 0) {","    body.innerText = \"âœ… No duplicates found!\";","  } else {","    const rowIndices: number[] = [];","    pairs.forEach((p: any) => rowIndices.push(p.i + 2, p.j + 2));","    const uniqueRows = [...new Set(rowIndices.sort((a, b) => a - b))];","    body.innerText = `âš ï¸ ${pairs.length} potential duplicates found (Rows ${uniqueRows.join(\", \")})`;","  }","  overlay.appendChild(body);","","  // ðŸ§© Add buttons","  const footer = document.createElement(\"div\");","  footer.style.marginTop = \"10px\";","  footer.style.display = \"flex\";","  footer.style.justifyContent = \"space-between\";","  footer.style.gap = \"8px\";","","  const confirmDup = document.createElement(\"button\");","  confirmDup.innerText = \"Confirm Duplicates\";","  Object.assign(confirmDup.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#22c55e\",","    color: \"white\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","","  });","","  confirmDup.onclick = async () => {","    alert(\"Duplicates confirmed. You can now remove them manually from your sheet.\");","    overlay.remove();","  };","","  const markNotDup = document.createElement(\"button\");","  markNotDup.innerText = \"Mark as Not Duplicates\";","  Object.assign(markNotDup.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#eab308\",","    color: \"#0b1220\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","  });","","  // inside the onclick:","  markNotDup.onclick = async () => {","    // cache as ignored","    for (const p of pairs) {","      await addIgnoredPair(p.i, p.j);","    }","","    // remove red highlight from Google Sheet","    try {","      const match = window.location.href.match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","      const spreadsheetId = match ? match[1] : null;","      if (spreadsheetId) {","        await clearHighlights(spreadsheetId, pairs);","      }","    } catch (err) {","      console.error(\"[BugSense] Failed to clear highlights:\", err);","    }","","    alert(\"Marked as not duplicates â€” highlights removed and will be skipped next time.\");","    overlay.remove();","  };","","  const close = document.createElement(\"button\");","  close.innerText = \"Close\";","  Object.assign(close.style, {","    flex: \"1\",","    padding: \"6px 10px\",","    background: \"#ef4444\",","    color: \"white\",","    border: \"none\",","    borderRadius: \"6px\",","    cursor: \"pointer\",","  });","  close.onclick = () => overlay.remove();","","  footer.appendChild(confirmDup);","  footer.appendChild(markNotDup);","  footer.appendChild(close);","  // ðŸ’¡ Tip section (ðŸ‘‰ append here, before the footer)","  const tip = document.createElement(\"div\");","  tip.innerHTML = \"<small>ðŸ’¡ Tip: Once confirmed, open your sheet and delete marked rows manually to keep it clean.</small>\";","  tip.style.marginTop = \"8px\";","  tip.style.color = \"#9ca3af\";","  overlay.appendChild(tip);","","  overlay.appendChild(footer);","","  document.body.appendChild(overlay);","}","","// Auto-run on load","if (document.readyState === \"complete\") {","  initDuplicateDetector();","} else {","  window.addEventListener(\"load\", initDuplicateDetector);","}",""]}],[100,{"id":100,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/replayListener.ts","size":14387,"mtime":1762154365735.203,"lines":["// extension/content/replayListener.ts","// Content script for Bug Sense: Records user actions, captures tab snapshots, and","// persists replay data. Designed to survive SPA navigation & avoid context invalidation errors.","","type ActionEvent = {","    type: \"click\" | \"keypress\";","    timestamp: number;","    details: any;","};","","// Configuration constants","const MAX_BUFFER_TIME = 60000; // 60s window of actions","const SCREENSHOT_THROTTLE_MS = 2000; // capture every 2 seconds","const MAX_SCREENSHOTS = 30; // store last 30 frames (~60s)","","let actions: ActionEvent[] = [];","let lastScreenshotTime = 0;","","console.log(\"[BugSense Replay Listener] active âœ…\");","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Safe chrome.storage.set wrapper to avoid â€œExtension context invalidatedâ€ errors","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function safeStorageSet(obj: Record<string, any>) {","    try {","        if (!chrome?.storage?.local) return; // context may be invalid","        chrome.storage.local.set(obj, () => {","            if (chrome.runtime?.lastError) {","                console.warn(\"[BugSense] safeStorageSet warning:\", chrome.runtime.lastError.message);","            }","        });","    } catch (err) {","        if (String(err).includes(\"Extension context invalidated\")) {","            console.log(\"[BugSense] Context invalidated â€” skipping write (safe)\");","            return;","        }","        console.warn(\"[BugSense] safeStorageSet exception:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Core persistence helpers","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","async function persistActions() {","    try {","        safeStorageSet({ recentActions: actions });","    } catch (err) {","        console.warn(\"[BugSense] persistActions error:\", err);","    }","}","","async function persistScreenshotIfAvailable(screenshotDataUrl?: string) {","    if (!screenshotDataUrl) return;","    try {","        chrome.storage.local.get([\"recentScreenshots\"], (res) => {","            const existing: Array<{ screenshot: string; timestamp: number }> =","                Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const appended = [...existing, { screenshot: screenshotDataUrl, timestamp: Date.now() }].slice(-MAX_SCREENSHOTS);","            safeStorageSet({ recentScreenshots: appended });","        });","    } catch (err) {","        console.warn(\"[BugSense] persistScreenshotIfAvailable exception:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Utility: prune old events","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function pruneOld() {","    const now = Date.now();","    actions = actions.filter((a) => now - a.timestamp < MAX_BUFFER_TIME);","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Screenshot capture (request background via message)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","// async function requestCaptureFrame(): Promise<string | null> {","//     try {","//         return await new Promise((resolve) => {","//             try {","//                 chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","//                     if (chrome.runtime.lastError) {","//                         console.warn(\"[replayListener] CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","//                         resolve(null);","//                         return;","//                     }","//                     if (resp?.success && resp.screenshot) {","//                         resolve(resp.screenshot as string);","//                         return;","//                     }","//                     resolve(null);","//                 });","//             } catch (err) {","//                 console.warn(\"[replayListener] CAPTURE_FRAME sendMessage exception:\", err);","//                 resolve(null);","//             }","//         });","//     } catch (err) {","//         console.warn(\"[replayListener] requestCaptureFrame outer error:\", err);","//         return null;","//     }","// }","async function requestCaptureFrame(): Promise<string | null> {","    try {","        if (!chrome.runtime?.id) {","            console.log(\"[replayListener] Extension context invalidated â€” skipping CAPTURE_FRAME\");","            return null; // ðŸ‘ˆ return explicit null instead of undefined","        }","","        const result = await new Promise<string | null>((resolve) => {","            try {","                chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","                    if (chrome.runtime.lastError) {","                        console.warn(\"[replayListener] CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","                        resolve(null);","                        return;","                    }","","                    if (resp?.success && resp.screenshot) {","                        resolve(resp.screenshot as string);","                        return;","                    }","","                    resolve(null);","                });","            } catch (err) {","                console.warn(\"[replayListener] CAPTURE_FRAME sendMessage exception:\", err);","                resolve(null);","            }","        });","","        return result; // âœ… ensures Promise<string | null> consistency","","    } catch (err) {","        if (String(err).includes(\"Extension context invalidated\")) {","            console.log(\"[replayListener] Safe ignore: context invalidated\");","            return null; // ðŸ‘ˆ always return null to match type","        } else {","            console.warn(\"[replayListener] requestCaptureFrame outer error:\", err);","            return null;","        }","    }","}","","","async function maybeCapture() {","    try {","        const now = Date.now();","        if (now - lastScreenshotTime < SCREENSHOT_THROTTLE_MS) return;","        lastScreenshotTime = now;","        const screenshot = await requestCaptureFrame();","        if (screenshot) await persistScreenshotIfAvailable(screenshot);","    } catch (err) {","        console.warn(\"[replayListener] maybeCapture error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Event handlers","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","async function handleClick(e: MouseEvent) {","    try {","        const target = e.target as HTMLElement | null;","        const details = {","            tag: target?.tagName || \"unknown\",","            text: target?.innerText?.slice(0, 100) ?? null,","            x: e.clientX,","            y: e.clientY,","        };","        actions.push({ type: \"click\", timestamp: Date.now(), details });","        pruneOld();","        persistActions();","        await maybeCapture();","    } catch (err) {","        console.warn(\"[replayListener] handleClick error:\", err);","    }","}","","async function handleKeypress(e: KeyboardEvent) {","    try {","        const details = { key: e.key };","        actions.push({ type: \"keypress\", timestamp: Date.now(), details });","        pruneOld();","        persistActions();","        await maybeCapture();","    } catch (err) {","        console.warn(\"[replayListener] handleKeypress error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Listener management","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function addListeners() {","    try {","        window.addEventListener(\"click\", handleClick, true);","        window.addEventListener(\"keypress\", handleKeypress, true);","        console.log(\"[BugSense Replay Listener] listeners attached\");","    } catch (err) {","        console.warn(\"[replayListener] addListeners error:\", err);","    }","}","","function removeListeners() {","    try {","        window.removeEventListener(\"click\", handleClick, true);","        window.removeEventListener(\"keypress\", handleKeypress, true);","        console.log(\"[BugSense Replay Listener] listeners removed\");","    } catch (err) {","        console.warn(\"[replayListener] removeListeners error:\", err);","    }","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Initialization logic","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","function init() {","    try {","        chrome.storage.local.get([\"recentActions\", \"recentScreenshots\"], (res) => {","            try {","                const existing: ActionEvent[] = Array.isArray(res?.recentActions) ? res.recentActions : [];","                actions = existing.filter((a) => Date.now() - a.timestamp < MAX_BUFFER_TIME);","            } catch {","                actions = [];","            }","        });","    } catch (err) {","        console.warn(\"[replayListener] init storage get error:\", err);","    }","    addListeners();","}","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Handle page lifecycle events (SPA/bfcache friendly)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","window.addEventListener(\"pageshow\", (ev: PageTransitionEvent) => {","    try {","        console.log(\"[replayListener] pageshow (persisted=\" + (ev.persisted ? \"yes\" : \"no\") + \")\");","        removeListeners();","        init();","    } catch (err) {","        console.warn(\"[replayListener] pageshow handler error:\", err);","    }","});","","window.addEventListener(\"pagehide\", () => {","    try {","        removeListeners();","    } catch (err) {","        console.warn(\"[replayListener] pagehide handler error:\", err);","    }","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Cleanup and trimming on unload (prevent memory bloat)","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","window.addEventListener(\"beforeunload\", () => {","    try {","        chrome.storage.local.get([\"recentScreenshots\"], (res) => {","            const arr = Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const trimmed = arr.slice(-MAX_SCREENSHOTS);","            safeStorageSet({ recentScreenshots: trimmed });","        });","    } catch { }","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Message listener for replay requests","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","chrome.runtime.onMessage.addListener((msg, _sender, sendResponse) => {","    try {","        if (msg?.action === \"GET_REPLAY_LOGS\") {","            pruneOld();","            sendResponse({ success: true, actions: actions.slice() });","        }","    } catch (err) {","        console.warn(\"[replayListener] onMessage handler error:\", err);","        try {","            sendResponse({ success: false, error: String(err) });","        } catch { }","    }","    return true;","});","","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","//  Initialize script","// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€","init();",""]}],[101,{"id":101,"path":"/home/milan/Desktop/bug-sense/frontend/extension/content/selectionOverlay.ts","size":4122,"mtime":1762436994817.075,"lines":["// extension/content/selectionOverlay.ts","type SelectionRect = { x: number; y: number; width: number; height: number };","","let overlay: HTMLDivElement | null = null;","let box: HTMLDivElement | null = null;","let active = false;","let cleaned = false;","","function createOverlay(): void {","    overlay = document.createElement(\"div\");","    Object.assign(overlay.style, {","        position: \"fixed\",","        inset: \"0\",","        background: \"rgba(0,0,0,0.25)\",","        cursor: \"crosshair\",","        zIndex: \"2147483647\",","        userSelect: \"none\",","        touchAction: \"none\",","    } as Partial<CSSStyleDeclaration>);","","    box = document.createElement(\"div\");","    Object.assign(box.style, {","        position: \"absolute\",","        border: \"2px dashed #00bfff\",","        background: \"rgba(0, 191, 255, 0.12)\",","        boxSizing: \"border-box\",","        pointerEvents: \"none\",","    } as Partial<CSSStyleDeclaration>);","","    overlay.appendChild(box);","    document.documentElement.appendChild(overlay);","}","","function hardRemoveOverlay() {","    if (overlay) overlay.remove();","    overlay = null;","    box = null;","    active = false;","    cleaned = true;","}","","function startSingleSelection(): void {","    if (active) return;","    active = true;","    cleaned = false;","","    createOverlay();","","    let startX = 0;","    let startY = 0;","    let currentPointerId: number | null = null;","","    const onPointerDown = (ev: PointerEvent) => {","        if (ev.button !== 0) return;","","        ev.preventDefault();","        startX = ev.clientX;","        startY = ev.clientY;","        currentPointerId = ev.pointerId;","","        Object.assign(box!.style, {","            left: `${startX}px`,","            top: `${startY}px`,","            width: \"0px\",","            height: \"0px\",","        });","","        try {","            (ev.target as Element).setPointerCapture(ev.pointerId);","        } catch { }","","        window.addEventListener(\"pointermove\", onPointerMove);","        window.addEventListener(\"pointerup\", onPointerUp);","        window.addEventListener(\"pointercancel\", onPointerCancel);","    };","","    const onPointerMove = (ev: PointerEvent) => {","        if (currentPointerId !== ev.pointerId) return;","","        const endX = ev.clientX;","        const endY = ev.clientY;","","        const x = Math.min(startX, endX);","        const y = Math.min(startY, endY);","        const w = Math.abs(endX - startX);","        const h = Math.abs(endY - startY);","","        Object.assign(box!.style, {","            left: `${x}px`,","            top: `${y}px`,","            width: `${w}px`,","            height: `${h}px`,","        });","    };","","    const cleanupListeners = () => {","        window.removeEventListener(\"pointermove\", onPointerMove);","        window.removeEventListener(\"pointerup\", onPointerUp);","        window.removeEventListener(\"pointercancel\", onPointerCancel);","    };","","    const onPointerUp = (ev: PointerEvent) => {","        if (currentPointerId !== ev.pointerId) return;","","        cleanupListeners();","","        const endX = ev.clientX;","        const endY = ev.clientY;","        const rect: SelectionRect = {","            x: Math.min(startX, endX),","            y: Math.min(startY, endY),","            width: Math.abs(endX - startX),","            height: Math.abs(endY - startY),","        };","","        // ðŸš€ Hide overlay instantly (no transparency seen in capture)","        if (overlay) overlay.style.display = \"none\";","","        // Notify background itâ€™s safe to capture","        chrome.runtime.sendMessage({ action: \"HIDE_OVERLAY_AND_CAPTURE\", rect });","","        // Then hard-remove overlay after short delay (cleanup DOM)","        setTimeout(hardRemoveOverlay, 300);","    };","","    const onPointerCancel = () => {","        cleanupListeners();","        hardRemoveOverlay();","    };","","    const onKeyDown = (ev: KeyboardEvent) => {","        if (ev.key === \"Escape\") {","            cleanupListeners();","            hardRemoveOverlay();","        }","    };","","    overlay!.addEventListener(\"pointerdown\", onPointerDown);","    window.addEventListener(\"keydown\", onKeyDown);","}","","/** Listener entry */","chrome.runtime.onMessage.addListener((msg) => {","    if (msg.action === \"START_SELECTIVE_CAPTURE\") {","        startSingleSelection();","    }","});",""]}],[102,{"id":102,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/DevPanel.tsx","size":21295,"mtime":1762437153942.1208,"lines":["// extension/devtools/DevPanel.tsx","import React, { useEffect, useState, useCallback } from \"react\";","// import { analyzeBug } from \"../ai/analyze\";","import { FaRegCopy } from \"react-icons/fa\";","import { getFormattedDate } from \"../utils/formattedDate\";","","import { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";","import { atomDark } from \"react-syntax-highlighter/dist/esm/styles/prism\";","// ------------------------------------------","","type ConsoleErrorItem = {","  ts: number;","  type: string;","  message: string;","  filename?: string;","  lineno?: number;","  colno?: number;","  stack?: string | null;","  raw?: any;","};","","type BugClipboard = {","  title: string;","  description: string;","  steps: string[];","  screenshotDataUrl?: string | null;","  createdAt: string;","  source: { type: \"console\" | \"selection\" | \"image\" | \"link\"; raw: any };","  replayActions?: any[];","};","","","","export default function DevPanel() {","  const [errors, setErrors] = useState<ConsoleErrorItem[]>([]);","  const [loading, setLoading] = useState(false);","  const [message, setMessage] = useState<string | null>(null);","  const [successBanner, setSuccessBanner] = useState(false);","  const [clipboardData, setClipboardData] = useState<BugClipboard | null>(null);","  const [isPreviewVisible, setIsPreviewVisible] = useState(false);","","  const [showExtraModal, setShowExtraModal] = useState(false);","  const [extraText, setExtraText] = useState(\"\");","  const [onExtraConfirm, setOnExtraConfirm] = useState<null | ((text: string | null) => void)>(null);","","  // ... (All your useEffects and functions from createBug... to insertIntoSheet... are unchanged) ...","","  useEffect(() => {","    const load = () => {","      chrome.storage.local.get([\"recentConsoleErrors\"], (res) => {","        const arr = Array.isArray(res?.recentConsoleErrors) ? res.recentConsoleErrors : [];","        setErrors(arr.slice(-200).reverse());","      });","    };","    load();","    const onChange = (changes: any, areaName: string) => {","      if (changes.recentConsoleErrors) {","        const arr = Array.isArray(changes.recentConsoleErrors.newValue) ? changes.recentConsoleErrors.newValue : [];","        setErrors(arr.slice(-200).reverse());","      }","      if (changes.bugClipboard && areaName === \"local\") {","        setSuccessBanner(true);","        setTimeout(() => setSuccessBanner(false), 3000);","      }","    };","    chrome.storage.onChanged.addListener(onChange);","    return () => chrome.storage.onChanged.removeListener(onChange);","  }, []);","","  // Ask user for additional bug details (optional)","  function promptForExtraDetails(): Promise<string | null> {","    return new Promise((resolve) => {","      setExtraText(\"\");","      setOnExtraConfirm(() => resolve);","      setShowExtraModal(true);","    });","  }","","  const captureScreenshot = useCallback(async (mode: \"full\" | \"selective\" = \"full\") => {","    if (mode === \"selective\") {","      return new Promise<string | null>((resolve) => {","        const listener = (msg: any) => {","          if (msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" && msg.mode === \"selective\" && msg.screenshot) {","            chrome.runtime.onMessage.removeListener(listener);","            resolve(msg.screenshot);","          }","        };","        chrome.runtime.onMessage.addListener(listener);","      });","    }","","    // Default full-screen capture","    return new Promise<string | null>((resolve) => {","      chrome.runtime.sendMessage({ action: \"CAPTURE_FRAME\" }, (resp) => {","        if (chrome.runtime.lastError) {","          console.warn(\"CAPTURE_FRAME runtime error:\", chrome.runtime.lastError);","          resolve(null);","        } else {","          resolve(resp?.screenshot || null);","        }","      });","    });","  }, []);","","  const getReplayActions = useCallback(async () => {","    return new Promise<any[]>((resolve) => {","      chrome.runtime.sendMessage({ action: \"GET_REPLAY_LOGS\" }, (resp) => {","        if (chrome.runtime.lastError) resolve([]);","        else resolve(resp?.actions || []);","      });","    });","  }, []);","","  const callAIForBug = useCallback(async (","    source: {","      console?: ConsoleErrorItem;","      selectionText?: string;","      srcUrl?: string;","      linkUrl?: string;","      extraDetails?: string | null; // âœ… new field","    },","    screenshot: string | null,","    replayActions: any[]","  ) => {","    try {","      setMessage(\"ðŸ¤– Sending data to BugSense AI backend...\");","      const response = await fetch(\"http://localhost:3000/ai/analyze\", {","        method: \"POST\",","        headers: { \"Content-Type\": \"application/json\" },","        body: JSON.stringify({","          ...source,","          screenshot,","          replayActions,","          extraDetails: source.extraDetails || null,","        }),","      });","","      if (!response.ok) {","        const text = await response.text();","        throw new Error(`AI backend error: ${text}`);","      }","","      const ai = await response.json();","      console.log(\"[BugSense AI] Response from backend:\", ai);","      return ai;","    } catch (err) {","      console.error(\"AI backend call failed:\", err);","      const message =","        source.console?.message ||","        source.selectionText ||","        source.srcUrl ||","        source.linkUrl ||","        \"Bug captured (AI unavailable)\";","      return {","        title: `Bug Report: ${String(message).slice(0, 120)}`,","        description: source.console?.stack || message || \"Bug captured manually\",","        steps: [","          \"1. Observe the error or selected text\",","          \"2. Reproduce steps from replay buffer\",","        ],","      };","    }","  }, []);","","","  const createBugFromError = useCallback(async (item: ConsoleErrorItem) => {","    setLoading(true);","    setMessage(\"Capturing screenshot...\");","    try {","      const screenshot = await captureScreenshot();","      setMessage(\"Fetching recent replay actions...\");","      const replayActions = await getReplayActions();","      // ðŸ§  Ask user for optional details","      const extraDetails = await promptForExtraDetails();","      setMessage(\"ðŸ¤– Analyzing with BugSense AI... This may take a few seconds â³\");","","      const ai = await callAIForBug(","        { console: item, extraDetails },","        screenshot,","        replayActions","      );","","      const bug: BugClipboard = {","        title: ai.title,","        description: ai.description,","        steps: ai.steps || [],","        screenshotDataUrl: screenshot,","        createdAt: getFormattedDate(),","        source: { type: \"console\", raw: item },","        replayActions,","      };","","      await new Promise((res) => chrome.storage.local.set({ bugClipboard: bug }, () => res(true)));","      setMessage(\"Bug created and saved to BugSense clipboard âœ…\");","      setLoading(false);","      return bug;","    } catch (err) {","      console.error(err);","      setMessage(\"Failed to create bug: \" + String(err));","      setLoading(false);","    }","  }, [captureScreenshot, getReplayActions, callAIForBug]);","","  const createBugFromContext = useCallback(async (context: { selectionText?: string, srcUrl?: string, linkUrl?: string }) => {","    setLoading(true);","    setMessage(\"Capturing screenshot for UI bug...\");","    try {","      const screenshot = await captureScreenshot();","      setMessage(\"Fetching recent replay actions...\");","      const replayActions = await getReplayActions();","      // ðŸ§  Ask user for optional details","      const extraDetails = await promptForExtraDetails();","      setMessage(\"ðŸ¤– Analyzing UI bug with BugSense AI... â³\");","","      const ai = await callAIForBug({ ...context, extraDetails }, screenshot, replayActions);","","","      let rawSource = context.selectionText","        ? { type: \"selection\" as const, raw: { text: context.selectionText } }","        : context.srcUrl","          ? { type: \"image\" as const, raw: { srcUrl: context.srcUrl } }","          : context.linkUrl","            ? { type: \"link\" as const, raw: { linkUrl: context.linkUrl } }","            : { type: \"selection\" as const, raw: { text: \"Unknown context\" } };","","      const bug: BugClipboard = {","        title: ai.title,","        description: ai.description,","        steps: ai.steps || [],","        screenshotDataUrl: screenshot,","        createdAt: getFormattedDate(),","        source: rawSource,","        replayActions,","      };","","      await new Promise((res) => chrome.storage.local.set({ bugClipboard: bug }, () => res(true)));","      setMessage(\"Bug created and saved to BugSense clipboard âœ…\");","      setLoading(false);","      return bug;","    } catch (err) {","      console.error(err);","      setMessage(\"Failed to create bug: \" + String(err));","      setLoading(false);","    }","  }, [captureScreenshot, getReplayActions, callAIForBug]);","","  useEffect(() => {","    const messageListener = (msg: any) => {","      // For existing context menu trigger","      if (","        msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" &&","        (msg.selectionText || msg.srcUrl || msg.linkUrl)","      ) {","        createBugFromContext({","          selectionText: msg.selectionText,","          srcUrl: msg.srcUrl,","          linkUrl: msg.linkUrl,","        });","      }","","      // ðŸ§© NEW: Handle selective screenshot trigger","      if (msg.action === \"TRIGGER_BUG_CREATION_FROM_CONTEXT\" && msg.mode === \"selective\" && msg.screenshot) {","        (async () => {","          setMessage(\"Capturing selected area...\");","          const replayActions = await getReplayActions();","          const extraDetails = await promptForExtraDetails();","","          setMessage(\"Analyzing selective screenshot with BugSense AI...\");","","          const ai = await callAIForBug({ extraDetails }, msg.screenshot, replayActions);","","          const bug: BugClipboard = {","            title: ai.title,","            description: ai.description,","            steps: ai.steps || [],","            screenshotDataUrl: msg.screenshot,","            createdAt: getFormattedDate(),","            source: { type: \"selection\", raw: {} },","            replayActions,","          };","","          await new Promise((res) =>","            chrome.storage.local.set({ bugClipboard: bug }, () => res(true))","          );","","          setMessage(\"Selective area bug captured âœ…\");","          setSuccessBanner(true);","          setTimeout(() => setSuccessBanner(false), 3000);","        })();","      }","    };","","    chrome.runtime.onMessage.addListener(messageListener);","    return () => chrome.runtime.onMessage.removeListener(messageListener);","  }, [createBugFromContext, getReplayActions, callAIForBug]);","","","  async function insertIntoSheet(bug: BugClipboard) {","    try {","      const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });","      let spreadsheetId: string | null = null;","      if (tab?.url) {","        const m = String(tab.url).match(/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);","        spreadsheetId = m ? m[1] : null;","      }","      if (!spreadsheetId) {","        const input = prompt(\"Enter target Google Spreadsheet ID (or click Cancel to abort)\");","        if (!input) return;","        spreadsheetId = input;","      }","","      const range = \"bug_report!A1:Z1\";","      const row = [","        bug.title,","        bug.description,","        (bug.steps || []).join(\"\\n\"),","        bug.screenshotDataUrl ? \"screenshot_attached\" : \"\",","        new Date(bug.createdAt).toISOString(),","        \"Bug Sense\",","      ];","","      setMessage(\"Appending row to spreadsheet...\");","      chrome.runtime.sendMessage({ action: \"APPEND_SHEET_ROW\", sheetId: spreadsheetId, range, row }, (resp) => {","        if (chrome.runtime.lastError) {","          setMessage(\"Append failed: \" + chrome.runtime.lastError.message);","          return;","        }","        if (resp?.success) setMessage(\"Row appended âœ…\");","        else setMessage(\"Append failed: \" + JSON.stringify(resp?.error || \"unknown\"));","      });","    } catch (err) {","      console.error(err);","      setMessage(\"Insert error: \" + String(err));","    }","  }","","  const handlePreviewClick = () => {","    if (isPreviewVisible) {","      setIsPreviewVisible(false);","    } else {","      chrome.storage.local.get([\"bugClipboard\"], (res) => {","        setClipboardData(res?.bugClipboard || null);","        setIsPreviewVisible(true);","      });","    }","  };","","  const handleCopyToClipboard = () => {","    if (clipboardData) {","      const dataToCopy = { ...clipboardData };","      if (dataToCopy.screenshotDataUrl) {","        delete dataToCopy.screenshotDataUrl;","      }","      const jsonString = JSON.stringify(dataToCopy, null, 2);","      try {","        const tempTextArea = document.createElement(\"textarea\");","        tempTextArea.value = jsonString;","        tempTextArea.style.position = \"absolute\";","        tempTextArea.style.left = \"-9999px\";","        document.body.appendChild(tempTextArea);","        tempTextArea.select();","        document.execCommand(\"copy\");","        // Clean up","        document.body.removeChild(tempTextArea);","        setMessage(\"Clipboard JSON copied! âœ…\");","      } catch (err) {","        console.error(\"Failed to copy text: \", err);","        setMessage(\"Failed to copy to clipboard.\");","      }","    }","  };","","  // âœ… --- THIS IS THE CORRECTED STYLE ---","  return (","    <div style={{","      padding: 12,","      width: '100%', // Takes full width of its parent","      // maxWidth: 420, // <-- REMOVED THIS","      // margin: '0 auto', // <-- REMOVED THIS","      fontFamily: \"Inter, Roboto, sans-serif\",","      background: \"#0B1220\",","      color: \"#e0e0e0\",","      minHeight: \"100vh\",","      boxSizing: 'border-box' // Keep padding from breaking layout","    }}>","      {/* ... (rest of the component is unchanged) ... */}","      <div className=\"text-lg font-semibold text-gray-400 mb-2 flex items-center\" >","        <img","          src=\"../icons/icon48.png\"","          alt=\"Bug Sense icon\"","          style={{","            marginRight: 8,","            width: 20,","            height: 20","          }}","        />","        <div>Bug Sense â€” Console captures</div>","      </div>","","      <div style={{ marginBottom: 8, color: \"#a0a0a0\", fontSize: 12 }}>","        Select a console message to create an AI-generated bug report. Uses instant screenshot + replay buffer.","      </div>","","      {successBanner && (","        <div","          style={{","            background: \"#1a911a\",","            color: \"#ffffff\",","            padding: \"6px 10px\",","            borderRadius: 6,","            fontSize: 13,","            marginBottom: 10,","          }}","        >","          âœ… Bug captured successfully!","        </div>","      )}","","      <div style={{","        maxHeight: 320,","        overflow: \"auto\",","        border: \"1px solid #444\",","        padding: 8,","        borderRadius: 6,","        background: \"#252525\"","      }}>","        {errors.length === 0 && <div style={{ color: \"#888\" }}>No captured console messages (open site & reproduce)</div>}","        {errors.map((e, idx) => (","          <div key={e.ts + \"-\" + idx} style={{","            marginBottom: 8,","            padding: 8,","            borderRadius: 6,","            background: \"#3c3c3c\",","            boxShadow: \"0 0 0 1px #444 inset\"","          }}>","            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>","              <div style={{ fontSize: 13, fontWeight: 600, color: \"#f0f0f0\" }}>{String(e.message).slice(0, 120)}</div>","              <div style={{ fontSize: 11, color: \"#b0b0b0\" }}>{new Date(e.ts).toLocaleTimeString()}</div>","            </div>","            <div style={{ marginTop: 6, fontSize: 12, color: \"#cccccc\", whiteSpace: \"pre-wrap\" }}>{e.stack || (e.raw ? JSON.stringify(e.raw) : \"\")}</div>","","            <div style={{ marginTop: 8 }}>","              <button","                onClick={async () => {","                  setMessage(\"Creating bug...\");","                  const bug = await createBugFromError(e as ConsoleErrorItem);","                  if (bug) {","                    const ok = confirm(\"Bug created and saved to clipboard. Insert into sheet now?\");","                    if (ok) insertIntoSheet(bug);","                  }","                }}","                disabled={loading}","                style={{","                  marginRight: 8,","                  background: \"#3a7dff\",","                  color: \"white\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  border: \"none\",","                  cursor: \"pointer\"","                }}","              >","                Create bug from this error","              </button>","            </div>","          </div>","        ))}","      </div>","","      <div style={{ marginTop: 12 }}>","        <button","          onClick={handlePreviewClick}","          style={{","            background: \"#555\",","            color: \"#f0f0f0\",","            padding: \"6px 10px\",","            borderRadius: 6,","            border: \"1px solid #666\",","            cursor: \"pointer\"","          }}","        >","          {isPreviewVisible ? \"Hide clipboard\" : \"Preview clipboard\"}","        </button>","      </div>","","      <div style={{ marginTop: 10 }}>","        <div style={{ fontSize: 12, color: \"#a0a0a0\" }}>{message}</div>","      </div>","","      {isPreviewVisible && (","        <div style={{","          marginTop: 20,","          background: \"#252525\",","          border: \"1px solid #444\",","          borderRadius: 4,","          maxHeight: 400,","          overflow: \"auto\"","        }}>","          <h4 className=\"sticky top-0\" style={{","            margin: 0,","            padding: \"8px 12px\",","            borderBottom: \"1px solid #444\",","            background: \"#333\",","            fontSize: 13,","            fontWeight: 600,","            color: \"#f0f0f0\",","            display: \"flex\",","            alignItems: \"center\",","            justifyContent: \"space-between\"","          }}>","            Clipboard Contents","            <FaRegCopy","              onClick={handleCopyToClipboard}","              style={{ cursor: \"pointer\", fontSize: 14, color: \"#f0f0f0\" }}","              title=\"Copy JSON (raw)\"","            />","          </h4>","","          {clipboardData?.screenshotDataUrl && (","            <div style={{ padding: 12, borderBottom: '1px solid #444', background: '#333' }}>","              <img","                src={clipboardData.screenshotDataUrl}","                alt=\"Bug Screenshot\"","                style={{ width: '100%', borderRadius: 4, border: '1px solid #555' }}","                title=\"Right-click to copy or save this image\"","              />","            </div>","          )}","","          <SyntaxHighlighter","            language=\"json\"","            style={atomDark}","            customStyle={{","              margin: 0,","              padding: \"12px\",","              fontSize: \"11px\",","              whiteSpace: \"pre-wrap\",","              wordBreak: \"break-all\",","              background: \"#2d2d2d\"","            }}","          >","            {(() => {","              if (!clipboardData) return \"No clipboard data found.\";","              const displayData = { ...clipboardData };","              if (displayData.screenshotDataUrl) {","                delete displayData.screenshotDataUrl;","              }","              return JSON.stringify(displayData, null, 2);","            })()}","          </SyntaxHighlighter>","        </div>","      )}","","      {showExtraModal && (","        <div","          style={{","            position: \"fixed\",","            inset: 0,","            background: \"rgba(0,0,0,0.7)\",","            display: \"flex\",","            alignItems: \"center\",","            justifyContent: \"center\",","            zIndex: 9999,","          }}","        >","          <div","            style={{","              background: \"#0B1220\",","              color: \"white\",","              padding: 20,","              borderRadius: 8,","              width: \"90%\",","              maxWidth: 400,","              boxShadow: \"0 0 10px rgba(0,0,0,0.5)\",","            }}","          >","            <h3 style={{ marginTop: 0 }}>ðŸ“ Add Extra Details (optional)</h3>","            <textarea","              value={extraText}","              onChange={(e) => setExtraText(e.target.value)}","              placeholder=\"Describe more about the issue, environment, or special conditions (optional)...\"","              style={{","                width: \"100%\",","                height: 120,","                padding: 8,","                borderRadius: 6,","                border: \"1px solid #333\",","                background: \"#1b1f2b\",","                color: \"#eee\",","                resize: \"none\",","                fontSize: 13,","                fontFamily: \"Inter, sans-serif\",","              }}","            />","            <div style={{ display: \"flex\", justifyContent: \"flex-end\", gap: 8, marginTop: 10 }}>","              <button","                style={{","                  background: \"#555\",","                  color: \"#fff\",","                  border: \"none\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  cursor: \"pointer\",","                }}","                onClick={() => {","                  setShowExtraModal(false);","                  if (onExtraConfirm) onExtraConfirm(null);","                }}","              >","                Skip","              </button>","              <button","                style={{","                  background: \"#3a7dff\",","                  color: \"white\",","                  border: \"none\",","                  padding: \"6px 10px\",","                  borderRadius: 6,","                  cursor: \"pointer\",","                }}","                onClick={() => {","                  setShowExtraModal(false);","                  if (onExtraConfirm) onExtraConfirm(extraText.trim() || null);","                }}","              >","                Send","              </button>","            </div>","          </div>","        </div>","      )}","","    </div>","  );","}"]}],[103,{"id":103,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/main.tsx","size":418,"mtime":1762257355590.9172,"lines":["import React from \"react\";","import ReactDOM from \"react-dom/client\";","import DevPanel from \"./DevPanel\";","","// import { initAI } from \"../ai/analyze\";","","// initAI().then(() => console.log(\"[BugSense AI] model ready âœ…\"));","","","ReactDOM.createRoot(document.getElementById(\"root\") as HTMLElement).render(","  <React.StrictMode>","    <DevPanel />","  </React.StrictMode>",");","","console.log(\"[BugSense] DevTools React app mounted âœ…\");",""]}],[104,{"id":104,"path":"/home/milan/Desktop/bug-sense/frontend/extension/devtools/register.ts","size":261,"mtime":1762232260287.808,"lines":["// extension/devtools/register.ts","","chrome.devtools.panels.create(","  \"Bug Sense\", // tab title in DevTools","  \"extension/icons/icon48.png\", // <--- FIX 1: Make this path root-relative","  \"extension/devtools/index.html\" // <--- FIX 2: This is the critical change",");"]}],[105,{"id":105,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/App.tsx","size":1923,"mtime":1762414252687.914,"lines":["import React, { useState } from \"react\";","import ScreenshotTool from \"./components/ScreenshotTool\";","import RecorderTool from \"./components/RecorderTool\";","import MarkerTool from \"./components/MarkerTool\";","import GifMaker from \"./components/GifMaker\";","import InstantReplay from \"./components/InstantReplay\";","","export default function App() {","  const [activeTool, setActiveTool] = useState<\"home\" | \"marker\">(\"home\");","  const [annotateImage, setAnnotateImage] = useState<string | null>(null);","","  const handleAnnotate = (image: string) => {","    setAnnotateImage(image);","    setActiveTool(\"marker\");","  };","","  // Header used for both main and marker views to keep consistent spacing","  const Header = () => (","    <div className=\"flex items-center justify-between\">","      <div>","        <div className=\"text-lg font-semibold text-gray-400 mb-3 flex items-center\" >","          <img","            src=\"../icons/icon48.png\"","            alt=\"Bug Sense icon\"","            style={{","              marginRight: 8,","              width: 20,","              height: 20","            }}","          />","          <div>Bug Sense</div>","        </div>","        {/* <div className=\"text-xs text-gray-400\">v1.0.0</div> */}","      </div>","      <div />","    </div>","  );","","  if (activeTool === \"marker\" && annotateImage) {","    return (","      <div className=\"w-[320px] p-3 bg-white rounded-lg shadow-lg\">","        <Header />","        <div className=\"mt-3\">","          <MarkerTool","            image={annotateImage}","            onClose={() => {","              setAnnotateImage(null);","              setActiveTool(\"home\");","            }}","          />","        </div>","      </div>","    );","  }","","  return (","    <div className=\"w-[320px] p-3 shadow-lg bg-[#0B1220]\">","      <Header />","","      <div className=\"mt-3 space-y-3\">","        <ScreenshotTool onAnnotate={handleAnnotate} />","","        <RecorderTool />","","        <GifMaker />","","        <InstantReplay />","      </div>","    </div>","  );","}",""]}],[106,{"id":106,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/GifMaker.tsx","size":1692,"mtime":1762342303405.2344,"lines":["import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","","export default function GifMaker() {","  const [gifUrl, setGifUrl] = useState<string | null>(null);","  const [processing, setProcessing] = useState(false);","","  useEffect(() => {","    chrome.storage.local.get(\"generatedGifFromUploader\", (data) => {","      if (data.generatedGifFromUploader) setGifUrl(data.generatedGifFromUploader);","    });","","    const listener = (changes: Record<string, chrome.storage.StorageChange>) => {","      if (changes.generatedGifFromUploader) {","        setGifUrl(changes.generatedGifFromUploader.newValue);","        setProcessing(false);","      }","    };","    chrome.storage.onChanged.addListener(listener);","    return () => chrome.storage.onChanged.removeListener(listener);","  }, []);","","  const openUploader = () => {","    setProcessing(true);","    chrome.runtime.sendMessage({ action: \"OPEN_GIF_UPLOADER\" }, (resp) => {","      // uploader window opened","    });","  };","","  const downloadGif = () => {","    if (!gifUrl) return;","    const a = document.createElement(\"a\");","    a.href = gifUrl;","    a.download = `bug-sense-gif-${Date.now()}.gif`;","    a.click();","  };","","  return (","    <div className=\"space-y-3\">","      <DisplayButton name={processing ? \"Processing...\" : \"ðŸ” Select & Convert Recording\"} onClick={() => openUploader()} color=\"dark\" disable={processing} />","","      {gifUrl && (","        <div>","          <img src={gifUrl} alt=\"GIF\" className=\"w-full rounded mt-2\" />","          <button onClick={downloadGif} className=\"mt-2 w-full bg-green-500 text-white py-2 rounded\">","            â¬‡ï¸ Download GIF","          </button>","        </div>","      )}","    </div>","  );","}","",""]}],[107,{"id":107,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/Header.tsx","size":680,"mtime":1761807200466.7773,"lines":["// extension/popup/components/Header.tsx","","export default function Header() {","  const runDuplicateScan = () => {","    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {","      const tab = tabs[0];","      if (tab.id) {","        chrome.tabs.sendMessage(tab.id, { action: \"RUN_DUPLICATE_SCAN\" });","      }","    });","  };","","  return (","    <div className=\"flex items-center justify-between\">","      <h1 className=\"text-lg font-semibold text-gray-800\">Bug Sense</h1>","      <button","        onClick={runDuplicateScan}","        className=\"bg-indigo-600 text-white px-2 py-1 text-xs rounded hover:bg-indigo-700\"","      >","        ðŸ” Scan Duplicates","      </button>","    </div>","  );","}",""]}],[108,{"id":108,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/InstantReplay.tsx","size":11696,"mtime":1762405689056.5645,"lines":["import React, { useEffect, useRef, useState } from \"react\";","import { FaChevronLeft, FaChevronRight, FaDownload, FaPause, FaPlay } from \"react-icons/fa\";","import DisplayButton from \"../../components/DisplayButton\";","import { LuStepBack, LuStepForward } from \"react-icons/lu\";","import { FaBackwardStep, FaForwardStep } from \"react-icons/fa6\";","","/**"," * extension/popup/components/InstantReplay.tsx"," *"," * Adds \"Session Replay Download\" feature: combines screenshots stored in"," * chrome.storage.local.recentScreenshots into a WebM video (client-side)"," * using a Canvas + MediaRecorder."," *"," * - Preserves frame timing when timestamps exist (clamped to sane ranges)."," * - Shows build progress and allows direct download when ready."," * - Provides a preview player after building."," */","","type ScreenshotItem = { screenshot: string; timestamp: number };","","type ActionEvent = { type: string; timestamp: number; details: any };","","const DEFAULT_FRAME_INTERVAL_MS = 800; // used if timestamps not available or identical","const MIN_FRAME_MS = 40; // ~25fps max","const MAX_FRAME_MS = 5000; // cap extremely large gaps","","export default function InstantReplay(): JSX.Element {","    const [screenshots, setScreenshots] = useState<ScreenshotItem[]>([]);","    const [actions, setActions] = useState<ActionEvent[]>([]);","    const [playing, setPlaying] = useState(false);","    const [index, setIndex] = useState(0);","","    // export-related state","    const [isBuilding, setIsBuilding] = useState(false);","    const [buildProgress, setBuildProgress] = useState(0);","    const [videoUrl, setVideoUrl] = useState<string | null>(null);","    const [error, setError] = useState<string | null>(null);","    const [showReplay, setShowReplay] = useState(false);","    const intervalRef = useRef<number | null>(null);","","    useEffect(() => {","        chrome.storage.local.get([\"recentScreenshots\", \"recentActions\"], (res) => {","            if (chrome.runtime.lastError) {","                console.warn(\"InstantReplay storage.get error:\", chrome.runtime.lastError);","            }","            const ss: ScreenshotItem[] = Array.isArray(res?.recentScreenshots) ? res.recentScreenshots : [];","            const ac: ActionEvent[] = Array.isArray(res?.recentActions) ? res.recentActions : [];","            // Normalize timestamps & sort","            const normalized = ss","                .map((s) => ({ screenshot: s.screenshot, timestamp: Number(s.timestamp) || Date.now() }))","                .sort((a, b) => a.timestamp - b.timestamp);","            setScreenshots(normalized);","            setActions(ac);","            setIndex(0);","        });","","        const onChange = (changes: Record<string, chrome.storage.StorageChange>) => {","            if (changes.recentScreenshots) {","                const newVal = changes.recentScreenshots.newValue || [];","                const normalized = Array.isArray(newVal)","                    ? newVal.map((s: any) => ({ screenshot: s.screenshot, timestamp: Number(s.timestamp) || Date.now() })).sort((a: ScreenshotItem, b: ScreenshotItem) => a.timestamp - b.timestamp)","                    : [];","                setScreenshots(normalized);","                setIndex(0);","            }","            if (changes.recentActions) setActions(changes.recentActions.newValue || []);","        };","","        chrome.storage.onChanged.addListener(onChange);","        return () => chrome.storage.onChanged.removeListener(onChange);","    }, []);","","    useEffect(() => {","        if (playing && screenshots.length > 0) startPlayback();","        else stopPlayback();","        // eslint-disable-next-line react-hooks/exhaustive-deps","    }, [playing, index, screenshots]);","","    // Cleanup video blob URL to prevent memory leaks","    useEffect(() => {","        return () => {","            if (videoUrl) {","                URL.revokeObjectURL(videoUrl);","            }","        };","    }, [videoUrl]);","","    function startPlayback() {","        stopPlayback();","        const id = window.setInterval(() => {","            setIndex((prev) => {","                const next = prev + 1;","                return next >= screenshots.length ? 0 : next;","            });","        }, 800);","        intervalRef.current = id as unknown as number;","    }","","    function stopPlayback() {","        if (intervalRef.current !== null) {","            window.clearInterval(intervalRef.current);","            intervalRef.current = null;","        }","    }","","    function togglePlay() {","        setPlaying((p) => !p);","    }","","    function prevFrame() {","        setIndex((i) => (i - 1 + screenshots.length) % Math.max(1, screenshots.length));","    }","","    function nextFrame() {","        setIndex((i) => (i + 1) % Math.max(1, screenshots.length));","    }","","    // ---------- VIDEO BUILDING ----------","","    async function buildVideoAndDownload() {","        setError(null);","","        if (!screenshots || screenshots.length === 0) {","            setError(\"No screenshots available for export.\");","            return;","        }","","        try {","            // save current screenshots in storage (so background can access)","            await chrome.storage.local.set({ replayExportQueue: screenshots });","","            // open export page via background (keeps popup lightweight)","            chrome.runtime.sendMessage({ action: \"OPEN_REPLAY_EXPORT_PAGE\" });","","            setIsBuilding(true);","            setBuildProgress(0);","","            // show a short message","            setTimeout(() => {","                setIsBuilding(false);","                alert(\"Replay export started in a separate tab â€” you can close this popup safely.\");","            }, 1000);","        } catch (err) {","            console.error(\"Failed to start replay export:\", err);","            setError(String(err));","        }","    }","","","","","    return (","        <div className=\"space-y-3\">","            <DisplayButton name=\"ðŸ” Instant Visual Replay\" onClick={() => setShowReplay(prev => !prev)} color=\"dark\" title=\"Toggle replay preview\" />","","            {showReplay && <>","                <div className=\"text-sm font-medium text-gray-400 text-center\">Instant Visual Replay</div>","","                {screenshots && screenshots.length > 0 ? (","                    <div className=\"space-y-2\">","                        <div className=\"bg-black rounded overflow-hidden\">","                            <img src={screenshots[index].screenshot} alt=\"replay frame\" className=\"w-full object-contain max-h-48\" />","                        </div>","","                        <div className=\"flex items-center justify-between gap-3 py-1\">","                            {/* Left controls: prev / play-pause / next */}","                            <div className=\"flex items-center gap-2\">","                                <button","                                    onClick={prevFrame}","                                    className=\"flex items-center justify-center w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full transition\"","                                    title=\"Previous Frame\"","                                >","                                    <FaBackwardStep size={16} className=\"text-gray-500\" />","                                </button>","","                                <button","                                    onClick={togglePlay}","                                    className=\"flex items-center justify-center w-8 h-8 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full shadow-sm transition\"","                                    title={playing ? \"Pause\" : \"Play\"}","                                >","                                    {playing ? <FaPause size={12} /> : <FaPlay size={15} />}","                                </button>","","                                <button","                                    onClick={nextFrame}","                                    className=\"flex items-center justify-center w-8 h-8 bg-gray-200 hover:bg-gray-300 rounded-full transition\"","                                    title=\"Next Frame\"","                                >","                                    <FaForwardStep size={16} className=\"text-gray-500\" />","                                </button>","                            </div>","","                            {/* Right controls: download + index/timestamp */}","                            <div className=\"flex items-center gap-3\">","                                <button","                                    title=\"Download Replay as Video\"","                                    onClick={buildVideoAndDownload}","                                    disabled={isBuilding}","                                    className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition ${isBuilding","                                        ? \"bg-indigo-400 cursor-wait\"","                                        : \"bg-indigo-600 hover:bg-indigo-700\"","                                        }`}","                                >","                                    {isBuilding ? (","                                        <span className=\"text-xs\">{`Building... ${buildProgress}%`}</span>","                                    ) : (","                                        <>","                                            <FaDownload size={14} />","                                            <span className=\"text-xs font-semibold\">Export</span>","                                        </>","                                    )}","                                </button>","","                                <div className=\"text-xs text-gray-400 text-right\">","                                    {index + 1}/{screenshots.length} â€¢ <br />","                                    {new Date(screenshots[index].timestamp).toLocaleTimeString()}","                                </div>","                            </div>","                        </div>","","","                        {/* progress bar */}","                        {isBuilding && (","                            <div className=\"w-full bg-gray-200 h-2 rounded overflow-hidden mt-2\">","                                <div className=\"bg-blue-500 h-2\" style={{ width: `${buildProgress}%`, transition: \"width 0.2s\" }} />","                            </div>","                        )}","","                        {error && <div className=\"text-xs text-red-600\">{error}</div>}","","                        {videoUrl && (","                            <div className=\"mt-2\">","                                <video src={videoUrl} controls className=\"w-full rounded shadow-md\" />","                            </div>","                        )}","                    </div>","                ) : (","                    <div className=\"text-sm text-gray-600\">No recent screenshots available. Showing textual actions instead.</div>","                )}","","                {/* textual fallback */}","                {screenshots.length === 0 && actions && actions.length > 0 && (","                    <div className=\"text-left text-sm max-h-48 overflow-auto\">","                        {actions.slice().reverse().slice(0, 30).map((a, idx) => (","                            <div key={idx} className=\"py-1 border-b border-gray-100\">","                                <div className=\"text-xs text-gray-400\">{new Date(a.timestamp).toLocaleTimeString()}</div>","                                <div className=\"text-sm\">","                                    <strong>{String(a.type).toUpperCase()}</strong> â€” <span className=\"text-gray-400\">{JSON.stringify(a.details)}</span>","                                </div>","                            </div>","                        ))}","                    </div>","                )}","","                <div className=\"text-xs text-gray-400 text-center\">Shows visual replay (latest ~30-60s snapshots). Export to WebM video.</div>","            </>}","        </div>","    );","}",""]}],[109,{"id":109,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/MarkerTool.tsx","size":7766,"mtime":1762332041336.1484,"lines":["import React, { useRef, useState, useEffect } from \"react\";","import { IoIosSave } from \"react-icons/io\";","import { IoClose } from \"react-icons/io5\";","","interface MarkerToolProps {","  image?: string;","  onClose?: () => void;","}","","export default function MarkerTool({ image, onClose }: MarkerToolProps) {","  const canvasRef = useRef<HTMLCanvasElement | null>(null);","  const [tool, setTool] = useState<\"pen\" | \"rect\" | \"arrow\" | \"text\">(\"pen\");","  const [color, setColor] = useState(\"#ff0000\");","  const [isDrawing, setIsDrawing] = useState(false);","  const [startPos, setStartPos] = useState<{ x: number; y: number } | null>(null);","  const [textInput, setTextInput] = useState(\"\");","  const [textPos, setTextPos] = useState<{ x: number; y: number } | null>(null);","  const backgroundRef = useRef<HTMLImageElement | null>(null);","","  useEffect(() => {","    if (!image || !canvasRef.current) return;","    const canvas = canvasRef.current;","    const ctx = canvas.getContext(\"2d\")!;","    const img = new Image();","    img.src = image;","    img.onload = () => {","      // âœ… FIX: Set canvas to the exact 1:1 pixel size of the image.","      // This stops any blurry scaling.","      canvas.width = img.naturalWidth;","      canvas.height = img.naturalHeight;","","      // Draw image 1:1","      ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);","","      // Keep visible size responsive in popup (this is correct)","      canvas.style.width = \"100%\";","      canvas.style.height = \"auto\";","","      backgroundRef.current = img;","    };","  }, [image]);","","  // map client coords -> canvas pixel coords","  const toCanvasCoords = (e: React.MouseEvent<HTMLCanvasElement>) => {","    const canvas = canvasRef.current!;","    const rect = canvas.getBoundingClientRect();","    const scaleX = canvas.width / rect.width;","    const scaleY = canvas.height / rect.height;","    return {","      x: (e.clientX - rect.left) * scaleX,","      y: (e.clientY - rect.top) * scaleY,","    };","  };","","  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {","    if (tool === \"text\") {","      const pos = toCanvasCoords(e);","      setTextPos(pos);","      return;","    }","","    const pos = toCanvasCoords(e);","    setIsDrawing(true);","    setStartPos(pos);","","    // snapshot current canvas state once (for shape overlays)","    if (canvasRef.current) {","      const snap = new Image();","      snap.src = canvasRef.current.toDataURL();","      backgroundRef.current = snap;","    }","","    // init pen drawing path","    if (tool === \"pen\" && canvasRef.current) {","      const ctx = canvasRef.current.getContext(\"2d\")!;","      ctx.strokeStyle = color;","      ctx.lineWidth = 4;","      ctx.lineCap = \"round\";","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","    }","  };","","  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {","    if (!isDrawing || !startPos || !canvasRef.current) return;","    const ctx = canvasRef.current.getContext(\"2d\")!;","    const pos = toCanvasCoords(e);","","    // pen: continuous without re-draw from snapshot (smooth)","    if (tool === \"pen\") {","      ctx.strokeStyle = color;","      ctx.lineWidth = 4;","      ctx.lineCap = \"round\";","      ctx.lineTo(pos.x, pos.y);","      ctx.stroke();","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","      return;","    }","","    // other tools: redraw snapshot then draw shape overlay","    const bg = backgroundRef.current;","    if (bg) {","      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);","      ctx.drawImage(bg, 0, 0);","    }","","    ctx.strokeStyle = color;","    ctx.lineWidth = 4;","    ctx.lineCap = \"round\";","","    if (tool === \"rect\") {","      ctx.strokeRect(startPos.x, startPos.y, pos.x - startPos.x, pos.y - startPos.y);","    } else if (tool === \"arrow\") {","      ctx.beginPath();","      ctx.moveTo(startPos.x, startPos.y);","      ctx.lineTo(pos.x, pos.y);","      ctx.stroke();","      // arrow head","      const angle = Math.atan2(pos.y - startPos.y, pos.x - startPos.x);","      const headlen = Math.max(8, canvasRef.current.width / 120);","      ctx.beginPath();","      ctx.moveTo(pos.x, pos.y);","      ctx.lineTo(pos.x - headlen * Math.cos(angle - Math.PI / 6), pos.y - headlen * Math.sin(angle - Math.PI / 6));","      ctx.lineTo(pos.x - headlen * Math.cos(angle + Math.PI / 6), pos.y - headlen * Math.sin(angle + Math.PI / 6));","      ctx.closePath();","      ctx.fillStyle = color;","      ctx.fill();","    }","  };","","  const handleMouseUp = () => {","    setIsDrawing(false);","    setStartPos(null);","  };","","  const addText = () => {","    if (!canvasRef.current || !textPos || !textInput) return;","    const ctx = canvasRef.current.getContext(\"2d\")!;","    ctx.font = \"20px sans-serif\";","    ctx.fillStyle = color;","    ctx.fillText(textInput, textPos.x, textPos.y);","    setTextInput(\"\");","    setTextPos(null);","  };","","  const saveAnnotated = () => {","    if (!canvasRef.current) return;","","    const canvas = canvasRef.current;","    canvas.toBlob(","      (blob) => {","        if (!blob) {","          console.error(\"[BugSense] Failed to create annotated blob\");","          return;","        }","        const reader = new FileReader();","        reader.onloadend = () => {","          const dataUrl = reader.result as string;","          chrome.runtime.sendMessage(","            { action: \"SAVE_ANNOTATED_IMAGE_DATAURL\", dataUrl },","            (resp) => {","              if (resp?.success) {","                console.log(\"[BugSense] Annotated image saved successfully âœ…\");","              } else {","                console.error(\"[BugSense] MarkerTool background failed:\", resp?.error);","              }","            }","          );","        };","        reader.readAsDataURL(blob);","      },","      \"image/jpeg\",","      1.0 // maximum quality","    );","  };","","  return (","    <div className=\"w-full\">","      <div className=\"flex items-center justify-between gap-2\">","        <div className=\"flex items-center gap-2\">","          <select","            value={tool}","            onChange={(e) => setTool(e.target.value as any)}","            className=\"border rounded px-2 py-1 text-sm\"","          >","            <option value=\"pen\">Pen</option>","            <option value=\"rect\">Rectangle</option>","            <option value=\"arrow\">Arrow</option>","            <option value=\"text\">Text</option>","          </select>","","          <input","            type=\"color\"","            value={color}","            onChange={(e) => setColor(e.target.value)}","            className=\"w-10 h-8 p-0 border rounded\"","            aria-label=\"color\"","          />","        </div>","","        <div className=\"flex items-center gap-2\">","          <button title=\"Save\"","            onClick={saveAnnotated}","            className=\"bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-1 rounded text-sm\"","          >","            <IoIosSave />","          </button>","","          <button title=\"Close\"","            onClick={onClose}","            className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded text-sm\"","          >","            <IoClose />","          </button>","        </div>","      </div>","","      {tool === \"text\" && (","        <div className=\"mt-2 flex gap-2\">","          <input","            value={textInput}","            onChange={(e) => setTextInput(e.target.value)}","            placeholder=\"Enter text\"","            className=\"flex-1 border rounded px-2 py-1 text-sm\"","          />","          <button onClick={addText} className=\"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm\">","            Add","          </button>","        </div>","      )}","","      <div className=\"mt-3 border rounded overflow-hidden bg-black\">","        <canvas","          ref={canvasRef}","          onMouseDown={handleMouseDown}","          onMouseMove={handleMouseMove}","          onMouseUp={handleMouseUp}","          onMouseLeave={handleMouseUp}","          className=\"w-full block\"","          style={{ cursor: \"crosshair\", display: \"block\" }}","        />","      </div>","    </div>","  );","}",""]}],[110,{"id":110,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/RecorderTool.tsx","size":2651,"mtime":1762342319455.9485,"lines":["// RecorderTool.tsx","import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","","/**"," * RecorderTool â€” simplified popup controller."," * The recording runs fully inside a separate persistent window (recorder.html)."," * The popup only launches that window â€” no stop logic or preview here."," *"," * Change requested:"," *  - When recording is active, show \"Processing...\" on the Start button (green),"," *    instead of a long red status line. Disable the button while processing."," */","","export default function RecorderTool() {","  const [isRecording, setIsRecording] = useState(false);","","  useEffect(() => {","    // Load recording flag on mount","    chrome.storage.local.get([\"isRecording\"], (data) => {","      setIsRecording(Boolean(data?.isRecording));","    });","","    // Watch for recording state updates","    const handleChange = (changes: Record<string, chrome.storage.StorageChange>) => {","      if (changes.isRecording) {","        setIsRecording(Boolean(changes.isRecording.newValue));","      }","    };","","    chrome.storage.onChanged.addListener(handleChange);","    return () => chrome.storage.onChanged.removeListener(handleChange);","  }, []);","","  const startRecording = () => {","    // Ask background to start recording. Background may reply:","    //  - { success: true }         => background started recording","    //  - { requireRecorderWindow }  => popup should open recorder window (getDisplayMedia there)","    //  - { success: false, error }  => failure","    chrome.runtime.sendMessage({ action: \"START_RECORDING\" }, (resp) => {","      if (chrome.runtime.lastError) {","        console.error(\"Error starting recording:\", chrome.runtime.lastError);","        alert(\"Failed to start recording.\");","        return;","      }","","      if (resp?.requireRecorderWindow) {","        // Background asked us to open the separate recorder window (fallback flow)","        // Background handler should implement OPEN_RECORDER_WINDOW","        chrome.runtime.sendMessage({ action: \"OPEN_RECORDER_WINDOW\" });","        return;","      }","","      if (resp?.success) {","        // background-based recording started; set flag so main UI shows \"Processing...\"","        setIsRecording(true);","        try {","          chrome.storage.local.set({ isRecording: true });","        } catch { }","      } else {","        console.error(\"Could not start recording:\", resp);","        alert(\"Could not start recording. Please retry.\");","      }","    });","  };","","  return (","    <div className=\"space-y-3 \">","      <DisplayButton name={isRecording ? \"Processing...\" : \"ðŸŽ¥ Start Recording\"} onClick={() => startRecording()} color=\"dark\" disable={isRecording} />","    </div>","  );","}",""]}],[111,{"id":111,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/components/ScreenshotTool.tsx","size":3376,"mtime":1762414153708.365,"lines":["// extension/popup/components/ScreenshotTool.tsx","import React, { useEffect, useState } from \"react\";","import DisplayButton from \"../../components/DisplayButton\";","import { FaDownload, FaEdit } from \"react-icons/fa\";","import { MdEdit } from \"react-icons/md\";","","export default function ScreenshotTool({","  onAnnotate,","}: {","  onAnnotate?: (img: string) => void;","}) {","  const [imageUrl, setImageUrl] = useState<string | null>(null);","  const [capturing, setCapturing] = useState(false);","  const [fullKey, setFullKey] = useState<string | null>(null);","  const [filename, setFilename] = useState<string | null>(null);","","  useEffect(() => {","    return () => {","      if (imageUrl && imageUrl.startsWith(\"blob:\")) URL.revokeObjectURL(imageUrl);","    };","  }, [imageUrl]);","","  const captureScreenshot = () => {","    if (capturing) return;","    setCapturing(true);","","    chrome.runtime.sendMessage({ action: \"TAKE_SCREENSHOT\" }, (resp) => {","      if (chrome.runtime.lastError) {","        console.error(\"Screenshot message failed:\", chrome.runtime.lastError);","        setCapturing(false);","        return;","      }","","      if (resp?.success) {","        setImageUrl(resp.preview);","        setFullKey(resp.fullKey);","        setFilename(resp.filename || null);","        console.log(\"[BugSense] Screenshot preview ready âœ…\");","      } else {","        console.error(\"Screenshot failed:\", resp?.error);","      }","","      setCapturing(false);","    });","  };","","  const downloadScreenshot = () => {","    if (!fullKey) return;","    chrome.runtime.sendMessage(","      { action: \"DOWNLOAD_FULL_SCREENSHOT\", fullKey },","      (resp) => {","        if (chrome.runtime.lastError) {","          console.error(\"Download message failed:\", chrome.runtime.lastError);","          return;","        }","        if (!resp?.success) console.error(\"Download failed:\", resp?.error);","        else console.log(\"Download started:\", resp.downloadId);","      }","    );","  };","","  return (","    <div className=\"space-y-3\">","      <DisplayButton name={capturing ? \"Capturing...\" : \"ðŸ“¸ Take Screenshot\"} onClick={() => captureScreenshot()} color=\"dark\" disable={capturing} />","","      {imageUrl && (","        <div className=\"mt-3 text-center\">","          <img","            src={imageUrl}","            alt=\"Screenshot preview\"","            className=\"rounded shadow-md mb-2 max-h-40 mx-auto\"","          />","          <div className=\"flex justify-center space-x-2\">","","            <button","              onClick={downloadScreenshot}","              className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition bg-indigo-600 hover:bg-indigo-700","                `}","            >","              <>","                <FaDownload size={14} />","                <span className=\"text-xs font-semibold\">Download</span>","              </>","            </button>","","            <button","              onClick={() => onAnnotate?.(imageUrl)}","              className={`flex items-center justify-center gap-2 px-3 py-2 rounded-md font-medium text-white shadow-sm transition bg-yellow-500 hover:bg-yellow-600","                `}","            >","              <>","                <MdEdit size={14} />","                <span className=\"text-xs font-semibold\">Annotate</span>","              </>","            </button>","          </div>","          {filename && <div className=\"text-xs text-gray-500 mt-1\">{filename}</div>}","        </div>","      )}","    </div>","  );","}",""]}],[112,{"id":112,"path":"/home/milan/Desktop/bug-sense/frontend/extension/popup/main.tsx","size":248,"mtime":1761715013625.649,"lines":["import React from \"react\";","import ReactDOM from \"react-dom/client\";","import App from \"./App\";","import \"../styles/tailwind.css\";","","ReactDOM.createRoot(document.getElementById(\"root\")!).render(","  <React.StrictMode>","    <App />","  </React.StrictMode>",");","",""]}],[113,{"id":113,"path":"/home/milan/Desktop/bug-sense/frontend/extension/recorder/recorder.js","size":2839,"mtime":1762333706450.5066,"lines":["// extension/recorder.js","// Final version â€” no extra popup window, just inline preview in same recorder tab.","","let stream = null;","let mediaRecorder = null;","let chunks = [];","","const startBtn = document.getElementById(\"startBtn\");","const statusText = document.getElementById(\"status\");","const previewSection = document.getElementById(\"previewSection\");","const preview = document.getElementById(\"preview\");","","function setUI(isRecording) {","    if (isRecording) {","        startBtn.disabled = true;","        startBtn.classList.add(\"opacity-50\", \"cursor-not-allowed\");","        statusText.textContent = \"ðŸ”´ Recording in progress...\";","        previewSection.classList.add(\"hidden\");","    } else {","        startBtn.disabled = false;","        startBtn.classList.remove(\"opacity-50\", \"cursor-not-allowed\");","        statusText.textContent = \"ðŸŸ¢ Ready to record\";","    }","}","","async function startRecording() {","    try {","        stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });","        chunks = [];","","        try {","            mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm;codecs=vp9\" });","        } catch {","            mediaRecorder = new MediaRecorder(stream, { mimeType: \"video/webm\" });","        }","","        mediaRecorder.ondataavailable = (e) => {","            if (e.data && e.data.size > 0) chunks.push(e.data);","        };","","        mediaRecorder.onstop = async () => {","            try {","                const blob = new Blob(chunks, { type: \"video/webm\" });","                const url = URL.createObjectURL(blob);","                preview.src = url;","                preview.autoplay = true;","                previewSection.classList.remove(\"hidden\");","","                await chrome.storage.local.set({ recordedVideo: url, isRecording: false });","                setUI(false);","                stream?.getTracks().forEach((t) => t.stop());","","                // ðŸ§¹ Removed: No new preview window is created","            } catch (err) {","                console.error(\"Finalize error:\", err);","            } finally {","                mediaRecorder = null;","                stream = null;","                chunks = [];","            }","        };","","        mediaRecorder.start();","        await chrome.storage.local.set({ isRecording: true });","        setUI(true);","","        // Automatically stop when Chrome's native â€œStop sharingâ€ is clicked","        stream.getVideoTracks().forEach((t) =>","            t.addEventListener(\"ended\", () => {","                if (mediaRecorder?.state === \"recording\") {","                    mediaRecorder.stop();","                }","            })","        );","    } catch (err) {","        console.error(\"getDisplayMedia error:\", err);","        alert(\"Screen capture permission denied or failed.\");","        setUI(false);","    }","}","","startBtn.addEventListener(\"click\", startRecording);","setUI(false);",""]}],[114,{"id":114,"path":"/home/milan/Desktop/bug-sense/frontend/extension/replay-export/replay-export.js","size":2674,"mtime":1762364737115.7014,"lines":["async function main() {","    const prog = document.getElementById(\"prog\");","    const status = document.getElementById(\"status\");","","    const res = await chrome.storage.local.get(\"replayExportQueue\");","    const frames = res.replayExportQueue || [];","    if (!frames.length) {","        status.textContent = \"âŒ No frames found. Please capture again.\";","        return;","    }","","    status.textContent = `Preparing ${frames.length} frames...`;","","    // Determine target resolution","    const firstBlob = await (await fetch(frames[0].screenshot)).blob();","    const firstBitmap = await createImageBitmap(firstBlob);","    let w = firstBitmap.width, h = firstBitmap.height;","    const MAX_W = 1280;","    if (w > MAX_W) {","        const ratio = MAX_W / w;","        w = Math.round(w * ratio);","        h = Math.round(h * ratio);","    }","","    const canvas = document.createElement(\"canvas\");","    canvas.width = w;","    canvas.height = h;","    const ctx = canvas.getContext(\"2d\");","    document.body.appendChild(canvas);","","    const stream = canvas.captureStream(25);","    const mimeType = MediaRecorder.isTypeSupported(\"video/webm;codecs=vp9\")","        ? \"video/webm;codecs=vp9\"","        : \"video/webm\";","    const recorder = new MediaRecorder(stream, {","        mimeType,","        videoBitsPerSecond: 8_000_000, // boost quality","    });","","    const chunks = [];","    recorder.ondataavailable = (e) => e.data && chunks.push(e.data);","","    const stopPromise = new Promise((res) => {","        recorder.onstop = () => res(new Blob(chunks, { type: mimeType }));","    });","","    recorder.start(100);","","    for (let i = 0; i < frames.length; i++) {","        const f = frames[i];","        try {","            const blob = await (await fetch(f.screenshot)).blob();","            const bmp = await createImageBitmap(blob, {","                resizeWidth: w,","                resizeHeight: h,","                resizeQuality: \"high\",","            });","            ctx.fillStyle = \"#000\";","            ctx.fillRect(0, 0, w, h);","            ctx.drawImage(bmp, 0, 0, w, h);","            bmp.close();","            prog.value = ((i + 1) / frames.length) * 100;","            status.textContent = `Frame ${i + 1}/${frames.length}`;","            await new Promise((r) => setTimeout(r, 750)); // Wait 750 ms between frames","        } catch (e) {","            console.warn(\"Frame failed:\", e);","        }","    }","","    recorder.stop();","    const blob = await stopPromise;","    const url = URL.createObjectURL(blob);","    const a = document.createElement(\"a\");","    a.href = url;","    a.download = `bug-sense-replay-${Date.now()}.webm`;","    a.click();","","    status.textContent = \"âœ… Export complete!\";","    chrome.storage.local.remove(\"replayExportQueue\");","}","","main();",""]}],[115,{"id":115,"path":"/home/milan/Desktop/bug-sense/frontend/extension/uploader/uploader.js","size":6086,"mtime":1762286201503.3477,"lines":["// extension/uploader.js","// Final version: GIF never appears in main popup, safe & clean processing.","","import GIF from \"gif.js.optimized\";","window.GIF = GIF;","","(async function () {","  console.log(\"[BugSense Uploader] Started\");","","  const MAX_SIZE = 50 * 1024 * 1024;","  const MAX_SECONDS = 6;","  const FPS = 8;","  const MAX_FRAMES = Math.min(MAX_SECONDS * FPS, 48);","","  const el = (id) => document.getElementById(id);","  const fileInput = el(\"file\");","  const startBtn = el(\"start\");","  const closeBtn = el(\"close\");","  const status = el(\"status\");","  const previewImg = el(\"preview\");","  const videoEl = el(\"video\");","  const canvas = el(\"canvas\");","  let controls = el(\"controls\");","","  if (!controls) {","    controls = document.createElement(\"div\");","    controls.id = \"controls\";","    controls.style.marginTop = \"10px\";","    document.body.appendChild(controls);","  }","","  // ðŸ”¹ Immediately clear any leftover public key (prevents popup flash)","  chrome.storage.local.remove(\"generatedGifFromUploader\", () => {","    console.log(\"[BugSense Uploader] Pre-cleaned leftover keys.\");","  });","","  const safeSetStatus = (msg) => {","    if (status && document.visibilityState === \"visible\") status.textContent = msg;","    console.log(\"[Uploader]\", msg);","  };","","  closeBtn?.addEventListener(\"click\", () => window.close());","","  startBtn?.addEventListener(\"click\", async () => {","    const file = fileInput?.files?.[0];","    if (!file) return alert(\"Please choose a file first.\");","    if (file.size > MAX_SIZE) return alert(\"File too large (max 50MB).\");","","    // Reset UI","    previewImg.style.display = \"none\";","    previewImg.src = \"\";","    controls.innerHTML = \"\";","    safeSetStatus(\"Loading video...\");","","    try {","      const url = URL.createObjectURL(file);","      videoEl.src = url;","      videoEl.muted = true;","      videoEl.playsInline = true;","","      await new Promise((res, rej) => {","        videoEl.onloadedmetadata = res;","        videoEl.onerror = rej;","      });","","      const duration = Math.min(videoEl.duration || MAX_SECONDS, MAX_SECONDS);","      const framesToCapture = Math.min(Math.ceil(duration * FPS), MAX_FRAMES);","","      const targetW = 480;","      const targetH = 270;","      canvas.width = targetW;","      canvas.height = targetH;","      const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });","","      const gif = new GIF({","        workers: 2,","        quality: 8,","        width: targetW,","        height: targetH,","        workerScript: chrome.runtime.getURL(\"extension/assets/gif.worker.js\"),","        background: \"#000\",","        repeat: 0,","      });","","      let captured = 0;","      for (let i = 0; i < framesToCapture; i++) {","        const t = i / FPS;","        videoEl.currentTime = Math.min(t, duration - 0.05);","        await new Promise((res) => (videoEl.onseeked = res));","","        ctx.clearRect(0, 0, targetW, targetH);","        const vw = videoEl.videoWidth || targetW;","        const vh = videoEl.videoHeight || targetH;","        const aspect = vw / vh;","        let drawW = targetW,","          drawH = targetH;","        if (vw > vh) drawH = Math.round(targetW / aspect);","        else drawW = Math.round(targetH * aspect);","        const dx = Math.floor((targetW - drawW) / 2);","        const dy = Math.floor((targetH - drawH) / 2);","        ctx.drawImage(videoEl, 0, 0, vw, vh, dx, dy, drawW, drawH);","","        gif.addFrame(ctx, { copy: true, delay: 1000 / FPS });","        captured++;","        safeSetStatus(`Captured ${captured}/${framesToCapture} frames...`);","      }","","      safeSetStatus(\"Rendering GIF (please wait)...\");","","      gif.on(\"finished\", async (blob) => {","        const blobUrl = URL.createObjectURL(blob);","        previewImg.src = blobUrl;","        previewImg.style.display = \"block\";","        safeSetStatus(\"GIF ready ðŸŽ‰\");","","        // --- Download button ---","        const downloadBtn = document.createElement(\"button\");","        downloadBtn.textContent = \"â¬‡ï¸ Download GIF\";","        downloadBtn.style.marginRight = \"8px\";","        downloadBtn.onclick = async () => {","          try {","            const blobData = await blob.arrayBuffer();","            const blobCopy = new Blob([blobData], { type: \"image/gif\" });","            const url = URL.createObjectURL(blobCopy);","            const a = document.createElement(\"a\");","            a.href = url;","            a.download = \"bugsense_output.gif\";","            document.body.appendChild(a);","            a.click();","            a.remove();","            URL.revokeObjectURL(url);","          } catch (err) {","            console.error(\"Download error:\", err);","            alert(\"Failed to download GIF: \" + err.message);","          }","        };","","        // --- Copy link ---","        // const copyBtn = document.createElement(\"button\");","        // copyBtn.textContent = \"ðŸ“‹ Copy Path\";","        // copyBtn.style.marginRight = \"8px\";","        // copyBtn.onclick = async () => {","        //   try {","        //     await navigator.clipboard.writeText(blobUrl);","        //     alert(\"GIF Blob URL copied!\");","        //   } catch (err) {","        //     alert(\"Clipboard error: \" + err.message);","        //   }","        // };","","        // --- Close button ---","        const manualCloseBtn = document.createElement(\"button\");","        manualCloseBtn.textContent = \"âŒ Close\";","        manualCloseBtn.onclick = () => window.close();","","        controls.appendChild(downloadBtn);","        // controls.appendChild(copyBtn);","        controls.appendChild(manualCloseBtn);","","        // --- Store privately (popup won't detect this key) ---","        chrome.storage.local.set({ generatedGif_temp_private: blobUrl }, () => {","          console.log(\"[BugSense Uploader] Stored privately (not visible to popup).\");","          setTimeout(() => {","            chrome.storage.local.remove(\"generatedGif_temp_private\");","          }, 1000);","        });","","        // ðŸš« No message to popup anymore","        // chrome.runtime.sendMessage({ action: \"GIF_READY\", url: blobUrl });","      });","","      gif.render();","    } catch (err) {","      console.error(\"Processing failed:\", err);","      alert(\"GIF generation failed: \" + err.message);","      safeSetStatus(\"Error during processing.\");","    }","  });","})();",""]}],[116,{"id":116,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/cache.ts","size":771,"mtime":1762403631521.9106,"lines":["// Local caching utility (browser localStorage or chrome.storage.local)","const CACHE_KEY = \"bugsense_duplicate_ignore_list\";","","export async function getIgnoredPairs(): Promise<string[]> {","  const data = localStorage.getItem(CACHE_KEY);","  if (!data) return [];","  try {","    return JSON.parse(data);","  } catch {","    return [];","  }","}","","export async function addIgnoredPair(idA: number, idB: number) {","  const key = [idA, idB].sort().join(\"-\");","  const list = await getIgnoredPairs();","  if (!list.includes(key)) {","    list.push(key);","    localStorage.setItem(CACHE_KEY, JSON.stringify(list));","  }","}","","export async function isIgnoredPair(idA: number, idB: number) {","  const key = [idA, idB].sort().join(\"-\");","  const list = await getIgnoredPairs();","  return list.includes(key);","}","",""]}],[117,{"id":117,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/formattedDate.ts","size":868,"mtime":1762239108018.1702,"lines":["export function getFormattedDate() {","    const d = new Date();","    const day = d.getDate();","    // Function to get \"st\", \"nd\", \"rd\", \"th\"","    const nth = (d: number) => {","        if (d > 3 && d < 21) return 'th';","        switch (d % 10) {","            case 1: return \"st\";","            case 2: return \"nd\";","            case 3: return \"rd\";","            default: return \"th\";","        }","    };","    const dayStr = day + nth(day);","    const monthStr = d.toLocaleDateString('en-US', { month: 'short' });","    const yearStr = d.getFullYear();","    let hour = d.getHours();","    const ampm = hour >= 12 ? 'Pm' : 'Am';","    hour = hour % 12;","    hour = hour ? hour : 12; // the hour '0' should be '12'","    const minStr = d.getMinutes().toString().padStart(2, '0');","","    // Returns \"4th Nov 2025 | 12.16 Pm\"","    return `${dayStr} ${monthStr} ${yearStr} | ${hour}.${minStr} ${ampm}`;","}"]}],[118,{"id":118,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/replayBuffer.ts","size":562,"mtime":1761715013626.6875,"lines":["// replayBuffer.ts","type ActionEvent = {","  type: \"click\" | \"keypress\";","  timestamp: number;","  details: any;","};","","const MAX_BUFFER_TIME = 30 * 1000; // 30 seconds","let events: ActionEvent[] = [];","","export function logAction(event: ActionEvent) {","  const now = Date.now();","  events.push(event);","  events = events.filter((e) => now - e.timestamp < MAX_BUFFER_TIME);","}","","export function getRecentActions(): ActionEvent[] {","  const now = Date.now();","  return events.filter((e) => now - e.timestamp < MAX_BUFFER_TIME);","}","","export function clearActions() {","  events = [];","}","",""]}],[119,{"id":119,"path":"/home/milan/Desktop/bug-sense/frontend/extension/utils/sheetsAPI.ts","size":8512,"mtime":1762404735347.7888,"lines":["// extension/utils/sheetsAPI.ts","// extension/utils/sheetsAPI.ts","export async function getSheetData(spreadsheetId: string, range: string) {","  return new Promise<any>(async (resolve, reject) => {","    try {","      console.group(\"[BugSense][getSheetData] start\");","      console.log(\"spreadsheetId:\", spreadsheetId);","      console.log(\"range:\", range);","","      // 1ï¸âƒ£ Ask background for token","      const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","        try {","          chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => {","            res(response);","          });","        } catch (sendErr) {","          console.error(\"[BugSense][getSheetData] sendMessage threw:\", sendErr);","          res({ success: false, error: sendErr });","        }","      });","","      console.log(\"[BugSense][getSheetData] tokenResponse:\", tokenResponse);","","      if (!tokenResponse?.success || !tokenResponse.token) {","        console.error(\"[BugSense][getSheetData] Failed to get token:\", tokenResponse?.error);","        console.groupEnd();","        return reject(tokenResponse?.error || new Error(\"Failed to get token\"));","      }","","      const token = tokenResponse.token;","      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(range)}?majorDimension=ROWS`;","","      console.log(\"[BugSense][getSheetData] fetch url:\", url);","","      const response = await fetch(url, {","        headers: { Authorization: `Bearer ${token}` },","      });","","      console.log(`[BugSense][getSheetData] fetch status: ${response.status} ${response.statusText}`);","","      if (!response.ok) {","        const text = await response.text().catch(() => \"<could not read response body>\");","        console.error(\"[BugSense][getSheetData] fetch returned non-ok:\", response.status, text);","        console.groupEnd();","        return reject(new Error(`Sheets API error ${response.status}: ${text}`));","      }","","      const data = await response.json().catch((e) => {","        console.error(\"[BugSense][getSheetData] json parse error:\", e);","        return null;","      });","","      console.log(\"[BugSense][getSheetData] response data:\", data);","      console.groupEnd();","      resolve(data);","    } catch (err) {","      console.error(\"[BugSense][getSheetData] outer catch:\", err);","      reject(err);","    }","  });","}","","","export async function highlightDuplicates(","  spreadsheetId: string,","  rows: string[][],","  pairs: any[]",") {","  if (!pairs || pairs.length === 0) {","    console.log(\"[BugSense] No duplicates found for highlighting.\");","    return;","  }","","  // get token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) return;","  const token = tokenResponse.token;","","  // Fetch actual sheetId","  const metaRes = await fetch(","    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?fields=sheets.properties`,","    { headers: { Authorization: `Bearer ${token}` } }","  );","  const meta = await metaRes.json();","  const targetSheet = meta.sheets.find((s: any) => s.properties.title === \"bug_report\");","  const actualSheetId = targetSheet?.properties?.sheetId ?? 0;","","  // Build request","  const uniqueRows = new Set<number>();","  pairs.forEach((p: any) => {","    if (Array.isArray(p)) {","      p.forEach((id: number) => uniqueRows.add(id + 1)); // +1 skip header","    } else if (p.i !== undefined && p.j !== undefined) {","      uniqueRows.add(p.i + 1);","      uniqueRows.add(p.j + 1);","    }","  });","","  const requests = [...uniqueRows].map((rowIndex) => ({","    repeatCell: {","      range: {","        sheetId: actualSheetId,","        startRowIndex: rowIndex,","        endRowIndex: rowIndex + 1,","      },","      cell: {","        userEnteredFormat: {","          backgroundColor: { red: 1, green: 0.6, blue: 0.6 },","        },","      },","      fields: \"userEnteredFormat.backgroundColor\",","    },","  }));","","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}:batchUpdate`, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify({ requests }),","  });","","  if (resp.ok) {","    console.log(\"[BugSense] Highlighted duplicate rows in red ðŸš¨\");","  } else {","    console.warn(\"[BugSense] Highlight request failed:\", await resp.text());","  }","}","","export async function clearHighlights(","  spreadsheetId: string,","  pairs: any[]",") {","  if (!pairs || pairs.length === 0) {","    console.log(\"[BugSense] No rows to clear highlights.\");","    return;","  }","","  // get token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) return;","  const token = tokenResponse.token;","","  // fetch sheetId","  const metaRes = await fetch(","    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?fields=sheets.properties`,","    { headers: { Authorization: `Bearer ${token}` } }","  );","  const meta = await metaRes.json();","  const targetSheet = meta.sheets.find((s: any) => s.properties.title === \"bug_report\");","  const actualSheetId = targetSheet?.properties?.sheetId ?? 0;","","  // collect row indices","  const uniqueRows = new Set<number>();","  pairs.forEach((p: any) => {","    if (Array.isArray(p)) {","      p.forEach((id: number) => uniqueRows.add(id + 1));","    } else if (p.i !== undefined && p.j !== undefined) {","      uniqueRows.add(p.i + 1);","      uniqueRows.add(p.j + 1);","    }","  });","","  // build requests to reset background","  const requests = [...uniqueRows].map((rowIndex) => ({","    repeatCell: {","      range: {","        sheetId: actualSheetId,","        startRowIndex: rowIndex,","        endRowIndex: rowIndex + 1,","      },","      cell: {","        userEnteredFormat: {","          backgroundColor: null, // ðŸ§¹ removes red fill","        },","      },","      fields: \"userEnteredFormat.backgroundColor\",","    },","  }));","","  // execute","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}:batchUpdate`, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify({ requests }),","  });","","  if (resp.ok) {","    console.log(\"[BugSense] Cleared duplicate highlights ðŸ§¹\");","  } else {","    console.warn(\"[BugSense] Failed to clear highlights:\", await resp.text());","  }","}","","// extension/utils/sheetsAPI.ts  (append to existing file)","export async function appendRow(sheetId: string, range: string, rowValues: any[]) {","  // ask background for token","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","","  if (!tokenResponse?.success || !tokenResponse.token) {","    throw new Error(\"Failed to get token for append\");","  }","  const token = tokenResponse.token;","","  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS`;","  const body = { values: [rowValues] };","","  const resp = await fetch(url, {","    method: \"POST\",","    headers: {","      Authorization: `Bearer ${token}`,","      \"Content-Type\": \"application/json\",","    },","    body: JSON.stringify(body),","  });","","  if (!resp.ok) {","    const err = await resp.json().catch(() => ({ status: resp.status, statusText: resp.statusText }));","    throw new Error(`Sheets append error: ${JSON.stringify(err)}`);","  }","","  return await resp.json();","}","","export async function getSheetsProperties(sheetId: string) {","  const tokenResponse = await new Promise<{ success: boolean; token?: string; error?: any }>((res) => {","    chrome.runtime.sendMessage({ action: \"GET_GOOGLE_TOKEN\" }, (response) => res(response));","  });","  if (!tokenResponse?.success || !tokenResponse.token) throw new Error(\"Failed to get token\");","  const token = tokenResponse.token;","  const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}?fields=sheets.properties`, {","    headers: { Authorization: `Bearer ${token}` },","  });","  if (!resp.ok) {","    const j = await resp.json().catch(() => null);","    throw new Error(`getSheetsProperties error: ${JSON.stringify(j)}`);","  }","  return await resp.json();","}","",""]}],[120,{"id":120,"path":"/home/milan/Desktop/bug-sense/frontend/global.d.ts","size":24,"mtime":1761715013623.0479,"lines":["declare module \"*.css\";",""]}],[121,{"id":121,"path":"/home/milan/Desktop/bug-sense/frontend/vite.config.devtools.ts","size":1160,"mtime":1762226242802.7227,"lines":["import { defineConfig } from \"vite\";","import react from \"@vitejs/plugin-react\";","import { resolve } from \"path\";","","export default defineConfig({","    // Set the root to the devtools source directory","    root: \"extension/devtools\",","","    // Use relative paths for assets","    base: \"./\",","","    build: {","        // Build *into* the correct subfolder of the main build's output dir","        outDir: resolve(__dirname, \"dist/extension/devtools\"),","","        // CRITICAL: This MUST be true. ","        // It deletes the source files (copied by crx) before writing the compiled files.","        emptyOutDir: true,","        sourcemap: true,","","        rollupOptions: {","            // Define BOTH of your HTML files as inputs for Vite","            input: {","                main: resolve(__dirname, \"extension/devtools/index.html\"),","                register: resolve(__dirname, \"extension/devtools/register.html\"),","            },","","            // Keep the output filenames simple and predictable","            output: {","                entryFileNames: \"[name].js\",","                assetFileNames: \"assets/[name]-[hash][extname]\",","            },","        },","    },","    plugins: [react()],","});"]}],[122,{"id":122,"path":"/home/milan/Desktop/bug-sense/frontend/vite.config.ts","size":2304,"mtime":1762432921013.4023,"lines":["// vite.config.ts (replace file with this)","import { defineConfig } from \"vite\";","import react from \"@vitejs/plugin-react\";","import { crx } from \"@crxjs/vite-plugin\";","import manifest from \"./extension/manifest.json\";","import { resolve } from \"path\";","import fs from \"fs\";","","export default defineConfig({","  plugins: [","    react(),","    crx({ manifest }),","","    // copy key.pem -> dist if present","    {","      name: \"copy-key-pem\",","      closeBundle() {","        const src = resolve(__dirname, \"key.pem\");","        const dest = resolve(__dirname, \"dist/key.pem\");","        if (!fs.existsSync(src)) {","          console.warn(\"âš ï¸ key.pem not found â€” skipping (dev).\");","          return;","        }","        try {","          fs.copyFileSync(src, dest);","          console.log(\"âœ… key.pem copied to dist/\");","        } catch (err) {","          console.error(\"âŒ Failed to copy key.pem:\", err);","        }","      },","    },","  ],","","  // IMPORTANT: disable publicDir to prevent accidental copies","  publicDir: false,","","  build: {","    outDir: \"dist\",","    emptyOutDir: true,","    sourcemap: true,","    rollupOptions: {","      input: {","        popup: resolve(__dirname, \"extension/popup/index.html\"),","        uploader: resolve(__dirname, \"extension/uploader/uploader.html\"),","        background: resolve(__dirname, \"extension/background/index.ts\"),","        replayListener: resolve(__dirname, \"extension/content/replayListener.ts\"),","        duplicateBugDetector: resolve(__dirname, \"extension/content/duplicateBugDetector.ts\"),","        consoleListener: resolve(__dirname, \"extension/content/consoleListener.ts\"),","        recorder: resolve(__dirname, \"extension/recorder/recorder.html\"),","        replayExport: resolve(__dirname, \"extension/replay-export/replay-export.html\"),","        selectionOverlay: resolve(__dirname, \"extension/content/selectionOverlay.ts\"),","        // NOTE: Do NOT add devtools HTML here â€” devtools build is separate","      },","      output: {","        entryFileNames: (chunk) => {","          if (chunk.name === \"background\") return \"extension/background/[name].js\";","          if (chunk.name === \"replayListener\") return \"extension/content/[name].js\";","          if (chunk.name === \"selectionOverlay\") return \"extension/content/[name].js\";","          return \"assets/[name]-[hash].js\";","        },","      },","    },","  },","});",""]}]],"tokenIndex":[["initai",[3,4,92,93]],["analyzebug",[3,4,92,93]],["initmodel",[5,94]],["embedtexts",[5,94]],["cosinesimilarity",[5,94]],["findduplicates",[5,94]],["e",[6,95]],["r",[6,95]],["s",[6,95]],["i",[6,95]],["c",[6,95]],["w",[6,95]],["x",[6,95]],["v",[6,95]],["m",[6,95]],["d",[6,95]],["g",[6,95]],["h",[6,95]],["l",[6,95]],["u",[6,95]],["p",[6,95]],["f",[6,95]],["y",[6,95]],["setrecordingflag",[7,96]],["savebloburltostorage",[7,96]],["finalizerecording",[7,96]],["trytabcapture",[7,96]],["schedulescreenshotcleanup",[7,96]],["createpreviewdataurl",[7,96]],["getcacheddata",[7,96]],["gettextcolorforoklch",[8,97]],["displaybutton",[8,97]],["pusherror",[9,98]],["initduplicatedetector",[10,99]],["renderoverlaysummary",[10,99]],["safestorageset",[11,100]],["persistactions",[11,100]],["persistscreenshotifavailable",[11,100]],["pruneold",[11,100]],["requestcaptureframe",[11,100]],["maybecapture",[11,100]],["handleclick",[11,100]],["handlekeypress",[11,100]],["addlisteners",[11,100]],["removelisteners",[11,100]],["init",[11,100]],["createoverlay",[12,101]],["hardremoveoverlay",[12,101]],["startsingleselection",[12,101]],["onpointerdown",[12,101]],["onpointermove",[12,101]],["cleanuplisteners",[12,101]],["onpointerup",[12,101]],["onpointercancel",[12,101]],["onkeydown",[12,101]],["devpanel",[13,102]],["load",[13,102]],["onchange",[13,19,102,108]],["promptforextradetails",[13,102]],["listener",[13,17,102,106]],["messagelistener",[13,102]],["insertintosheet",[13,102]],["handlepreviewclick",[13,102]],["handlecopytoclipboard",[13,102]],["app",[16,72,86,105]],["handleannotate",[16,105]],["header",[16,18,105,107]],["gifmaker",[17,106]],["openuploader",[17,106]],["downloadgif",[17,106]],["runduplicatescan",[18,107]],["instantreplay",[19,108]],["startplayback",[19,108]],["stopplayback",[19,108]],["toggleplay",[19,108]],["prevframe",[19,108]],["nextframe",[19,108]],["buildvideoanddownload",[19,108]],["markertool",[20,109]],["tocanvascoords",[20,109]],["handlemousedown",[20,109]],["handlemousemove",[20,109]],["handlemouseup",[20,109]],["addtext",[20,109]],["saveannotated",[20,109]],["recordertool",[21,110]],["handlechange",[21,110]],["startrecording",[21,24,110,113]],["screenshottool",[22,111]],["capturescreenshot",[22,111]],["downloadscreenshot",[22,111]],["setui",[24,113]],["main",[25,114]],["el",[26,115]],["safesetstatus",[26,115]],["getignoredpairs",[27,116]],["addignoredpair",[27,116]],["isignoredpair",[27,116]],["getformatteddate",[28,117]],["nth",[28,117]],["logaction",[29,118]],["getrecentactions",[29,118]],["clearactions",[29,118]],["getsheetdata",[30,119]],["highlightduplicates",[30,119]],["clearhighlights",[30,119]],["appendrow",[30,119]],["getsheetsproperties",[30,119]],["extractsymbols",[34,53]],["scanfiles",[35,54]],["intersectsets",[36,55]],["scorematch",[36,55]],["ownkeys",[37,48]],["searchindex",[38,57]],["score",[38,57]],["trigrams",[39,58]],["createwindow",[48,66]],["importprojects",[72]],["onselect",[72]],["usesearch",[73]],["codeclipboard",[75]],["injectpanel",[76]],["inject",[76]],["searchresults",[77]],["projectimporter",[78]],["importfolders",[78]],["sidebar",[81]],["detectlanguage",[83]]],"symbolIndex":[["initai",[{"name":"initAI","fileId":3,"startLine":17,"endLine":27,"kind":"function"},{"name":"initAI","fileId":4,"startLine":32,"endLine":48,"kind":"function"},{"name":"initAI","fileId":92,"startLine":17,"endLine":27,"kind":"function"},{"name":"initAI","fileId":93,"startLine":32,"endLine":48,"kind":"function"}]],["analyzebug",[{"name":"analyzeBug","fileId":3,"startLine":30,"endLine":96,"kind":"function"},{"name":"analyzeBug","fileId":4,"startLine":53,"endLine":144,"kind":"function"},{"name":"analyzeBug","fileId":92,"startLine":30,"endLine":96,"kind":"function"},{"name":"analyzeBug","fileId":93,"startLine":53,"endLine":144,"kind":"function"}]],["initmodel",[{"name":"initModel","fileId":5,"startLine":27,"endLine":45,"kind":"function"},{"name":"initModel","fileId":94,"startLine":27,"endLine":45,"kind":"function"}]],["embedtexts",[{"name":"embedTexts","fileId":5,"startLine":51,"endLine":80,"kind":"function"},{"name":"embedTexts","fileId":94,"startLine":51,"endLine":80,"kind":"function"}]],["cosinesimilarity",[{"name":"cosineSimilarity","fileId":5,"startLine":85,"endLine":97,"kind":"function"},{"name":"cosineSimilarity","fileId":94,"startLine":85,"endLine":97,"kind":"function"}]],["findduplicates",[{"name":"findDuplicates","fileId":5,"startLine":111,"endLine":139,"kind":"function"},{"name":"findDuplicates","fileId":94,"startLine":111,"endLine":139,"kind":"function"}]],["e",[{"name":"e","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"e","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["r",[{"name":"r","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"r","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["s",[{"name":"s","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"s","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["i",[{"name":"i","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"i","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"I","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"i","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"i","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"i","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"I","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"i","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["c",[{"name":"c","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"C","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"c","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"c","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"C","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"c","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["w",[{"name":"w","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"w","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"w","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"w","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["x",[{"name":"x","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"x","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["v",[{"name":"v","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"v","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["m",[{"name":"m","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"m","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["d",[{"name":"D","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"d","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"D","fileId":95,"startLine":1,"endLine":1,"kind":"function"},{"name":"d","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["g",[{"name":"G","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"G","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["h",[{"name":"h","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"h","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["l",[{"name":"l","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"l","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["u",[{"name":"u","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"u","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["p",[{"name":"p","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"p","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["f",[{"name":"f","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"f","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["y",[{"name":"y","fileId":6,"startLine":1,"endLine":1,"kind":"function"},{"name":"y","fileId":95,"startLine":1,"endLine":1,"kind":"function"}]],["setrecordingflag",[{"name":"setRecordingFlag","fileId":7,"startLine":29,"endLine":35,"kind":"function"},{"name":"setRecordingFlag","fileId":96,"startLine":29,"endLine":35,"kind":"function"}]],["savebloburltostorage",[{"name":"saveBlobUrlToStorage","fileId":7,"startLine":37,"endLine":60,"kind":"function"},{"name":"saveBlobUrlToStorage","fileId":96,"startLine":37,"endLine":60,"kind":"function"}]],["finalizerecording",[{"name":"finalizeRecording","fileId":7,"startLine":62,"endLine":80,"kind":"function"},{"name":"finalizeRecording","fileId":96,"startLine":62,"endLine":80,"kind":"function"}]],["trytabcapture",[{"name":"tryTabCapture","fileId":7,"startLine":83,"endLine":104,"kind":"function"},{"name":"tryTabCapture","fileId":96,"startLine":83,"endLine":104,"kind":"function"}]],["schedulescreenshotcleanup",[{"name":"scheduleScreenshotCleanup","fileId":7,"startLine":199,"endLine":203,"kind":"function"},{"name":"scheduleScreenshotCleanup","fileId":96,"startLine":199,"endLine":203,"kind":"function"}]],["createpreviewdataurl",[{"name":"createPreviewDataUrl","fileId":7,"startLine":205,"endLine":230,"kind":"function"},{"name":"createPreviewDataUrl","fileId":96,"startLine":205,"endLine":230,"kind":"function"}]],["getcacheddata",[{"name":"getCachedData","fileId":7,"startLine":683,"endLine":702,"kind":"function"},{"name":"getCachedData","fileId":96,"startLine":683,"endLine":702,"kind":"function"}]],["gettextcolorforoklch",[{"name":"getTextColorForOklch","fileId":8,"startLine":10,"endLine":20,"kind":"function"},{"name":"getTextColorForOklch","fileId":97,"startLine":10,"endLine":20,"kind":"function"}]],["displaybutton",[{"name":"DisplayButton","fileId":8,"startLine":61,"endLine":85,"kind":"function"},{"name":"DisplayButton","fileId":97,"startLine":61,"endLine":85,"kind":"function"}]],["pusherror",[{"name":"pushError","fileId":9,"startLine":4,"endLine":16,"kind":"function"},{"name":"pushError","fileId":98,"startLine":4,"endLine":16,"kind":"function"}]],["initduplicatedetector",[{"name":"initDuplicateDetector","fileId":10,"startLine":9,"endLine":68,"kind":"function"},{"name":"initDuplicateDetector","fileId":99,"startLine":9,"endLine":68,"kind":"function"}]],["renderoverlaysummary",[{"name":"renderOverlaySummary","fileId":10,"startLine":71,"endLine":190,"kind":"function"},{"name":"renderOverlaySummary","fileId":99,"startLine":71,"endLine":190,"kind":"function"}]],["safestorageset",[{"name":"safeStorageSet","fileId":11,"startLine":24,"endLine":39,"kind":"function"},{"name":"safeStorageSet","fileId":100,"startLine":24,"endLine":39,"kind":"function"}]],["persistactions",[{"name":"persistActions","fileId":11,"startLine":44,"endLine":50,"kind":"function"},{"name":"persistActions","fileId":100,"startLine":44,"endLine":50,"kind":"function"}]],["persistscreenshotifavailable",[{"name":"persistScreenshotIfAvailable","fileId":11,"startLine":52,"endLine":64,"kind":"function"},{"name":"persistScreenshotIfAvailable","fileId":100,"startLine":52,"endLine":64,"kind":"function"}]],["pruneold",[{"name":"pruneOld","fileId":11,"startLine":69,"endLine":72,"kind":"function"},{"name":"pruneOld","fileId":100,"startLine":69,"endLine":72,"kind":"function"}]],["requestcaptureframe",[{"name":"requestCaptureFrame","fileId":11,"startLine":103,"endLine":143,"kind":"function"},{"name":"requestCaptureFrame","fileId":100,"startLine":103,"endLine":143,"kind":"function"}]],["maybecapture",[{"name":"maybeCapture","fileId":11,"startLine":146,"endLine":156,"kind":"function"},{"name":"maybeCapture","fileId":100,"startLine":146,"endLine":156,"kind":"function"}]],["handleclick",[{"name":"handleClick","fileId":11,"startLine":161,"endLine":177,"kind":"function"},{"name":"handleClick","fileId":100,"startLine":161,"endLine":177,"kind":"function"}]],["handlekeypress",[{"name":"handleKeypress","fileId":11,"startLine":179,"endLine":189,"kind":"function"},{"name":"handleKeypress","fileId":100,"startLine":179,"endLine":189,"kind":"function"}]],["addlisteners",[{"name":"addListeners","fileId":11,"startLine":194,"endLine":202,"kind":"function"},{"name":"addListeners","fileId":100,"startLine":194,"endLine":202,"kind":"function"}]],["removelisteners",[{"name":"removeListeners","fileId":11,"startLine":204,"endLine":212,"kind":"function"},{"name":"removeListeners","fileId":100,"startLine":204,"endLine":212,"kind":"function"}]],["init",[{"name":"init","fileId":11,"startLine":217,"endLine":231,"kind":"function"},{"name":"init","fileId":100,"startLine":217,"endLine":231,"kind":"function"}]],["createoverlay",[{"name":"createOverlay","fileId":12,"startLine":9,"endLine":32,"kind":"function"},{"name":"createOverlay","fileId":101,"startLine":9,"endLine":32,"kind":"function"}]],["hardremoveoverlay",[{"name":"hardRemoveOverlay","fileId":12,"startLine":34,"endLine":40,"kind":"function"},{"name":"hardRemoveOverlay","fileId":101,"startLine":34,"endLine":40,"kind":"function"}]],["startsingleselection",[{"name":"startSingleSelection","fileId":12,"startLine":42,"endLine":140,"kind":"function"},{"name":"startSingleSelection","fileId":101,"startLine":42,"endLine":140,"kind":"function"}]],["onpointerdown",[{"name":"onPointerDown","fileId":12,"startLine":53,"endLine":75,"kind":"function"},{"name":"onPointerDown","fileId":101,"startLine":53,"endLine":75,"kind":"function"}]],["onpointermove",[{"name":"onPointerMove","fileId":12,"startLine":77,"endLine":94,"kind":"function"},{"name":"onPointerMove","fileId":101,"startLine":77,"endLine":94,"kind":"function"}]],["cleanuplisteners",[{"name":"cleanupListeners","fileId":12,"startLine":96,"endLine":100,"kind":"function"},{"name":"cleanupListeners","fileId":101,"startLine":96,"endLine":100,"kind":"function"}]],["onpointerup",[{"name":"onPointerUp","fileId":12,"startLine":102,"endLine":124,"kind":"function"},{"name":"onPointerUp","fileId":101,"startLine":102,"endLine":124,"kind":"function"}]],["onpointercancel",[{"name":"onPointerCancel","fileId":12,"startLine":126,"endLine":129,"kind":"function"},{"name":"onPointerCancel","fileId":101,"startLine":126,"endLine":129,"kind":"function"}]],["onkeydown",[{"name":"onKeyDown","fileId":12,"startLine":131,"endLine":136,"kind":"function"},{"name":"onKeyDown","fileId":101,"startLine":131,"endLine":136,"kind":"function"}]],["devpanel",[{"name":"DevPanel","fileId":13,"startLine":34,"endLine":635,"kind":"function"},{"name":"DevPanel","fileId":102,"startLine":34,"endLine":635,"kind":"function"}]],["load",[{"name":"load","fileId":13,"startLine":49,"endLine":54,"kind":"function"},{"name":"load","fileId":102,"startLine":49,"endLine":54,"kind":"function"}]],["onchange",[{"name":"onChange","fileId":13,"startLine":56,"endLine":65,"kind":"function"},{"name":"onChange","fileId":19,"startLine":57,"endLine":67,"kind":"function"},{"name":"onChange","fileId":102,"startLine":56,"endLine":65,"kind":"function"},{"name":"onChange","fileId":108,"startLine":57,"endLine":67,"kind":"function"}]],["promptforextradetails",[{"name":"promptForExtraDetails","fileId":13,"startLine":71,"endLine":77,"kind":"function"},{"name":"promptForExtraDetails","fileId":102,"startLine":71,"endLine":77,"kind":"function"}]],["listener",[{"name":"listener","fileId":13,"startLine":82,"endLine":87,"kind":"function"},{"name":"listener","fileId":17,"startLine":13,"endLine":18,"kind":"function"},{"name":"listener","fileId":102,"startLine":82,"endLine":87,"kind":"function"},{"name":"listener","fileId":106,"startLine":13,"endLine":18,"kind":"function"}]],["messagelistener",[{"name":"messageListener","fileId":13,"startLine":248,"endLine":291,"kind":"function"},{"name":"messageListener","fileId":102,"startLine":248,"endLine":291,"kind":"function"}]],["insertintosheet",[{"name":"insertIntoSheet","fileId":13,"startLine":298,"endLine":335,"kind":"function"},{"name":"insertIntoSheet","fileId":102,"startLine":298,"endLine":335,"kind":"function"}]],["handlepreviewclick",[{"name":"handlePreviewClick","fileId":13,"startLine":337,"endLine":346,"kind":"function"},{"name":"handlePreviewClick","fileId":102,"startLine":337,"endLine":346,"kind":"function"}]],["handlecopytoclipboard",[{"name":"handleCopyToClipboard","fileId":13,"startLine":348,"endLine":371,"kind":"function"},{"name":"handleCopyToClipboard","fileId":102,"startLine":348,"endLine":371,"kind":"function"}]],["app",[{"name":"App","fileId":16,"startLine":8,"endLine":71,"kind":"function"},{"name":"App","fileId":72,"startLine":12,"endLine":82,"kind":"function"},{"name":"App","fileId":86,"startLine":6,"endLine":33,"kind":"function"},{"name":"App","fileId":105,"startLine":8,"endLine":71,"kind":"function"}]],["handleannotate",[{"name":"handleAnnotate","fileId":16,"startLine":12,"endLine":15,"kind":"function"},{"name":"handleAnnotate","fileId":105,"startLine":12,"endLine":15,"kind":"function"}]],["header",[{"name":"Header","fileId":16,"startLine":18,"endLine":37,"kind":"function"},{"name":"Header","fileId":18,"startLine":3,"endLine":24,"kind":"function"},{"name":"Header","fileId":105,"startLine":18,"endLine":37,"kind":"function"},{"name":"Header","fileId":107,"startLine":3,"endLine":24,"kind":"function"}]],["gifmaker",[{"name":"GifMaker","fileId":17,"startLine":4,"endLine":52,"kind":"function"},{"name":"GifMaker","fileId":106,"startLine":4,"endLine":52,"kind":"function"}]],["openuploader",[{"name":"openUploader","fileId":17,"startLine":23,"endLine":28,"kind":"function"},{"name":"openUploader","fileId":106,"startLine":23,"endLine":28,"kind":"function"}]],["downloadgif",[{"name":"downloadGif","fileId":17,"startLine":30,"endLine":36,"kind":"function"},{"name":"downloadGif","fileId":106,"startLine":30,"endLine":36,"kind":"function"}]],["runduplicatescan",[{"name":"runDuplicateScan","fileId":18,"startLine":4,"endLine":11,"kind":"function"},{"name":"runDuplicateScan","fileId":107,"startLine":4,"endLine":11,"kind":"function"}]],["instantreplay",[{"name":"InstantReplay","fileId":19,"startLine":27,"endLine":259,"kind":"function"},{"name":"InstantReplay","fileId":108,"startLine":27,"endLine":259,"kind":"function"}]],["startplayback",[{"name":"startPlayback","fileId":19,"startLine":88,"endLine":97,"kind":"function"},{"name":"startPlayback","fileId":108,"startLine":88,"endLine":97,"kind":"function"}]],["stopplayback",[{"name":"stopPlayback","fileId":19,"startLine":99,"endLine":104,"kind":"function"},{"name":"stopPlayback","fileId":108,"startLine":99,"endLine":104,"kind":"function"}]],["toggleplay",[{"name":"togglePlay","fileId":19,"startLine":106,"endLine":108,"kind":"function"},{"name":"togglePlay","fileId":108,"startLine":106,"endLine":108,"kind":"function"}]],["prevframe",[{"name":"prevFrame","fileId":19,"startLine":110,"endLine":112,"kind":"function"},{"name":"prevFrame","fileId":108,"startLine":110,"endLine":112,"kind":"function"}]],["nextframe",[{"name":"nextFrame","fileId":19,"startLine":114,"endLine":116,"kind":"function"},{"name":"nextFrame","fileId":108,"startLine":114,"endLine":116,"kind":"function"}]],["buildvideoanddownload",[{"name":"buildVideoAndDownload","fileId":19,"startLine":120,"endLine":147,"kind":"function"},{"name":"buildVideoAndDownload","fileId":108,"startLine":120,"endLine":147,"kind":"function"}]],["markertool",[{"name":"MarkerTool","fileId":20,"startLine":10,"endLine":246,"kind":"function"},{"name":"MarkerTool","fileId":109,"startLine":10,"endLine":246,"kind":"function"}]],["tocanvascoords",[{"name":"toCanvasCoords","fileId":20,"startLine":44,"endLine":53,"kind":"function"},{"name":"toCanvasCoords","fileId":109,"startLine":44,"endLine":53,"kind":"function"}]],["handlemousedown",[{"name":"handleMouseDown","fileId":20,"startLine":55,"endLine":82,"kind":"function"},{"name":"handleMouseDown","fileId":109,"startLine":55,"endLine":82,"kind":"function"}]],["handlemousemove",[{"name":"handleMouseMove","fileId":20,"startLine":84,"endLine":130,"kind":"function"},{"name":"handleMouseMove","fileId":109,"startLine":84,"endLine":130,"kind":"function"}]],["handlemouseup",[{"name":"handleMouseUp","fileId":20,"startLine":132,"endLine":135,"kind":"function"},{"name":"handleMouseUp","fileId":109,"startLine":132,"endLine":135,"kind":"function"}]],["addtext",[{"name":"addText","fileId":20,"startLine":137,"endLine":145,"kind":"function"},{"name":"addText","fileId":109,"startLine":137,"endLine":145,"kind":"function"}]],["saveannotated",[{"name":"saveAnnotated","fileId":20,"startLine":147,"endLine":176,"kind":"function"},{"name":"saveAnnotated","fileId":109,"startLine":147,"endLine":176,"kind":"function"}]],["recordertool",[{"name":"RecorderTool","fileId":21,"startLine":15,"endLine":72,"kind":"function"},{"name":"RecorderTool","fileId":110,"startLine":15,"endLine":72,"kind":"function"}]],["handlechange",[{"name":"handleChange","fileId":21,"startLine":25,"endLine":29,"kind":"function"},{"name":"handleChange","fileId":110,"startLine":25,"endLine":29,"kind":"function"}]],["startrecording",[{"name":"startRecording","fileId":21,"startLine":35,"endLine":65,"kind":"function"},{"name":"startRecording","fileId":24,"startLine":26,"endLine":80,"kind":"function"},{"name":"startRecording","fileId":110,"startLine":35,"endLine":65,"kind":"function"},{"name":"startRecording","fileId":113,"startLine":26,"endLine":80,"kind":"function"}]],["screenshottool",[{"name":"ScreenshotTool","fileId":22,"startLine":7,"endLine":102,"kind":"function"},{"name":"ScreenshotTool","fileId":111,"startLine":7,"endLine":102,"kind":"function"}]],["capturescreenshot",[{"name":"captureScreenshot","fileId":22,"startLine":23,"endLine":45,"kind":"function"},{"name":"captureScreenshot","fileId":111,"startLine":23,"endLine":45,"kind":"function"}]],["downloadscreenshot",[{"name":"downloadScreenshot","fileId":22,"startLine":47,"endLine":60,"kind":"function"},{"name":"downloadScreenshot","fileId":111,"startLine":47,"endLine":60,"kind":"function"}]],["setui",[{"name":"setUI","fileId":24,"startLine":13,"endLine":24,"kind":"function"},{"name":"setUI","fileId":113,"startLine":13,"endLine":24,"kind":"function"}]],["main",[{"name":"main","fileId":25,"startLine":1,"endLine":80,"kind":"function"},{"name":"main","fileId":114,"startLine":1,"endLine":80,"kind":"function"}]],["el",[{"name":"el","fileId":26,"startLine":15,"endLine":15,"kind":"function"},{"name":"el","fileId":115,"startLine":15,"endLine":15,"kind":"function"}]],["safesetstatus",[{"name":"safeSetStatus","fileId":26,"startLine":37,"endLine":40,"kind":"function"},{"name":"safeSetStatus","fileId":115,"startLine":37,"endLine":40,"kind":"function"}]],["getignoredpairs",[{"name":"getIgnoredPairs","fileId":27,"startLine":4,"endLine":12,"kind":"function"},{"name":"getIgnoredPairs","fileId":116,"startLine":4,"endLine":12,"kind":"function"}]],["addignoredpair",[{"name":"addIgnoredPair","fileId":27,"startLine":14,"endLine":21,"kind":"function"},{"name":"addIgnoredPair","fileId":116,"startLine":14,"endLine":21,"kind":"function"}]],["isignoredpair",[{"name":"isIgnoredPair","fileId":27,"startLine":23,"endLine":27,"kind":"function"},{"name":"isIgnoredPair","fileId":116,"startLine":23,"endLine":27,"kind":"function"}]],["getformatteddate",[{"name":"getFormattedDate","fileId":28,"startLine":1,"endLine":25,"kind":"function"},{"name":"getFormattedDate","fileId":117,"startLine":1,"endLine":25,"kind":"function"}]],["nth",[{"name":"nth","fileId":28,"startLine":5,"endLine":13,"kind":"function"},{"name":"nth","fileId":117,"startLine":5,"endLine":13,"kind":"function"}]],["logaction",[{"name":"logAction","fileId":29,"startLine":11,"endLine":15,"kind":"function"},{"name":"logAction","fileId":118,"startLine":11,"endLine":15,"kind":"function"}]],["getrecentactions",[{"name":"getRecentActions","fileId":29,"startLine":17,"endLine":20,"kind":"function"},{"name":"getRecentActions","fileId":118,"startLine":17,"endLine":20,"kind":"function"}]],["clearactions",[{"name":"clearActions","fileId":29,"startLine":22,"endLine":24,"kind":"function"},{"name":"clearActions","fileId":118,"startLine":22,"endLine":24,"kind":"function"}]],["getsheetdata",[{"name":"getSheetData","fileId":30,"startLine":3,"endLine":61,"kind":"function"},{"name":"getSheetData","fileId":119,"startLine":3,"endLine":61,"kind":"function"}]],["highlightduplicates",[{"name":"highlightDuplicates","fileId":30,"startLine":64,"endLine":131,"kind":"function"},{"name":"highlightDuplicates","fileId":119,"startLine":64,"endLine":131,"kind":"function"}]],["clearhighlights",[{"name":"clearHighlights","fileId":30,"startLine":133,"endLine":201,"kind":"function"},{"name":"clearHighlights","fileId":119,"startLine":133,"endLine":201,"kind":"function"}]],["appendrow",[{"name":"appendRow","fileId":30,"startLine":204,"endLine":233,"kind":"function"},{"name":"appendRow","fileId":119,"startLine":204,"endLine":233,"kind":"function"}]],["getsheetsproperties",[{"name":"getSheetsProperties","fileId":30,"startLine":235,"endLine":249,"kind":"function"},{"name":"getSheetsProperties","fileId":119,"startLine":235,"endLine":249,"kind":"function"}]],["extractsymbols",[{"name":"extractSymbols","fileId":34,"startLine":9,"endLine":72,"kind":"function"},{"name":"extractSymbols","fileId":53,"startLine":5,"endLine":74,"kind":"function"}]],["scanfiles",[{"name":"scanFiles","fileId":35,"startLine":20,"endLine":41,"kind":"function"},{"name":"scanFiles","fileId":54,"startLine":17,"endLine":40,"kind":"function"}]],["intersectsets",[{"name":"intersectSets","fileId":36,"startLine":2,"endLine":17,"kind":"function"},{"name":"intersectSets","fileId":55,"startLine":1,"endLine":17,"kind":"function"}]],["scorematch",[{"name":"scoreMatch","fileId":36,"startLine":18,"endLine":32,"kind":"function"},{"name":"scoreMatch","fileId":55,"startLine":20,"endLine":35,"kind":"function"}]],["ownkeys",[{"name":"ownKeys","fileId":37,"startLine":19,"endLine":26,"kind":"function"},{"name":"ownKeys","fileId":48,"startLine":19,"endLine":26,"kind":"function"}]],["searchindex",[{"name":"searchIndex","fileId":38,"startLine":4,"endLine":28,"kind":"function"},{"name":"searchIndex","fileId":57,"startLine":3,"endLine":33,"kind":"function"}]],["score",[{"name":"score","fileId":38,"startLine":29,"endLine":37,"kind":"function"},{"name":"score","fileId":57,"startLine":35,"endLine":40,"kind":"function"}]],["trigrams",[{"name":"trigrams","fileId":39,"startLine":4,"endLine":14,"kind":"function"},{"name":"trigrams","fileId":58,"startLine":1,"endLine":12,"kind":"function"}]],["createwindow",[{"name":"createWindow","fileId":48,"startLine":40,"endLine":63,"kind":"function"},{"name":"createWindow","fileId":66,"startLine":8,"endLine":37,"kind":"function"}]],["importprojects",[{"name":"importProjects","fileId":72,"startLine":21,"endLine":28,"kind":"function"}]],["onselect",[{"name":"onSelect","fileId":72,"startLine":35,"endLine":43,"kind":"function"}]],["usesearch",[{"name":"useSearch","fileId":73,"startLine":4,"endLine":22,"kind":"function"}]],["codeclipboard",[{"name":"CodeClipboard","fileId":75,"startLine":9,"endLine":32,"kind":"function"}]],["injectpanel",[{"name":"InjectPanel","fileId":76,"startLine":3,"endLine":37,"kind":"function"}]],["inject",[{"name":"inject","fileId":76,"startLine":11,"endLine":18,"kind":"function"}]],["searchresults",[{"name":"SearchResults","fileId":77,"startLine":3,"endLine":26,"kind":"function"}]],["projectimporter",[{"name":"ProjectImporter","fileId":78,"startLine":4,"endLine":28,"kind":"function"}]],["importfolders",[{"name":"importFolders","fileId":78,"startLine":7,"endLine":18,"kind":"function"}]],["sidebar",[{"name":"Sidebar","fileId":81,"startLine":3,"endLine":33,"kind":"function"}]],["detectlanguage",[{"name":"detectLanguage","fileId":83,"startLine":1,"endLine":7,"kind":"function"}]]],"trigramIndex":[["__i",[3,4,5,10,11,13,19,27,36,55,72,76,78,92,93,94,99,100,102,108,116]],["_in",[3,4,5,10,11,13,19,36,55,76,92,93,94,99,100,102,108]],["ini",[3,4,5,10,11,92,93,94,99,100]],["nit",[3,4,5,10,11,92,93,94,99,100]],["ita",[3,4,92,93]],["tai",[3,4,13,92,93,102]],["ai_",[3,4,92,93]],["i__",[3,4,24,92,93,113]],["__a",[3,4,11,16,20,27,30,72,86,92,93,100,105,109,116,119]],["_an",[3,4,92,93]],["ana",[3,4,92,93]],["nal",[3,4,7,92,93,96]],["aly",[3,4,92,93]],["lyz",[3,4,92,93]],["yze",[3,4,92,93]],["zeb",[3,4,92,93]],["ebu",[3,4,92,93]],["bug",[3,4,92,93]],["ug_",[3,4,92,93]],["g__",[3,4,7,21,24,92,93,96,110,113]],["itm",[5,94]],["tmo",[5,94]],["mod",[5,94]],["ode",[5,75,94]],["del",[5,94]],["el_",[5,12,13,76,94,101,102]],["l__",[5,7,12,13,20,21,22,76,94,96,101,102,109,110,111]],["__e",[5,34,53,94]],["_em",[5,94]],["emb",[5,94]],["mbe",[5,94]],["bed",[5,94]],["edt",[5,94]],["dte",[5,20,94,109]],["tex",[5,8,20,94,97,109]],["ext",[5,8,13,19,20,34,53,94,97,102,108,109]],["xts",[5,94]],["ts_",[5,30,36,55,72,77,94,119]],["s__",[5,11,12,13,20,26,27,29,30,34,35,36,37,39,48,53,54,55,58,72,77,78,94,100,101,102,109,115,116,118,119]],["__c",[5,7,12,22,29,30,48,66,75,94,96,101,111,118,119]],["_co",[5,75,94]],["cos",[5,94]],["osi",[5,94]],["sin",[5,12,94,101]],["ine",[5,94]],["nes",[5,94]],["esi",[5,94]],["sim",[5,94]],["imi",[5,94]],["mil",[5,94]],["ila",[5,11,94,100]],["lar",[5,94]],["ari",[5,94]],["rit",[5,94]],["ity",[5,94]],["ty_",[5,94]],["y__",[5,10,12,19,94,99,101,108]],["__f",[5,7,94,96]],["_fi",[5,7,94,96]],["fin",[5,7,94,96]],["ind",[5,38,48,57,66,94]],["ndd",[5,19,94,108]],["ddu",[5,94]],["dup",[5,10,18,30,94,99,107,119]],["upl",[5,10,12,17,18,30,94,99,101,106,107,119]],["pli",[5,10,12,18,30,94,99,101,107,119]],["lic",[5,10,11,13,18,30,94,99,100,102,107,119]],["ica",[5,10,18,30,94,99,107,119]],["cat",[5,10,18,30,94,99,107,119]],["ate",[5,7,10,12,16,18,20,28,30,48,66,94,96,99,101,105,107,109,117,119]],["tes",[5,18,30,94,107,119]],["es_",[5,30,35,54,94,119]],["__s",[7,11,12,19,20,21,22,24,26,35,36,38,54,55,57,77,81,96,100,101,108,109,110,111,113,115]],["_se",[7,24,38,57,77,96,113]],["set",[7,11,24,26,36,55,96,100,113,115]],["etr",[7,29,96,118]],["tre",[7,19,21,24,29,96,108,110,113,118]],["rec",[7,21,24,29,96,110,113,118]],["eco",[7,13,21,24,96,102,110,113]],["cor",[7,21,24,36,38,55,57,96,110,113]],["ord",[7,20,21,24,96,109,110,113]],["rdi",[7,21,24,96,110,113]],["din",[7,21,24,96,110,113]],["ing",[7,12,21,24,96,101,110,113]],["ngf",[7,96]],["gfl",[7,96]],["fla",[7,96]],["lag",[7,96]],["ag_",[7,96]],["_sa",[7,11,20,26,96,100,109,115]],["sav",[7,20,96,109]],["ave",[7,20,96,109]],["veb",[7,96]],["ebl",[7,96]],["blo",[7,96]],["lob",[7,96]],["obu",[7,96]],["bur",[7,96]],["url",[7,96]],["rlt",[7,96]],["lto",[7,96]],["tos",[7,13,96,102]],["ost",[7,96]],["sto",[7,11,19,96,100,108]],["tor",[7,10,11,96,99,100]],["ora",[7,11,96,100]],["rag",[7,11,96,100]],["age",[7,11,13,83,96,100,102]],["ge_",[7,13,19,21,83,96,102,108,110]],["e__",[7,11,12,13,16,19,20,21,28,38,57,83,96,100,101,102,105,108,109,110,117]],["ina",[7,96]],["ali",[7,96]],["liz",[7,96]],["ize",[7,96]],["zer",[7,96]],["ere",[7,96]],["ng_",[7,21,24,96,110,113]],["__t",[7,19,20,39,58,96,108,109]],["_tr",[7,39,58,96]],["try",[7,96]],["ryt",[7,96]],["yta",[7,96]],["tab",[7,96]],["abc",[7,96]],["bca",[7,96]],["cap",[7,11,22,96,100,111]],["apt",[7,11,22,96,100,111]],["ptu",[7,11,22,96,100,111]],["tur",[7,11,22,96,100,111]],["ure",[7,11,22,96,100,111]],["re_",[7,11,38,57,96,100]],["_sc",[7,22,35,36,38,54,55,57,96,111]],["sch",[7,96]],["che",[7,96]],["hed",[7,96]],["edu",[7,96]],["dul",[7,96]],["ule",[7,96]],["les",[7,12,35,54,96,101]],["esc",[7,18,22,96,107,111]],["scr",[7,11,22,96,100,111]],["cre",[7,11,12,22,48,66,96,100,101,111]],["ree",[7,11,22,96,100,111]],["een",[7,11,22,96,100,111]],["ens",[7,11,22,96,100,111]],["nsh",[7,11,22,96,100,111]],["sho",[7,11,22,96,100,111]],["hot",[7,11,22,96,100,111]],["otc",[7,96]],["tcl",[7,96]],["cle",[7,12,29,30,96,101,118,119]],["lea",[7,12,16,29,30,96,101,105,118,119]],["ean",[7,12,16,20,96,101,105,109]],["anu",[7,12,96,101]],["nup",[7,12,17,96,101,106]],["up_",[7,12,20,96,101,109]],["p__",[7,12,16,20,72,86,96,101,105,109]],["_cr",[7,12,48,66,96,101]],["rea",[7,12,48,66,96,101]],["eat",[7,12,48,66,96,101]],["tep",[7,96]],["epr",[7,13,96,102]],["pre",[7,11,13,19,96,100,102,108]],["rev",[7,13,19,96,102,108]],["evi",[7,13,96,102]],["vie",[7,13,96,102]],["iew",[7,13,96,102]],["ewd",[7,96]],["wda",[7,96]],["dat",[7,28,30,96,117,119]],["ata",[7,30,96,119]],["tau",[7,96]],["aur",[7,96]],["rl_",[7,96]],["__g",[7,8,17,27,28,29,30,96,97,106,116,117,118,119]],["_ge",[7,8,27,28,29,30,96,97,116,117,118,119]],["get",[7,8,27,28,29,30,96,97,116,117,118,119]],["etc",[7,96]],["tca",[7,11,96,100]],["cac",[7,96]],["ach",[7,96]],["edd",[7,28,96,117]],["dda",[7,28,96,117]],["ta_",[7,30,96,119]],["a__",[7,30,96,119]],["ett",[8,97]],["tte",[8,28,97,117]],["xtc",[8,97]],["tco",[8,97]],["col",[8,97]],["olo",[8,97]],["lor",[8,97]],["orf",[8,97]],["rfo",[8,97]],["for",[8,13,28,97,102,117]],["oro",[8,97]],["rok",[8,97]],["okl",[8,97]],["klc",[8,97]],["lch",[8,97]],["ch_",[8,36,55,73,97]],["h__",[8,28,36,55,73,97,117]],["__d",[8,13,17,22,83,97,102,106,111]],["_di",[8,97]],["dis",[8,97]],["isp",[8,97]],["spl",[8,97]],["pla",[8,19,97,108]],["lay",[8,10,12,19,97,99,101,108]],["ayb",[8,11,19,97,100,108]],["ybu",[8,97]],["but",[8,97]],["utt",[8,97]],["tto",[8,22,97,111]],["ton",[8,97]],["on_",[8,12,29,97,101,118]],["n__",[8,12,18,20,25,29,97,101,107,109,114,118]],["__p",[9,11,13,19,78,98,100,102,108]],["_pu",[9,98]],["pus",[9,98]],["ush",[9,98]],["she",[9,13,30,98,102,119]],["her",[9,98]],["err",[9,98]],["rro",[9,98]],["ror",[9,98]],["or_",[9,10,98,99]],["r__",[9,10,13,16,17,18,27,78,81,98,99,102,105,106,107,116]],["itd",[10,99]],["tdu",[10,30,99,119]],["ted",[10,20,28,99,109,117]],["ede",[10,99]],["det",[10,13,83,99,102]],["ete",[10,83,99]],["tec",[10,83,99]],["ect",[10,12,36,55,72,76,78,83,99,101]],["cto",[10,99]],["__r",[10,11,18,21,99,100,107,110]],["_re",[10,11,21,99,100,110]],["ren",[10,99]],["end",[10,30,99,119]],["nde",[10,38,57,99]],["der",[10,16,17,18,21,78,99,105,106,107,110]],["ero",[10,99]],["rov",[10,99]],["ove",[10,11,12,20,99,100,101,109]],["ver",[10,12,99,101]],["erl",[10,12,99,101]],["rla",[10,12,99,101]],["ays",[10,99]],["ysu",[10,99]],["sum",[10,99]],["umm",[10,99]],["mma",[10,99]],["mar",[10,20,99,109]],["ary",[10,99]],["ry_",[10,99]],["saf",[11,26,100,115]],["afe",[11,26,100,115]],["fes",[11,26,100,115]],["est",[11,100]],["ges",[11,100]],["ese",[11,12,26,73,100,101,115]],["et_",[11,13,100,102]],["t__",[11,13,20,22,72,76,100,102,109,111]],["_pe",[11,100]],["per",[11,30,100,119]],["ers",[11,12,36,55,78,100,101]],["rsi",[11,100]],["sis",[11,100]],["ist",[11,12,13,17,100,101,102,106]],["sta",[11,12,19,21,24,26,100,101,108,110,113,115]],["tac",[11,29,100,118]],["act",[11,29,34,53,100,118]],["cti",[11,12,29,78,100,101,118]],["tio",[11,12,29,100,101,118]],["ion",[11,12,29,100,101,118]],["ons",[11,29,72,100,118]],["ns_",[11,29,100,118]],["sts",[11,100]],["tsc",[11,100]],["oti",[11,100]],["tif",[11,100]],["ifa",[11,100]],["fav",[11,100]],["ava",[11,100]],["vai",[11,100]],["ail",[11,13,100,102]],["lab",[11,100]],["abl",[11,100]],["ble",[11,100]],["le_",[11,100]],["_pr",[11,13,19,78,100,102,108]],["pru",[11,100]],["run",[11,18,100,107]],["une",[11,100]],["neo",[11,100]],["eol",[11,100]],["old",[11,78,100]],["ld_",[11,100]],["d__",[11,13,19,20,75,100,102,108,109]],["req",[11,100]],["equ",[11,100]],["que",[11,100]],["ues",[11,100]],["stc",[11,100]],["ref",[11,100]],["efr",[11,100]],["fra",[11,19,100,108]],["ram",[11,19,39,58,100,108]],["ame",[11,19,100,108]],["me_",[11,19,100,108]],["__m",[11,13,20,25,100,102,109,114]],["_ma",[11,20,25,100,109,114]],["may",[11,100]],["ybe",[11,100]],["bec",[11,100]],["eca",[11,100]],["__h",[11,12,13,16,18,20,21,30,100,101,102,105,107,109,110,119]],["_ha",[11,12,13,16,20,21,100,101,102,105,109,110]],["han",[11,13,16,19,20,21,100,102,105,108,109,110]],["and",[11,13,16,19,20,21,100,102,105,108,109,110]],["ndl",[11,13,16,20,21,100,102,105,109,110]],["dle",[11,13,16,20,21,100,102,105,109,110]],["lec",[11,12,13,21,72,100,101,102,110]],["ecl",[11,75,100]],["cli",[11,13,75,100,102]],["ick",[11,13,100,102]],["ck_",[11,13,19,100,102,108]],["k__",[11,13,19,100,102,108]],["lek",[11,100]],["eke",[11,100]],["key",[11,12,37,48,100,101]],["eyp",[11,100]],["ypr",[11,100]],["res",[11,22,77,100,111]],["ess",[11,13,100,102]],["ss_",[11,100]],["_ad",[11,20,27,100,109,116]],["add",[11,20,27,100,109,116]],["ddl",[11,100]],["dli",[11,100]],["lis",[11,12,13,17,100,101,102,106]],["ste",[11,12,13,17,100,101,102,106]],["ten",[11,12,13,17,100,101,102,106]],["ene",[11,12,13,17,100,101,102,106]],["ner",[11,12,13,17,100,101,102,106]],["rs_",[11,12,27,78,100,101,116]],["rem",[11,12,36,55,100,101]],["emo",[11,12,20,100,101,109]],["mov",[11,12,20,100,101,109]],["vel",[11,100]],["eli",[11,13,100,102]],["it_",[11,100]],["teo",[12,101]],["eov",[12,101]],["ay_",[12,19,101,108]],["har",[12,101]],["ard",[12,13,75,101,102]],["rdr",[12,101]],["dre",[12,101]],["veo",[12,101]],["_st",[12,19,21,24,101,108,110,113]],["tar",[12,19,21,24,101,108,110,113]],["art",[12,19,21,24,101,108,110,113]],["rts",[12,101]],["tsi",[12,101]],["ngl",[12,101]],["gle",[12,19,101,108]],["sel",[12,72,101]],["ele",[12,72,101]],["__o",[12,13,17,19,37,48,72,101,102,106,108]],["_on",[12,13,19,72,101,102,108]],["onp",[12,101]],["npo",[12,101]],["poi",[12,101]],["oin",[12,101]],["int",[12,13,36,55,101,102]],["nte",[12,36,55,101]],["ter",[12,36,55,78,101]],["erd",[12,101]],["rdo",[12,101]],["dow",[12,17,19,20,22,48,66,101,106,108,109,111]],["own",[12,17,19,20,22,37,48,101,106,108,109,111]],["wn_",[12,20,101,109]],["erm",[12,101]],["rmo",[12,101]],["ve_",[12,20,101,109]],["_cl",[12,29,30,101,118,119]],["eru",[12,101]],["rup",[12,101]],["erc",[12,101]],["rca",[12,101]],["can",[12,18,20,35,54,101,107,109]],["anc",[12,101]],["nce",[12,101]],["cel",[12,101]],["onk",[12,101]],["nke",[12,37,48,101]],["eyd",[12,101]],["ydo",[12,101]],["_de",[13,83,102]],["dev",[13,102]],["evp",[13,102]],["vpa",[13,102]],["pan",[13,76,102]],["ane",[13,76,102]],["nel",[13,76,102]],["__l",[13,17,29,102,106,118]],["_lo",[13,29,102,118]],["loa",[13,17,19,22,102,106,108,111]],["oad",[13,17,19,22,102,106,108,111]],["ad_",[13,19,102,108]],["onc",[13,19,102,108]],["nch",[13,19,102,108]],["cha",[13,19,21,102,108,110]],["ang",[13,19,21,83,102,108,110]],["nge",[13,19,21,102,108,110]],["pro",[13,30,72,78,102,119]],["rom",[13,102]],["omp",[13,102]],["mpt",[13,102]],["ptf",[13,102]],["tfo",[13,28,78,102,117]],["ore",[13,27,36,38,55,57,102,116]],["rex",[13,102]],["xtr",[13,34,53,102]],["tra",[13,34,53,102]],["rad",[13,102]],["ade",[13,16,17,18,102,105,106,107]],["eta",[13,102]],["ils",[13,102]],["ls_",[13,34,53,102]],["_li",[13,17,102,106]],["er_",[13,16,17,18,78,102,105,106,107]],["_me",[13,102]],["mes",[13,102]],["ssa",[13,102]],["sag",[13,102]],["gel",[13,102]],["ins",[13,19,102,108]],["nse",[13,72,102]],["ser",[13,102]],["ert",[13,20,21,30,102,109,110,119]],["rti",[13,30,102,119]],["tin",[13,102]],["nto",[13,102]],["osh",[13,102]],["hee",[13,30,102,119]],["eet",[13,30,102,119]],["lep",[13,19,102,108]],["ewc",[13,102]],["wcl",[13,102]],["cop",[13,102]],["opy",[13,102]],["pyt",[13,102]],["yto",[13,102]],["toc",[13,20,102,109]],["ocl",[13,102]],["lip",[13,75,102]],["ipb",[13,75,102]],["pbo",[13,75,102]],["boa",[13,75,102]],["oar",[13,75,102]],["rd_",[13,75,102]],["_ap",[16,30,72,86,105,119]],["app",[16,30,72,86,105,119]],["pp_",[16,72,86,105]],["ann",[16,20,105,109]],["nno",[16,20,105,109]],["not",[16,20,105,109]],["ota",[16,20,105,109]],["tat",[16,20,26,105,109,115]],["te_",[16,28,105,117]],["_he",[16,18,105,107]],["hea",[16,18,105,107]],["ead",[16,18,105,107]],["_gi",[17,106]],["gif",[17,106]],["ifm",[17,106]],["fma",[17,106]],["mak",[17,106]],["ake",[17,106]],["ker",[17,20,106,109]],["_op",[17,106]],["ope",[17,30,106,119]],["pen",[17,30,106,119]],["enu",[17,106]],["plo",[17,106]],["_do",[17,22,106,111]],["wnl",[17,19,22,106,108,111]],["nlo",[17,19,22,106,108,111]],["adg",[17,106]],["dgi",[17,106]],["if_",[17,106]],["f__",[17,106]],["_ru",[18,107]],["und",[18,107]],["ndu",[18,107]],["sca",[18,35,54,107]],["an_",[18,107]],["nst",[19,108]],["tan",[19,108]],["ant",[19,108]],["ntr",[19,108]],["rep",[19,108]],["epl",[19,108]],["rtp",[19,72,108]],["tpl",[19,108]],["yba",[19,108]],["bac",[19,108]],["ack",[19,108]],["top",[19,108]],["opp",[19,108]],["ppl",[19,108]],["_to",[19,20,108,109]],["tog",[19,108]],["ogg",[19,108]],["ggl",[19,108]],["evf",[19,108]],["vfr",[19,108]],["__n",[19,28,108,117]],["_ne",[19,108]],["nex",[19,108]],["xtf",[19,108]],["tfr",[19,108]],["__b",[19,108]],["_bu",[19,108]],["bui",[19,108]],["uil",[19,108]],["ild",[19,108]],["ldv",[19,108]],["dvi",[19,108]],["vid",[19,108]],["ide",[19,81,108]],["deo",[19,108]],["eoa",[19,108]],["oan",[19,108]],["ddo",[19,108]],["ark",[20,109]],["rke",[20,109]],["rto",[20,21,109,110]],["too",[20,21,22,109,110,111]],["ool",[20,21,22,109,110,111]],["ol_",[20,21,22,109,110,111]],["oca",[20,109]],["anv",[20,109]],["nva",[20,109]],["vas",[20,109]],["asc",[20,109]],["sco",[20,36,38,55,57,109]],["coo",[20,109]],["oor",[20,109]],["rds",[20,109]],["ds_",[20,109]],["lem",[20,109]],["mou",[20,109]],["ous",[20,109]],["use",[20,73,109]],["sed",[20,109]],["edo",[20,109]],["sem",[20,109]],["seu",[20,109]],["eup",[20,109]],["ddt",[20,109]],["xt_",[20,109]],["vea",[20,109]],["ed_",[20,109]],["rde",[21,110]],["ech",[21,110]],["rtr",[21,24,110,113]],["ott",[22,111]],["_ca",[22,111]],["ot_",[22,111]],["ads",[22,111]],["dsc",[22,111]],["etu",[24,113]],["tui",[24,113]],["ui_",[24,113]],["mai",[25,114]],["ain",[25,114]],["in_",[25,114]],["ets",[26,30,36,55,115,119]],["tst",[26,115]],["atu",[26,115]],["tus",[26,115]],["us_",[26,115]],["eti",[27,116]],["tig",[27,116]],["ign",[27,116]],["gno",[27,116]],["nor",[27,116]],["red",[27,116]],["edp",[27,116]],["dpa",[27,116]],["pai",[27,116]],["air",[27,116]],["irs",[27,116]],["ddi",[27,116]],["dig",[27,116]],["ir_",[27,116]],["_is",[27,116]],["isi",[27,116]],["sig",[27,116]],["etf",[28,117]],["orm",[28,117]],["rma",[28,117]],["mat",[28,36,55,117]],["att",[28,117]],["_nt",[28,117]],["nth",[28,117]],["th_",[28,117]],["log",[29,118]],["oga",[29,118]],["gac",[29,118]],["ece",[29,118]],["cen",[29,118]],["ent",[29,118]],["nta",[29,118]],["ear",[29,30,38,57,73,77,118,119]],["ara",[29,118]],["rac",[29,34,53,118]],["tsh",[30,119]],["etd",[30,119]],["tda",[30,119]],["_hi",[30,119]],["hig",[30,119]],["igh",[30,119]],["ghl",[30,119]],["hli",[30,119]],["lig",[30,119]],["ght",[30,119]],["htd",[30,119]],["arh",[30,119]],["rhi",[30,119]],["hts",[30,119]],["ppe",[30,119]],["ndr",[30,119]],["dro",[30,119]],["row",[30,119]],["ow_",[30,48,66,119]],["w__",[30,48,66,119]],["tsp",[30,119]],["spr",[30,119]],["rop",[30,119]],["tie",[30,119]],["ies",[30,119]],["_ex",[34,53]],["cts",[34,36,53,55,72]],["tsy",[34,53]],["sym",[34,53]],["ymb",[34,53]],["mbo",[34,53]],["bol",[34,53]],["ols",[34,53]],["anf",[35,54]],["nfi",[35,54]],["fil",[35,54]],["ile",[35,54]],["rse",[36,55]],["sec",[36,55]],["tse",[36,55]],["ema",[36,55]],["atc",[36,55]],["tch",[36,55]],["_ow",[37,48]],["wnk",[37,48]],["eys",[37,48]],["ys_",[37,48]],["sea",[38,57,73,77]],["arc",[38,57,73,77]],["rch",[38,57,73,77]],["chi",[38,57]],["hin",[38,57]],["dex",[38,57]],["ex_",[38,57]],["x__",[38,57]],["tri",[39,58]],["rig",[39,58]],["igr",[39,58]],["gra",[39,58]],["ams",[39,58]],["ms_",[39,58]],["tew",[48,66]],["ewi",[48,66]],["win",[48,66]],["ndo",[48,66]],["_im",[72,78]],["imp",[72,78]],["mpo",[72,78]],["por",[72,78]],["ort",[72,78]],["tpr",[72]],["roj",[72,78]],["oje",[72,78]],["jec",[72,76,78]],["ct_",[72,76]],["__u",[73]],["_us",[73]],["ses",[73]],["cod",[75]],["dec",[75]],["inj",[76]],["nje",[76]],["ctp",[76]],["tpa",[76]],["chr",[77]],["hre",[77]],["esu",[77]],["sul",[77]],["ult",[77]],["lts",[77]],["tim",[78]],["rte",[78]],["rtf",[78]],["fol",[78]],["lde",[78]],["_si",[81]],["sid",[81]],["deb",[81]],["eba",[81]],["bar",[81]],["ar_",[81]],["ctl",[83]],["tla",[83]],["lan",[83]],["ngu",[83]],["gua",[83]],["uag",[83]]]}